var l=class{withFields(t){let r=Object.keys(this).map(n=>n in t?t[n]:this[n]);return new this.constructor(...r)}},q=class{static fromArray(t,r){let n=r||new Ht;for(let i=t.length-1;i>=0;--i)n=new We(t[i],n);return n}[Symbol.iterator](){return new En(this)}toArray(){return[...this]}atLeastLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return r!==void 0}hasLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return t===-1&&r instanceof Ht}countLength(){let t=this,r=0;for(;t;)t=t.tail,r++;return r-1}};function p(e,t){return new We(e,t)}function o(e,t){return q.fromArray(e,t)}var En=class{#e;constructor(t){this.#e=t}next(){if(this.#e instanceof Ht)return{done:!0};{let{head:t,tail:r}=this.#e;return this.#e=r,{value:t,done:!1}}}},Ht=class extends q{},We=class extends q{constructor(t,r){super(),this.head=t,this.tail=r}},Je=class{bitSize;byteSize;bitOffset;rawBuffer;constructor(t,r,n){if(!(t instanceof Uint8Array))throw globalThis.Error("BitArray can only be constructed from a Uint8Array");if(this.bitSize=r??t.length*8,this.byteSize=Math.trunc((this.bitSize+7)/8),this.bitOffset=n??0,this.bitSize<0)throw globalThis.Error(`BitArray bit size is invalid: ${this.bitSize}`);if(this.bitOffset<0||this.bitOffset>7)throw globalThis.Error(`BitArray bit offset is invalid: ${this.bitOffset}`);if(t.length!==Math.trunc((this.bitOffset+this.bitSize+7)/8))throw globalThis.Error("BitArray buffer length is invalid");this.rawBuffer=t}byteAt(t){if(!(t<0||t>=this.byteSize))return Yt(this.rawBuffer,this.bitOffset,t)}equals(t){if(this.bitSize!==t.bitSize)return!1;let r=Math.trunc(this.bitSize/8);if(this.bitOffset===0&&t.bitOffset===0){for(let i=0;i<r;i++)if(this.rawBuffer[i]!==t.rawBuffer[i])return!1;let n=this.bitSize%8;if(n){let i=8-n;if(this.rawBuffer[r]>>i!==t.rawBuffer[r]>>i)return!1}}else{for(let i=0;i<r;i++){let s=Yt(this.rawBuffer,this.bitOffset,i),u=Yt(t.rawBuffer,t.bitOffset,i);if(s!==u)return!1}let n=this.bitSize%8;if(n){let i=Yt(this.rawBuffer,this.bitOffset,r),s=Yt(t.rawBuffer,t.bitOffset,r),u=8-n;if(i>>u!==s>>u)return!1}}return!0}get buffer(){if(us("buffer","Use BitArray.byteAt() or BitArray.rawBuffer instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.buffer does not support unaligned bit arrays");return this.rawBuffer}get length(){if(us("length","Use BitArray.bitSize or BitArray.byteSize instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.length does not support unaligned bit arrays");return this.rawBuffer.length}};function Yt(e,t,r){if(t===0)return e[r]??0;{let n=e[r]<<t&255,i=e[r+1]>>8-t;return n|i}}var kr=class{constructor(t){this.value=t}},os={};function us(e,t){os[e]||(console.warn(`Deprecated BitArray.${e} property used in JavaScript FFI code. ${t}.`),os[e]=!0)}var xt=class e extends l{static isResult(t){return t instanceof e}},m=class extends xt{constructor(t){super(),this[0]=t}isOk(){return!0}},h=class extends xt{constructor(t){super(),this[0]=t}isOk(){return!1}};function v(e,t){let r=[e,t];for(;r.length;){let n=r.pop(),i=r.pop();if(n===i)continue;if(!ls(n)||!ls(i)||!Nu(n,i)||qu(n,i)||Iu(n,i)||Bu(n,i)||zu(n,i)||Du(n,i)||Cu(n,i))return!1;let u=Object.getPrototypeOf(n);if(u!==null&&typeof u.equals=="function")try{if(n.equals(i))continue;return!1}catch{}let[a,c]=Eu(n);for(let g of a(n))r.push(c(n,g),c(i,g))}return!0}function Eu(e){if(e instanceof Map)return[t=>t.keys(),(t,r)=>t.get(r)];{let t=e instanceof globalThis.Error?["message"]:[];return[r=>[...t,...Object.keys(r)],(r,n)=>r[n]]}}function qu(e,t){return e instanceof Date&&(e>t||e<t)}function Iu(e,t){return!(e instanceof Je)&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT&&!(e.byteLength===t.byteLength&&e.every((r,n)=>r===t[n]))}function Bu(e,t){return Array.isArray(e)&&e.length!==t.length}function zu(e,t){return e instanceof Map&&e.size!==t.size}function Du(e,t){return e instanceof Set&&(e.size!=t.size||[...e].some(r=>!t.has(r)))}function Cu(e,t){return e instanceof RegExp&&(e.source!==t.source||e.flags!==t.flags)}function ls(e){return typeof e=="object"&&e!==null}function Nu(e,t){return typeof e!="object"&&typeof t!="object"&&(!e||!t)||[Promise,WeakSet,WeakMap,Function].some(n=>e instanceof n)?!1:e.constructor===t.constructor}function K(e,t){return t===0?0:e%t}function I(e,t){return Math.trunc(wt(e,t))}function wt(e,t){return t===0?0:e/t}function oe(e,t,r,n,i,s){let u=new globalThis.Error(i);u.gleam_error=e,u.module=t,u.line=r,u.function=n,u.fn=n;for(let a in s)u[a]=s[a];return u}var _=class extends l{constructor(t){super(),this[0]=t}},y=class extends l{};function qn(e){return!v(e,new y)}function as(e,t){if(e instanceof _){let r=e[0];return new m(r)}else return new h(t)}function Or(e,t){return e instanceof _?e[0]:t}function Lr(e,t){if(e instanceof _){let r=e[0];return new _(t(r))}else return new y}function cs(e){return e instanceof _?e[0]:new y}var fs=new WeakMap,In=new DataView(new ArrayBuffer(8)),Bn=0;function zn(e){let t=fs.get(e);if(t!==void 0)return t;let r=Bn++;return Bn===2147483647&&(Bn=0),fs.set(e,r),r}function Dn(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function Nn(e){let t=0,r=e.length;for(let n=0;n<r;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function _s(e){In.setFloat64(0,e);let t=In.getInt32(0),r=In.getInt32(4);return Math.imul(73244475,t>>16^t)^r}function Fu(e){return Nn(e.toString())}function Wu(e){let t=Object.getPrototypeOf(e);if(t!==null&&typeof t.hashCode=="function")try{let n=e.hashCode(e);if(typeof n=="number")return n}catch{}if(e instanceof Promise||e instanceof WeakSet||e instanceof WeakMap)return zn(e);if(e instanceof Date)return _s(e.getTime());let r=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||e instanceof Uint8Array)for(let n=0;n<e.length;n++)r=Math.imul(31,r)+re(e[n])|0;else if(e instanceof Set)e.forEach(n=>{r=r+re(n)|0});else if(e instanceof Map)e.forEach((n,i)=>{r=r+Dn(re(n),re(i))|0});else{let n=Object.keys(e);for(let i=0;i<n.length;i++){let s=n[i],u=e[s];r=r+Dn(re(u),Nn(s))|0}}return r}function re(e){if(e===null)return 1108378658;if(e===void 0)return 1108378659;if(e===!0)return 1108378657;if(e===!1)return 1108378656;switch(typeof e){case"number":return _s(e);case"string":return Nn(e);case"bigint":return Fu(e);case"object":return Wu(e);case"symbol":return zn(e);case"function":return zn(e);default:return 0}}var he=5,Fn=Math.pow(2,he),Ju=Fn-1,Pu=Fn/2,Yu=Fn/4,P=0,$e=1,Q=2,Pe=3,Wn={type:Q,bitmap:0,array:[]};function Ut(e,t){return e>>>t&Ju}function Sr(e,t){return 1<<Ut(e,t)}function Hu(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Jn(e,t){return Hu(e&t-1)}function ne(e,t,r){let n=e.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=e[s];return i[t]=r,i}function Uu(e,t,r){let n=e.length,i=new Array(n+1),s=0,u=0;for(;s<t;)i[u++]=e[s++];for(i[u++]=r;s<n;)i[u++]=e[s++];return i}function Cn(e,t){let r=e.length,n=new Array(r-1),i=0,s=0;for(;i<t;)n[s++]=e[i++];for(++i;i<r;)n[s++]=e[i++];return n}function ds(e,t,r,n,i,s){let u=re(t);if(u===n)return{type:Pe,hash:u,array:[{type:P,k:t,v:r},{type:P,k:i,v:s}]};let a={val:!1};return Rt(Pn(Wn,e,u,t,r,a),e,n,i,s,a)}function Rt(e,t,r,n,i,s){switch(e.type){case $e:return Ru(e,t,r,n,i,s);case Q:return Pn(e,t,r,n,i,s);case Pe:return Gu(e,t,r,n,i,s)}}function Ru(e,t,r,n,i,s){let u=Ut(r,t),a=e.array[u];if(a===void 0)return s.val=!0,{type:$e,size:e.size+1,array:ne(e.array,u,{type:P,k:n,v:i})};if(a.type===P)return v(n,a.k)?i===a.v?e:{type:$e,size:e.size,array:ne(e.array,u,{type:P,k:n,v:i})}:(s.val=!0,{type:$e,size:e.size,array:ne(e.array,u,ds(t+he,a.k,a.v,r,n,i))});let c=Rt(a,t+he,r,n,i,s);return c===a?e:{type:$e,size:e.size,array:ne(e.array,u,c)}}function Pn(e,t,r,n,i,s){let u=Sr(r,t),a=Jn(e.bitmap,u);if(e.bitmap&u){let c=e.array[a];if(c.type!==P){let d=Rt(c,t+he,r,n,i,s);return d===c?e:{type:Q,bitmap:e.bitmap,array:ne(e.array,a,d)}}let g=c.k;return v(n,g)?i===c.v?e:{type:Q,bitmap:e.bitmap,array:ne(e.array,a,{type:P,k:n,v:i})}:(s.val=!0,{type:Q,bitmap:e.bitmap,array:ne(e.array,a,ds(t+he,g,c.v,r,n,i))})}else{let c=e.array.length;if(c>=Pu){let g=new Array(32),d=Ut(r,t);g[d]=Pn(Wn,t+he,r,n,i,s);let x=0,w=e.bitmap;for(let $=0;$<32;$++){if(w&1){let b=e.array[x++];g[$]=b}w=w>>>1}return{type:$e,size:c+1,array:g}}else{let g=Uu(e.array,a,{type:P,k:n,v:i});return s.val=!0,{type:Q,bitmap:e.bitmap|u,array:g}}}}function Gu(e,t,r,n,i,s){if(r===e.hash){let u=Yn(e,n);if(u!==-1)return e.array[u].v===i?e:{type:Pe,hash:r,array:ne(e.array,u,{type:P,k:n,v:i})};let a=e.array.length;return s.val=!0,{type:Pe,hash:r,array:ne(e.array,a,{type:P,k:n,v:i})}}return Rt({type:Q,bitmap:Sr(e.hash,t),array:[e]},t,r,n,i,s)}function Yn(e,t){let r=e.array.length;for(let n=0;n<r;n++)if(v(t,e.array[n].k))return n;return-1}function jr(e,t,r,n){switch(e.type){case $e:return Zu(e,t,r,n);case Q:return Vu(e,t,r,n);case Pe:return Ku(e,n)}}function Zu(e,t,r,n){let i=Ut(r,t),s=e.array[i];if(s!==void 0){if(s.type!==P)return jr(s,t+he,r,n);if(v(n,s.k))return s}}function Vu(e,t,r,n){let i=Sr(r,t);if(!(e.bitmap&i))return;let s=Jn(e.bitmap,i),u=e.array[s];if(u.type!==P)return jr(u,t+he,r,n);if(v(n,u.k))return u}function Ku(e,t){let r=Yn(e,t);if(!(r<0))return e.array[r]}function Hn(e,t,r,n){switch(e.type){case $e:return Qu(e,t,r,n);case Q:return Xu(e,t,r,n);case Pe:return el(e,n)}}function Qu(e,t,r,n){let i=Ut(r,t),s=e.array[i];if(s===void 0)return e;let u;if(s.type===P){if(!v(s.k,n))return e}else if(u=Hn(s,t+he,r,n),u===s)return e;if(u===void 0){if(e.size<=Yu){let a=e.array,c=new Array(e.size-1),g=0,d=0,x=0;for(;g<i;){let w=a[g];w!==void 0&&(c[d]=w,x|=1<<g,++d),++g}for(++g;g<a.length;){let w=a[g];w!==void 0&&(c[d]=w,x|=1<<g,++d),++g}return{type:Q,bitmap:x,array:c}}return{type:$e,size:e.size-1,array:ne(e.array,i,u)}}return{type:$e,size:e.size,array:ne(e.array,i,u)}}function Xu(e,t,r,n){let i=Sr(r,t);if(!(e.bitmap&i))return e;let s=Jn(e.bitmap,i),u=e.array[s];if(u.type!==P){let a=Hn(u,t+he,r,n);return a===u?e:a!==void 0?{type:Q,bitmap:e.bitmap,array:ne(e.array,s,a)}:e.bitmap===i?void 0:{type:Q,bitmap:e.bitmap^i,array:Cn(e.array,s)}}return v(n,u.k)?e.bitmap===i?void 0:{type:Q,bitmap:e.bitmap^i,array:Cn(e.array,s)}:e}function el(e,t){let r=Yn(e,t);if(r<0)return e;if(e.array.length!==1)return{type:Pe,hash:e.hash,array:Cn(e.array,r)}}function ms(e,t){if(e===void 0)return;let r=e.array,n=r.length;for(let i=0;i<n;i++){let s=r[i];if(s!==void 0){if(s.type===P){t(s.v,s.k);continue}ms(s,t)}}}var xe=class e{static fromObject(t){let r=Object.keys(t),n=e.new();for(let i=0;i<r.length;i++){let s=r[i];n=n.set(s,t[s])}return n}static fromMap(t){let r=e.new();return t.forEach((n,i)=>{r=r.set(i,n)}),r}static new(){return new e(void 0,0)}constructor(t,r){this.root=t,this.size=r}get(t,r){if(this.root===void 0)return r;let n=jr(this.root,0,re(t),t);return n===void 0?r:n.v}set(t,r){let n={val:!1},i=this.root===void 0?Wn:this.root,s=Rt(i,0,re(t),t,r,n);return s===this.root?this:new e(s,n.val?this.size+1:this.size)}delete(t){if(this.root===void 0)return this;let r=Hn(this.root,0,re(t),t);return r===this.root?this:r===void 0?e.new():new e(r,this.size-1)}has(t){return this.root===void 0?!1:jr(this.root,0,re(t),t)!==void 0}entries(){if(this.root===void 0)return[];let t=[];return this.forEach((r,n)=>t.push([n,r])),t}forEach(t){ms(this.root,t)}hashCode(){let t=0;return this.forEach((r,n)=>{t=t+Dn(re(r),re(n))|0}),t}equals(t){if(!(t instanceof e)||this.size!==t.size)return!1;try{return this.forEach((r,n)=>{if(!v(t.get(n,!r),r))throw ps}),!0}catch(r){if(r===ps)return!1;throw r}}},ps=Symbol();var Un=void 0,$s={};function Ye(e){return/^[-+]?(\d+)$/.test(e)?new m(parseInt(e)):new h(Un)}function M(e){return e.toString()}function Ar(e){let t=e.toString().replace("+","");if(t.indexOf(".")>=0)return t;{let r=t.indexOf("e");return r>=0?t.slice(0,r)+".0"+t.slice(r):t+".0"}}var hs;function rl(e){if(globalThis.Intl&&Intl.Segmenter)return hs||=new Intl.Segmenter,hs.segment(e)[Symbol.iterator]()}function ws(e){let t,r=rl(e);return r?t=r.next().value?.segment:t=e.match(/./su)?.[0],t?new m([t,e.slice(t.length)]):new h(Un)}function Te(e){let t="";for(let r of e)t=t+r;return t}var gs=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),nl=new RegExp(`^[${gs}]*`),il=new RegExp(`[${gs}]*$`);function ys(e){return e.replace(nl,"")}function bs(e){return e.replace(il,"")}function Rn(e){console.log(e)}function Gt(e){return Math.floor(e)}function Gn(e){return Math.round(e)}function Zt(){let e=Math.random();return e===1?Zt():e}function X(){return xe.new()}function Mr(e){return q.fromArray(e.entries())}function vs(e,t){return t.delete(e)}function ue(e,t){let r=e.get(t,$s);return r===$s?new h(Un):new m(r)}function ks(e,t,r){return r.set(e,t)}function ie(e){if(typeof e=="string")return"String";if(typeof e=="boolean")return"Bool";if(e instanceof xt)return"Result";if(e instanceof q)return"List";if(e instanceof Je)return"BitArray";if(e instanceof xe)return"Dict";if(Number.isInteger(e))return"Int";if(Array.isArray(e))return`Tuple of ${e.length} elements`;if(typeof e=="number")return"Float";if(e===null)return"Null";if(e===void 0)return"Nil";{let t=typeof e;return t.charAt(0).toUpperCase()+t.slice(1)}}function Zn(e,t){return sl(e,ie(t))}function sl(e,t){return new h(q.fromArray([new N(e,t,q.fromArray([]))]))}function Vn(e){return typeof e=="string"?new m(e):Zn("String",e)}function Os(e){return Number.isInteger(e)?new m(e):Zn("Int",e)}function Ls(e,t){let r=()=>Zn("Dict",e);if(e instanceof xe||e instanceof WeakMap||e instanceof Map){let n=ue(e,t);return new m(n.isOk()?new _(n[0]):new y)}else return e===null?r():Object.getPrototypeOf(e)==Object.prototype?xs(e,t,()=>new m(new y)):xs(e,t,r)}function xs(e,t,r){try{return t in e?new m(new _(e[t])):r()}catch{return r()}}function we(e){let t=typeof e;if(e===!0)return"True";if(e===!1)return"False";if(e===null)return"//js(null)";if(e===void 0)return"Nil";if(t==="string")return ol(e);if(t==="bigint"||Number.isInteger(e))return e.toString();if(t==="number")return Ar(e);if(Array.isArray(e))return`#(${e.map(we).join(", ")})`;if(e instanceof q)return cl(e);if(e instanceof kr)return pl(e);if(e instanceof Je)return fl(e);if(e instanceof l)return al(e);if(e instanceof xe)return ul(e);if(e instanceof Set)return`//js(Set(${[...e].map(we).join(", ")}))`;if(e instanceof RegExp)return`//js(${e})`;if(e instanceof Date)return`//js(Date("${e.toISOString()}"))`;if(e instanceof Function){let r=[];for(let n of Array(e.length).keys())r.push(String.fromCharCode(n+97));return`//fn(${r.join(", ")}) { ... }`}return ll(e)}function ol(e){let t='"';for(let r=0;r<e.length;r++){let n=e[r];switch(n){case`
`:t+="\\n";break;case"\r":t+="\\r";break;case"	":t+="\\t";break;case"\f":t+="\\f";break;case"\\":t+="\\\\";break;case'"':t+='\\"';break;default:n<" "||n>"~"&&n<"\xA0"?t+="\\u{"+n.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":t+=n}}return t+='"',t}function ul(e){let t="dict.from_list([",r=!0;return e.forEach((n,i)=>{r||(t=t+", "),t=t+"#("+we(i)+", "+we(n)+")",r=!1}),t+"])"}function ll(e){let t=Object.getPrototypeOf(e)?.constructor?.name||"Object",r=[];for(let s of Object.keys(e))r.push(`${we(s)}: ${we(e[s])}`);let n=r.length?" "+r.join(", ")+" ":"";return`//js(${t==="Object"?"":t+" "}{${n}})`}function al(e){let t=Object.keys(e).map(r=>{let n=we(e[r]);return isNaN(parseInt(r))?`${r}: ${n}`:n}).join(", ");return t?`${e.constructor.name}(${t})`:e.constructor.name}function cl(e){return`[${e.toArray().map(we).join(", ")}]`}function fl(e){return`<<${Array.from(e.buffer).join(", ")}>>`}function pl(e){return`//utfcodepoint(${String.fromCodePoint(e.value)})`}function ml(e){return-1*e}function Tr(e){return e>=0?Gn(e):0-Gn(ml(e))}function Kn(e){let t=Zt()*e,r=Gt(t);return Tr(r)}function Ee(e,t,r){return ks(t,r,e)}function hl(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head[0],s=r.head[1];e=r.tail,t=Ee(n,i,s)}}}function Kt(e){return hl(e,X())}function xl(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=p(i,n)}}}function wl(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return xl(n,o([]));{let i=r.head[0];e=r.tail,t=p(i,n)}}}function Qn(e){return wl(Mr(e),o([]))}function Xn(e,t){return vs(t,e)}function yl(e,t){for(;;){let r=e,n=t;if(r.atLeastLength(1))e=r.tail,t=n+1;else return n}}function ei(e){return yl(e,0)}function bl(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=p(i,n)}}}function F(e){return bl(e,o([]))}function vl(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return F(s);{let u=n.head;e=n.tail,t=i,r=p(i(u),s)}}}function Y(e,t){return vl(e,t,o([]))}function kl(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=p(i,n)}}}function yt(e,t){return kl(F(e),t)}function le(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return i;{let u=n.head;e=n.tail,t=s(i,u),r=s}}}function Ol(e,t,r,n){for(;;){let i=e,s=t,u=r,a=n;if(i.hasLength(0))return s;{let c=i.head;e=i.tail,t=u(s,c,a),r=u,n=a+1}}}function qr(e,t,r){return Ol(e,t,r,0)}function As(e){let r=ys(e);return bs(r)}function Ir(e,t){for(;;){let r=e,n=t;if(n>0){let s=ws(r);if(s.isOk())e=s[0][1],t=n-1;else return r}else return r}}function Ie(e){let t=we(e);return t}function qs(e){return!!e.isOk()}function Oe(e,t){if(e.isOk()){let r=e[0];return new m(t(r))}else{let r=e[0];return new h(r)}}function Le(e,t){if(e.isOk()){let r=e[0];return new m(r)}else{let r=e[0];return new h(t(r))}}function Z(e,t){if(e.isOk()){let r=e[0];return t(r)}else{let r=e[0];return new h(r)}}function ni(e,t){return Z(e,t)}function vt(e,t){return e.isOk()?e[0]:t}function Ue(e,t){if(e.isOk()){let r=e[0];return new m(r)}else return new h(t)}var N=class extends l{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}};function Nl(e,t){return Le(e,r=>Y(r,t))}function Is(e){return Vn(e)}function Bs(e){return t=>{if(e.hasLength(0))return new h(o([new N("another type",ie(t),o([]))]));{let r=e.head,n=e.tail,i=r(t);if(i.isOk()){let s=i[0];return new m(s)}else return Bs(n)(t)}}}function Fl(e,t){let r=t,n=Bs(o([Vn,u=>Oe(Os(u),M)])),i=(()=>{let u=n(r);if(u.isOk())return u[0];{let a=o(["<",ie(r),">"]),c=Te(a);return c}})(),s=e;return new N(s.expected,s.found,p(i,e.path))}function ii(e,t){return r=>{let n=new N("field","nothing",o([]));return Z(Ls(r,e),i=>{let u=as(i,o([n])),a=Z(u,t);return Nl(a,c=>Fl(c,e))})}}function zs(e,t){let r=Number.isInteger(t);if(e instanceof xe||e instanceof WeakMap||e instanceof Map){let n={},i=e.get(t,n);return i===n?new m(new y):new m(new _(i))}if(Number.isInteger(t)&&t<8&&e instanceof q){let n=0;for(let i of e){if(n===t)return new m(new _(i));n++}return new h("Indexable")}return r&&Array.isArray(e)||e&&typeof e=="object"||e&&Object.getPrototypeOf(e)===Object.prototype?t in e?new m(new _(e[t])):new m(new y):new h(r?"Indexable":"Dict")}function Ds(e,t,r,n,i){if(!(e instanceof q||Array.isArray(e))){let u=new ae("List",ie(e),i);return[i,q.fromArray([u])]}let s=[];for(let u of e){let a=t(u),[c,g]=a;if(g instanceof We){let[d,x]=r(a,n.toString());return[i,x]}s.push(c),n++}return[q.fromArray(s),i]}function Cs(e){return Number.isInteger(e)?new m(e):new h(0)}function Ns(e){return typeof e=="string"?new m(e):new h(0)}function Fs(e){return e==null}var ae=class extends l{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}},ce=class extends l{constructor(t){super(),this.function=t}};function se(e,t){let r=t.function(e),n=r[0],i=r[1];return i.hasLength(0)?new m(n):new h(i)}function kt(e){return new ce(t=>[e,o([])])}function Wl(e,t){return new ce(r=>{let n=e.function(r),i=n[0],s=n[1];return[t(i),s]})}function Jl(e,t,r){for(;;){let n=e,i=t,s=r;if(s.hasLength(0))return i;{let u=s.head,a=s.tail,c=u.function(n),g=c;if(c[1].hasLength(0))return g;e=n,t=i,r=a}}}function Pl(e,t){return new ce(r=>{let n=e.function(r),i=n;return n[1].hasLength(0)?i:Jl(r,i,t)})}function oi(e){return new ce(t=>{if(Fs(t))return[new y,o([])];{let n=e.function(t),i=n[0],s=n[1];return[new _(i),s]}})}function Yl(e,t){return o([new ae(e,ie(t),o([]))])}function Ws(e,t,r){let n=r(e);return n.isOk()?[n[0],o([])]:[n[0],o([new ae(t,ie(e),o([]))])]}function Hl(e){return v(!0,e)?[!0,o([])]:v(!1,e)?[!1,o([])]:[!1,Yl("Bool",e)]}function Ul(e){return Ws(e,"Int",Cs)}var zr=new ce(Hl),Ot=new ce(Ul);function Rl(e){return Ws(e,"String",Ns)}var z=new ce(Rl);function ui(e){return new ce(t=>Ds(t,e.function,(r,n)=>Br(r,o([n])),0,o([])))}function Br(e,t){let r=Pl(z,o([Wl(Ot,M)])),n=Y(t,s=>{let u=s,a=se(u,r);return a.isOk()?a[0]:"<"+ie(u)+">"}),i=Y(e[1],s=>{let u=s;return new ae(u.expected,u.found,yt(n,s.path))});return[e[0],i]}function Gl(e,t,r,n,i){for(;;){let s=e,u=t,a=r,c=n,g=i;if(s.hasLength(0)){let d=a(c);return Br(d,F(u))}else{let d=s.head,x=s.tail,w=zs(c,d);if(w.isOk()&&w[0]instanceof _){let $=w[0][0];e=x,t=p(d,u),r=a,n=$,i=g}else{if(w.isOk()&&w[0]instanceof y)return g(c,p(d,u));{let $=w[0],te=[a(c)[0],o([new ae($,ie(c),o([]))])];return Br(te,F(u))}}}}}function Js(e,t,r){return new ce(n=>{let i=Gl(e,o([]),t.function,n,(d,x)=>{let b=[t.function(d)[0],o([new ae("Field","Nothing",o([]))])];return Br(b,F(x))}),s=i[0],u=i[1],a=r(s).function(n),c=a[0],g=a[1];return[c,yt(u,g)]})}function H(e,t,r){return Js(o([e]),t,r)}function li(e,t,r){return e?t():r()}function Ps(e){return Object.fromEntries(e)}function Ys(){return null}function Hs(e){try{let t=JSON.parse(e);return new m(t)}catch(t){return new h(Vl(t,e))}}function Vl(e,t){return Kl(e)?new Cr:Ql(e,t)}function Kl(e){return/((unexpected (end|eof))|(end of data)|(unterminated string)|(json( parse error|\.parse)\: expected '(\:|\}|\])'))/i.test(e.message)}function Ql(e,t){let r=[Xl,ea,ra,ta];for(let n of r){let i=n(e,t);if(i)return i}return new Be("",0)}function Xl(e){let r=/unexpected token '(.)', ".+" is not valid JSON/i.exec(e.message);if(!r)return null;let n=Dr(r[1]);return new Be(n,-1)}function ea(e){let r=/unexpected token (.) in JSON at position (\d+)/i.exec(e.message);if(!r)return null;let n=Dr(r[1]),i=Number(r[2]);return new Be(n,i)}function ta(e,t){let n=/(unexpected character|expected .*) at line (\d+) column (\d+)/i.exec(e.message);if(!n)return null;let i=Number(n[2]),s=Number(n[3]),u=na(i,s,t),a=Dr(t[u]);return new Be(a,u)}function ra(e){let r=/unexpected (identifier|token) "(.)"/i.exec(e.message);if(!r)return null;let n=Dr(r[2]);return new Be(n,0)}function Dr(e){return"0x"+e.charCodeAt(0).toString(16).toUpperCase()}function na(e,t,r){if(e===1)return t-1;let n=1,i=0;return r.split("").find((s,u)=>(s===`
`&&(n+=1),n===e?(i=u+t,!0):!1)),i}var Cr=class extends l{},Be=class extends l{constructor(t){super(),this[0]=t}};var ci=class extends l{constructor(t){super(),this[0]=t}};function sa(e,t){return ni(Hs(e),r=>{let n=se(r,t);return Le(n,i=>new ci(i))})}function Us(e,t){return sa(e,t)}function je(e){return e}function T(e){return e}function Rs(){return Ys()}function Gs(e,t){if(e instanceof _){let r=e[0];return t(r)}else return Rs()}function ye(e){return Ps(e)}var Nr=class extends l{constructor(t){super(),this.all=t}};function Zs(e){return new Nr(o([t=>e(t.dispatch,t.emit,t.select,t.root)]))}function Vs(e,t){return Zs((r,n,i,s)=>n(e,t))}function J(){return new Nr(o([]))}var Lt=class extends l{constructor(t){super(),this.content=t}},A=class extends l{constructor(t,r,n,i,s,u,a){super(),this.key=t,this.namespace=r,this.tag=n,this.attrs=i,this.children=s,this.self_closing=u,this.void=a}},Xt=class extends l{constructor(t){super(),this.subtree=t}},jt=class extends l{constructor(t,r,n){super(),this[0]=t,this[1]=r,this.as_property=n}},er=class extends l{constructor(t,r){super(),this[0]=t,this[1]=r}};function ca(e){if(e instanceof jt)return new h(void 0);{let t=e[0],r=e[1],n=Ir(t,2);return new m([n,r])}}function fa(e,t,r){return qr(e,t,(n,i,s)=>{let u=r+"-"+M(s);return Ks(i,n,u)})}function Ks(e,t,r){for(;;){let n=e,i=t,s=r;if(n instanceof Lt)return i;if(n instanceof Xt){let u=n.subtree;e=u(),t=i,r=s}else{let u=n.attrs,a=n.children,c=le(u,i,(g,d)=>{let x=ca(d);if(x.isOk()){let w=x[0][0],$=x[0][1];return Ee(g,s+"-"+w,$)}else return g});return fa(a,c,s)}}}function Qs(e){return Ks(e,X(),"0")}function f(e,t){return new jt(e,t,!1)}function eo(e,t){return new er("on"+e,t)}function to(e){return f("style",le(e,"",(t,r)=>{let n=r[0],i=r[1];return t+n+":"+i+";"}))}function k(e){return f("class",e)}function fe(e){return f("id",e)}function ro(e){return f("value",e)}function pi(e){return f("placeholder",e)}function pe(e,t,r){return e==="area"?new A("","",e,t,o([]),!1,!0):e==="base"?new A("","",e,t,o([]),!1,!0):e==="br"?new A("","",e,t,o([]),!1,!0):e==="col"?new A("","",e,t,o([]),!1,!0):e==="embed"?new A("","",e,t,o([]),!1,!0):e==="hr"?new A("","",e,t,o([]),!1,!0):e==="img"?new A("","",e,t,o([]),!1,!0):e==="input"?new A("","",e,t,o([]),!1,!0):e==="link"?new A("","",e,t,o([]),!1,!0):e==="meta"?new A("","",e,t,o([]),!1,!0):e==="param"?new A("","",e,t,o([]),!1,!0):e==="source"?new A("","",e,t,o([]),!1,!0):e==="track"?new A("","",e,t,o([]),!1,!0):e==="wbr"?new A("","",e,t,o([]),!1,!0):new A("","",e,t,r,!1,!1)}function St(e,t,r,n){return new A("",e,t,r,n,!1,!1)}function tr(e){return new Lt(e)}function Se(e){return pe("lustre-fragment",o([to(o([["display","contents"]]))]),e)}var rr=class extends l{constructor(t){super(),this.dict=t}};function Wr(){return new rr(X())}function mi(e,t){let r=e.dict,n=ue(r,t);return qs(n)}function no(e,t){return new rr(Xn(e.dict,t))}var pa=void 0;function $i(e,t){return new rr(Ee(e.dict,t,pa))}var Jr=class extends l{constructor(t){super(),this[0]=t}},Pr=class extends l{constructor(t,r){super(),this[0]=t,this[1]=r}},Yr=class extends l{constructor(t,r){super(),this[0]=t,this[1]=r}};function oo(e){return v(e.created,X())&&v(e.removed,Wr())&&v(e.updated,X())}var Hr=class extends l{constructor(t){super(),this[0]=t}},Ur=class extends l{constructor(t,r){super(),this[0]=t,this[1]=r}},At=class extends l{constructor(t){super(),this[0]=t}},V=class extends l{constructor(t){super(),this[0]=t}},Mt=class extends l{constructor(t,r){super(),this[0]=t,this[1]=r}},Rr=class extends l{constructor(t,r){super(),this[0]=t,this[1]=r}};var ir=class extends l{},Gr=class extends l{constructor(t,r){super(),this[0]=t,this[1]=r}},Zr=class extends l{constructor(t){super(),this[0]=t}},sr=class extends l{constructor(t){super(),this[0]=t}};var hi=class extends l{constructor(t,r,n,i){super(),this.init=t,this.update=r,this.view=n,this.on_attribute_change=i}};var Vr=class extends l{constructor(t){super(),this.name=t}},Kr=class extends l{constructor(t){super(),this.name=t}},Qr=class extends l{constructor(t){super(),this.selector=t}},or=class extends l{};function uo(e,t,r,n){return new hi(e,t,r,new _(n))}globalThis.customElements&&!globalThis.customElements.get("lustre-fragment")&&globalThis.customElements.define("lustre-fragment",class extends HTMLElement{constructor(){super()}});function ar(e,t,r){let n,i=[{prev:e,next:t,parent:e.parentNode}];for(;i.length;){let{prev:s,next:u,parent:a}=i.pop();for(;u.subtree!==void 0;)u=u.subtree();if(u.content!==void 0)if(s)if(s.nodeType===Node.TEXT_NODE)s.textContent!==u.content&&(s.textContent=u.content),n??=s;else{let c=document.createTextNode(u.content);a.replaceChild(c,s),n??=c}else{let c=document.createTextNode(u.content);a.appendChild(c),n??=c}else if(u.tag!==void 0){let c=wa({prev:s,next:u,dispatch:r,stack:i});s?s!==c&&a.replaceChild(c,s):a.appendChild(c),n??=c}}return n}function wa({prev:e,next:t,dispatch:r,stack:n}){let i=t.namespace||"http://www.w3.org/1999/xhtml",s=e&&e.nodeType===Node.ELEMENT_NODE&&e.localName===t.tag&&e.namespaceURI===(t.namespace||"http://www.w3.org/1999/xhtml"),u=s?e:i?document.createElementNS(i,t.tag):document.createElement(t.tag),a;if(ur.has(u))a=ur.get(u);else{let O=new Map;ur.set(u,O),a=O}let c=s?new Set(a.keys()):null,g=s?new Set(Array.from(e.attributes,O=>O.name)):null,d=null,x=null,w=null;if(s&&t.tag==="textarea"){let O=t.children[Symbol.iterator]().next().value?.content;O!==void 0&&(u.value=O)}let $=[];for(let O of t.attrs){let L=O[0],C=O[1];if(O.as_property)u[L]!==C&&(u[L]=C),s&&g.delete(L);else if(L.startsWith("on")){let me=L.slice(2),Tn=r(C,me==="input");a.has(me)||u.addEventListener(me,lr),a.set(me,Tn),s&&c.delete(me)}else if(L.startsWith("data-lustre-on-")){let me=L.slice(15),Tn=r(ga);a.has(me)||u.addEventListener(me,lr),a.set(me,Tn),u.setAttribute(L,C),s&&(c.delete(me),g.delete(L))}else L.startsWith("delegate:data-")||L.startsWith("delegate:aria-")?(u.setAttribute(L,C),$.push([L.slice(10),C])):L==="class"?d=d===null?C:d+" "+C:L==="style"?x=x===null?C:x+C:L==="dangerous-unescaped-html"?w=C:(u.getAttribute(L)!==C&&u.setAttribute(L,C),(L==="value"||L==="selected")&&(u[L]=C),s&&g.delete(L))}if(d!==null&&(u.setAttribute("class",d),s&&g.delete("class")),x!==null&&(u.setAttribute("style",x),s&&g.delete("style")),s){for(let O of g)u.removeAttribute(O);for(let O of c)a.delete(O),u.removeEventListener(O,lr)}if(t.tag==="slot"&&window.queueMicrotask(()=>{for(let O of u.assignedElements())for(let[L,C]of $)O.hasAttribute(L)||O.setAttribute(L,C)}),t.key!==void 0&&t.key!=="")u.setAttribute("data-lustre-key",t.key);else if(w!==null)return u.innerHTML=w,u;let b=u.firstChild,G=null,te=null,de=null,Mn=Xr(t).next().value;if(s&&Mn!==void 0&&Mn.key!==void 0&&Mn.key!==""){G=new Set,te=lo(e),de=lo(t);for(let O of Xr(t))b=ya(b,O,u,n,de,te,G)}else for(let O of Xr(t))n.unshift({prev:b,next:O,parent:u}),b=b?.nextSibling;for(;b;){let O=b.nextSibling;u.removeChild(b),b=O}return u}var ur=new WeakMap;function lr(e){let t=e.currentTarget;if(!ur.has(t)){t.removeEventListener(e.type,lr);return}let r=ur.get(t);if(!r.has(e.type)){t.removeEventListener(e.type,lr);return}r.get(e.type)(e)}function ga(e){let t=e.currentTarget,r=t.getAttribute(`data-lustre-on-${e.type}`),n=JSON.parse(t.getAttribute("data-lustre-data")||"{}"),i=JSON.parse(t.getAttribute("data-lustre-include")||"[]");switch(e.type){case"input":case"change":i.push("target.value");break}return{tag:r,data:i.reduce((s,u)=>{let a=u.split(".");for(let c=0,g=s,d=e;c<a.length;c++)c===a.length-1?g[a[c]]=d[a[c]]:(g[a[c]]??={},d=d[a[c]],g=g[a[c]]);return s},{data:n})}}function lo(e){let t=new Map;if(e)for(let r of Xr(e)){let n=r?.key||r?.getAttribute?.("data-lustre-key");n&&t.set(n,r)}return t}function ya(e,t,r,n,i,s,u){for(;e&&!i.has(e.getAttribute("data-lustre-key"));){let c=e.nextSibling;r.removeChild(e),e=c}if(s.size===0)return n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e;if(u.has(t.key))return console.warn(`Duplicate key found in Lustre vnode: ${t.key}`),n.unshift({prev:null,next:t,parent:r}),e;u.add(t.key);let a=s.get(t.key);if(!a&&!e)return n.unshift({prev:null,next:t,parent:r}),e;if(!a&&e!==null){let c=document.createTextNode("");return r.insertBefore(c,e),n.unshift({prev:c,next:t,parent:r}),e}return!a||a===e?(n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e):(r.insertBefore(a,e),n.unshift({prev:a,next:t,parent:r}),e)}function*Xr(e){for(let t of e.children)yield*ao(t)}function*ao(e){e.subtree!==void 0?yield*ao(e.subtree()):yield e}var gi=class e{static start({init:t,update:r,view:n},i,s){if(!wi())return new h(new or);let u=i instanceof HTMLElement?i:document.querySelector(i);if(!u)return new h(new Qr(i));let a=new e(u,t(s),r,n);return new m(c=>a.send(c))}constructor(t,[r,n],i,s){this.root=t,this.#e=r,this.#s=i,this.#r=s,this.#t=window.setTimeout(()=>this.#i(n.all.toArray(),!0),0)}root;send(t){if(t instanceof At){if(t[0]instanceof sr){this.#t=window.clearTimeout(this.#t),this.#n=[],this.#e=t[0][0];let r=this.#r(this.#e),n=(s,u=!1)=>a=>{let c=s(a);c instanceof m&&this.send(new V(c[0],u))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));ar(i,r,n)}}else if(t instanceof V){let r=t[0],n=t[1]??!1;this.#n.push(r),n?(this.#t=window.clearTimeout(this.#t),this.#i()):this.#t||(this.#t=window.setTimeout(()=>this.#i()))}else if(t instanceof Mt){let r=t[0],n=t[1];this.root.dispatchEvent(new CustomEvent(r,{detail:n,bubbles:!0,composed:!0}))}else if(t instanceof ir)for(this.#t=window.clearTimeout(this.#t),this.#e=null,this.#s=null,this.#r=null,this.#n=null;this.root.firstChild;)this.root.firstChild.remove()}#e;#s;#r;#n=[];#t;#i(t=[]){this.#t=void 0,this.#o(t);let r=this.#r(this.#e),n=(s,u=!1)=>a=>{let c=s(a);c instanceof m&&this.send(new V(c[0],u))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));ar(i,r,n)}#o(t=[]){for(;this.#n.length>0;){let r=this.#n.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;){let r=t.shift(),n=a=>this.send(new V(a)),i=(a,c)=>this.root.dispatchEvent(new CustomEvent(a,{detail:c,bubbles:!0,composed:!0})),s=()=>{},u=this.root;r({dispatch:n,emit:i,select:s,root:u})}this.#n.length>0&&this.#o(t)}},ha=gi.start,xi=({init:e,update:t,view:r,on_attribute_change:n},i)=>{if(!wi())return new h(new or);if(!i.includes("-"))return new h(new Vr(i));if(window.customElements.get(i))return new h(new Kr(i));let[s,u]=e(void 0),a=n instanceof _,c=class extends HTMLElement{static get observedAttributes(){return a?n[0].entries().map(([d])=>d):[]}constructor(){super(),this.attachShadow({mode:"open"}),this.internals=this.attachInternals(),a&&n[0].forEach((d,x)=>{let w=`__mirrored__${x}`;Object.defineProperty(this,x,{get(){return this[w]},set($){let b=this[w];if(this.#t&&v(b,$))return;this[w]=$;let G=d($);G instanceof h||(this.#r.push(G[0]),this.#t&&!this.#n&&(this.#n=window.requestAnimationFrame(()=>this.#i())))}})})}connectedCallback(){this.#u().finally(()=>{this.#i(u.all.toArray(),!0),this.#t=!0})}attributeChangedCallback(d,x,w){x!==w&&(this[d]=w)}disconnectedCallback(){this.#s=null,this.#r=[],this.#n=window.cancelAnimationFrame(this.#n),this.#t=!1}send(d){if(d instanceof At){if(d[0]instanceof sr){this.#n=window.cancelAnimationFrame(this.#n),this.#r=[],this.#s=d[0][0];let x=r(this.#s),w=(b,G=!1)=>te=>{let de=b(te);de instanceof m&&this.send(new V(de[0],G))},$=this.shadowRoot.childNodes[this.#e.length]??this.shadowRoot.appendChild(document.createTextNode(""));ar($,x,w)}}else if(d instanceof V){let x=d[0],w=d[1]??!1;this.#r.push(x),w?(this.#n=window.cancelAnimationFrame(this.#n),this.#i()):this.#n||(this.#n=window.requestAnimationFrame(()=>this.#i()))}else if(d instanceof Mt){let x=d[0],w=d[1];this.dispatchEvent(new CustomEvent(x,{detail:w,bubbles:!0,composed:!0}))}}#e=[];#s=s;#r=[];#n;#t=!0;#i(d=[]){if(!this.#t)return;this.#n=void 0,this.#o(d);let x=r(this.#s),w=(b,G=!1)=>te=>{let de=b(te);de instanceof m&&this.send(new V(de[0],G))},$=this.shadowRoot.childNodes[this.#e.length]??this.shadowRoot.appendChild(document.createTextNode(""));ar($,x,w)}#o(d=[]){for(;this.#r.length>0;){let x=this.#r.shift(),[w,$]=t(this.#s,x);d=d.concat($.all.toArray()),this.#s=w}for(;d.length>0;){let x=d.shift(),w=te=>this.send(new V(te)),$=(te,de)=>this.dispatchEvent(new CustomEvent(te,{detail:de,bubbles:!0,composed:!0})),b=()=>{},G=this.shadowRoot;x({dispatch:w,emit:$,select:b,root:G})}this.#r.length>0&&this.#o(d)}async#u(){let d=[];for(let w of document.querySelectorAll("link[rel=stylesheet]"))w.sheet||d.push(new Promise(($,b)=>{w.addEventListener("load",$),w.addEventListener("error",b)}));for(await Promise.allSettled(d);this.#e.length;)this.#e.shift().remove(),this.shadowRoot.firstChild.remove();this.shadowRoot.adoptedStyleSheets=this.getRootNode().adoptedStyleSheets;let x=[];for(let w of document.styleSheets)try{this.shadowRoot.adoptedStyleSheets.push(w)}catch{try{let $=new CSSStyleSheet;for(let b of w.cssRules)$.insertRule(b.cssText,$.cssRules.length);this.shadowRoot.adoptedStyleSheets.push($)}catch{let $=w.ownerNode.cloneNode();this.shadowRoot.prepend($),this.#e.push($),x.push(new Promise((b,G)=>{$.onload=b,$.onerror=G}))}}return Promise.allSettled(x)}};return window.customElements.define(i,c),new m(void 0)},yi=class e{static start({init:t,update:r,view:n,on_attribute_change:i},s){let u=new e(t(s),r,n,i);return new m(a=>u.send(a))}constructor([t,r],n,i,s){this.#e=t,this.#s=n,this.#n=i,this.#t=i(t),this.#u=s,this.#i=new Map,this.#o=Qs(this.#t),this.#l(r.all.toArray())}send(t){if(t instanceof Hr){for(let r of t[0]){let n=this.#u.get(r[0]);if(!n)continue;let i=n(r[1]);i instanceof h||this.#r.push(i)}this.#l()}else if(t instanceof Ur)this.#r=this.#r.concat(t[0].toArray()),this.#l(t[1].all.toArray());else if(!(t instanceof At))if(t instanceof V)this.#r.push(t[0]),this.#l();else if(t instanceof Mt){let r=new Pr(t[0],t[1]);for(let[n,i]of this.#i)i(r)}else if(t instanceof Rr){let r=this.#o.get(t[0]);if(!r)return;let n=r(t[1]);if(n instanceof h)return;this.#r.push(n[0]),this.#l()}else if(t instanceof Gr){let r=Qn(this.#u),n=new Yr(r,this.#t);this.#i=this.#i.set(t[0],t[1]),t[1](n)}else t instanceof Zr&&(this.#i=this.#i.delete(t[0]))}#e;#s;#r;#n;#t;#i;#o;#u;#l(t=[]){this.#a(t);let r=this.#n(this.#e),n=elements(this.#t,r);if(!oo(n)){let i=new Jr(n);for(let[s,u]of this.#i)u(i)}this.#t=r,this.#o=n.handlers}#a(t=[]){for(;this.#r.length>0;){let r=this.#r.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;)t.shift()({dispatch:a=>this.send(new V(a)),emit:(a,c)=>this.root.dispatchEvent(new CustomEvent(a,{detail:c,bubbles:!0,composed:!0})),select:()=>{},root:null});this.#r.length>0&&this.#a(t)}},xa=yi.start,wi=()=>globalThis.window&&window.document;function co(e,t,r){return e?t():r()}var ze=class extends l{constructor(t,r){super(),this.seconds=t,this.nanoseconds=r}};function bi(e){let t=1e9,r=K(e.nanoseconds,t),n=e.nanoseconds-r,i=e.seconds+I(n,t);return r>=0?new ze(i,r):new ze(i-1,t+r)}function fo(e,t){let r=new ze(t.seconds-e.seconds,t.nanoseconds-e.nanoseconds);return bi(r)}function cr(e,t){let r=new ze(e.seconds+t.seconds,e.nanoseconds+t.nanoseconds);return bi(r)}function fr(e){return new ze(e,0)}function en(e){let t=new ze(0,e);return bi(t)}function pr(e){return[e.seconds,e.nanoseconds]}var U=864e8;function $o(e){return e*U}function ho(e){return I(e,U)}var go=1,un=0,Fa=0,Wa=0,yo=!1,bo=!1,ln=0;function xo(){return Date.now()*1e3+ln}function wo(){return Math.trunc(performance.now()*1e3)+ln}function ki(){if(bo)return un+ln;if(yo){let e=xo()-Fa,t=Math.trunc(e*go);return un+t}return xo()}function Oi(){return-new Date().getTimezoneOffset()}function vo(){if(bo)return un+ln;if(yo){let e=wo()-Wa,t=Math.trunc(e*go);return un+t}return wo()}var Ja=1;function ko(){return Ja++}var Li=class extends l{constructor(t,r,n,i){super(),this.timestamp_utc_us=t,this.offset_local_us=r,this.monotonic_us=n,this.unique=i}},an=class extends l{constructor(t,r,n){super(),this.date=t,this.time=r,this.offset=n}};var Et=class extends l{constructor(t,r){super(),this.date=t,this.time=r}},ji=class extends l{constructor(t){super(),this.minutes=t}},qt=class extends l{constructor(t){super(),this.unix_days=t}};var De=class extends l{constructor(t){super(),this.microseconds=t}},Si=class extends l{},_r=class extends l{constructor(t){super(),this.microseconds=t}};function Io(e){return e.unique}function Bo(e,t,r){return new an(e,t,r)}function zo(e){return new Et(e.date,e.time)}function Ei(e){return e.date}function qi(e){return e.time}function Do(e){return new qt(I(e,86400))}function Co(e){return new qt(I(e,U))}function No(e){return Co(e.timestamp_utc_us)}function Fo(e){return e.unix_days*86400}function Wo(e,t){return new qt(e.unix_days+t)}function Jo(e,t){return new qt(e.unix_days-t)}function cn(e){if(e instanceof De&&e.microseconds<0){let t=e.microseconds;return new De(U+K(t,U))}else if(e instanceof De&&e.microseconds>=U){let t=e.microseconds;return new De(K(t,U))}else return e}function It(e){return new De(e)}function Ae(e){let t=cn(e);if(t instanceof De)return t.microseconds;if(t instanceof Si)return U;{let r=t.microseconds;return U+r}}function Po(e){return It(K(e,U))}function Yo(e){return Po(e.timestamp_utc_us)}function Ze(e){return en(e*1e3)}function Ra(e){let t=-e.minutes*6e7;return Ze(t)}function Ii(e){let t=Ae(e);return Ze(t)}function Ge(e){let t=pr(e),r=t[0],n=t[1];return r*1e6+I(n,1e3)}function Ho(e,t){let r=Ge(t);if(r===0)return e;if(e instanceof _r&&r+e.microseconds<1e6){let i=e.microseconds;return new _r(i+r)}else if(e instanceof _r){let i=Ae(e)+(r-1e6),s=It(i);return cn(s)}else{let i=Ae(e)+r,s=It(i);return cn(s)}}function Uo(e,t){if(Ge(t)===0)return e;{let n=Ae(e)-Ge(t),i=It(n);return cn(i)}}function Ga(e,t){let r=fr(e);return cr(r,en(t))}function Bi(e){let r=$o(e);return Ze(r)}function Ro(e,t){return cr(e,t)}function zi(e){let t=pr(e),r=t[0],n=t[1];if(r>=0&&n>=0)return e;{let s=r<0?-r:r,u=n<0?-n:n;return Ga(s,u)}}function Go(e){return fo(e,fr(0))}function fn(e,t){return cr(e,Go(t))}function Di(e){let t=pr(e),r=t[0],n=t[1];return r>=0&&n>=0}function Ci(e){let t=Ge(e);return ho(t)}function Zo(e){return Ge(e)}function Vo(){return Oi()*6e7}function Ko(){return new Li(ki(),Vo(),vo(),ko())}var dr=new ji(0);function Qo(e){return new an(No(e),Yo(e),dr)}function Xo(e,t){return li(!Di(t),()=>Ni(e,zi(t)),()=>{let r=Ci(t),n=fn(t,Bi(r)),i=(()=>{let x=e.time,w=Ii(x),$=fn(w,n);return Zo($)})(),s=i<0?[i+U,r+1]:[i,r],u=s[0],a=s[1],c=Ze(Ae(e.time)-u),g=(()=>{let x=e.date;return Jo(x,a)})(),d=(()=>{let x=e.time;return Uo(x,c)})();return new Et(g,d)})}function Ni(e,t){return li(!Di(t),()=>Xo(e,zi(t)),()=>{let r=Ci(t),n=fn(t,Bi(r)),i=(()=>{let x=e.time,w=Ii(x),$=Ro(w,n);return Zo($)})(),s=i>=U?[i-U,r+1]:[i,r],u=s[0],a=s[1],c=Ze(u-Ae(e.time)),g=(()=>{let x=e.date;return Wo(x,a)})(),d=(()=>{let x=e.time;return Ho(x,c)})();return new Et(g,d)})}function eu(e){let t=(()=>{let n=zo(e);return Ni(n,Ra(e.offset))})();return new Et(t.date,t.time)}function Ji(e){return Do(e)}function Pi(e){return Fo(e)}function pn(e){return Ji(I(e,1e3))}function _n(e){return Pi(e)*1e3}function uu(e){let t=(e-_n(pn(e)))*1e3;return It(t)}function _c(e,t,r){return Bo(e,t,r)}function Hi(e){return _c(pn(e),uu(e),dr)}function dc(e){return eu(e)}function mr(e){let t=dc(e);return _n(Ei(t))+I(Ae(qi(t)),1e3)}function lu(){return Ko()}function au(e){return Qo(e)}function cu(e){return Io(e)}function _e(e){return tr(e)}function fu(e,t){return pe("style",e,o([_e(t)]))}function R(e,t){return pe("div",e,t)}function Ui(e){return pe("hr",e,o([]))}function $r(e,t){return pe("p",e,t)}function Ri(e,t){return pe("span",e,t)}function Ne(e,t){return pe("button",e,t)}function pu(e){return pe("input",e,o([]))}function _u(e,t){return pe("textarea",e,o([tr(t)]))}function Ve(e,t){return Vs(e,t)}function Bt(e,t){return eo(e,t)}function Fe(e){return Bt("click",t=>new m(e))}function Gi(e){return Bt("focus",t=>new m(e))}function Zi(e){return Bt("blur",t=>new m(e))}function xc(e){let t=e;return ii("target",ii("value",Is))(t)}function Vi(e){return Bt("input",t=>{let r=xc(t);return Oe(r,e)})}var $n="http://www.w3.org/2000/svg";function Ki(e){return St($n,"line",e,o([]))}function Qi(e){return St($n,"polyline",e,o([]))}function Ke(e,t){return St($n,"svg",e,t)}function E(e){return St($n,"path",e,o([]))}function mu(e){return Ke(p(f("stroke-linejoin","round"),p(f("stroke-linecap","round"),p(f("stroke-width","2"),p(f("stroke","currentColor"),p(f("fill","none"),p(f("viewBox","0 0 24 24"),p(f("height","24"),p(f("width","24"),e)))))))),o([E(o([f("d","M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z")])),E(o([f("d","M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1")]))]))}function $u(e){return Ke(p(f("stroke-linejoin","round"),p(f("stroke-linecap","round"),p(f("stroke-width","2"),p(f("stroke","currentColor"),p(f("fill","none"),p(f("viewBox","0 0 24 24"),p(f("height","24"),p(f("width","24"),e)))))))),o([E(o([f("d","M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13")])),E(o([f("d","m8 6 2-2")])),E(o([f("d","m18 16 2-2")])),E(o([f("d","m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17")])),E(o([f("d","M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z")])),E(o([f("d","m15 5 4 4")]))]))}function hu(e){return Ke(p(f("stroke-linejoin","round"),p(f("stroke-linecap","round"),p(f("stroke-width","2"),p(f("stroke","currentColor"),p(f("fill","none"),p(f("viewBox","0 0 24 24"),p(f("height","24"),p(f("width","24"),e)))))))),o([E(o([f("d","m3 10 2.5-2.5L3 5")])),E(o([f("d","m3 19 2.5-2.5L3 14")])),E(o([f("d","M10 6h11")])),E(o([f("d","M10 12h11")])),E(o([f("d","M10 18h11")]))]))}function xu(e){return Ke(p(f("stroke-linejoin","round"),p(f("stroke-linecap","round"),p(f("stroke-width","2"),p(f("stroke","currentColor"),p(f("fill","none"),p(f("viewBox","0 0 24 24"),p(f("height","24"),p(f("width","24"),e)))))))),o([Qi(o([f("points","15 3 21 3 21 9")])),Qi(o([f("points","9 21 3 21 3 15")])),Ki(o([f("y2","10"),f("y1","3"),f("x2","14"),f("x1","21")])),Ki(o([f("y2","14"),f("y1","21"),f("x2","10"),f("x1","3")]))]))}function Xi(e){return Ke(p(f("stroke-linejoin","round"),p(f("stroke-linecap","round"),p(f("stroke-width","2"),p(f("stroke","currentColor"),p(f("fill","none"),p(f("viewBox","0 0 24 24"),p(f("height","24"),p(f("width","24"),e)))))))),o([E(o([f("d","M18 6 6 18")])),E(o([f("d","m6 6 12 12")]))]))}function wu(e){return Ke(p(f("stroke-linejoin","round"),p(f("stroke-linecap","round"),p(f("stroke-width","2"),p(f("stroke","currentColor"),p(f("fill","none"),p(f("viewBox","0 0 24 24"),p(f("height","24"),p(f("width","24"),e)))))))),o([E(o([f("d","M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z")])),E(o([f("d","m15 5 4 4")]))]))}var gu="line-discussion";var hr=class extends l{constructor(t,r,n,i,s,u,a,c){super(),this.note_id=t,this.parent_id=r,this.significance=n,this.user_name=i,this.message=s,this.expanded_message=u,this.time=a,this.modifier=c}},Qe=class extends l{},Xe=class extends l{},et=class extends l{},zt=class extends l{},tt=class extends l{},Dt=class extends l{},Ct=class extends l{},Nt=class extends l{},Ft=class extends l{},Wt=class extends l{},Jt=class extends l{},xr=class extends l{},wr=class extends l{},Pt=class extends l{};function bc(e){return e instanceof Qe?1:e instanceof Xe?2:e instanceof et?3:e instanceof zt?4:e instanceof tt?5:e instanceof Dt?6:e instanceof Ct?7:e instanceof Nt?8:e instanceof Ft?9:e instanceof Wt?10:e instanceof Jt?11:12}function vc(e){return e instanceof wr?0:e instanceof Pt?1:2}function yu(e){return ye(o([["n",je(e.note_id)],["p",je(e.parent_id)],["s",T((()=>{let t=e.significance;return bc(t)})())],["u",je(e.user_name)],["m",je(e.message)],["x",Gs(e.expanded_message,je)],["t",T((()=>{let t=e.time;return mr(t)})())],["d",T((()=>{let t=e.modifier;return vc(t)})())]]))}var es=class extends l{constructor(t,r,n,i,s,u,a,c){super(),this.note_id=t,this.parent_id=r,this.significance=n,this.user_name=i,this.message=s,this.expanded_message=u,this.time=a,this.edited=c}},rt=class extends l{},nt=class extends l{},it=class extends l{},st=class extends l{},ot=class extends l{},ut=class extends l{},lt=class extends l{},gr=class extends l{},at=class extends l{},ct=class extends l{},ft=class extends l{},pt=class extends l{},_t=class extends l{},dt=class extends l{},mt=class extends l{},$t=class extends l{},ht=class extends l{},yr=class extends l{};function kc(e){if(e===0)return new rt;if(e===1)return new nt;if(e===2)return new it;if(e===3)return new st;if(e===4)return new ot;if(e===5)return new ut;if(e===6)return new lt;if(e===7)return new gr;if(e===8)return new at;if(e===9)return new ct;if(e===10)return new ft;if(e===11)return new pt;if(e===12)return new _t;if(e===13)return new dt;if(e===14)return new mt;if(e===15)return new $t;if(e===16)return new ht;if(e===17)return new yr;throw oe("panic","o11a/computed_note",128,"significance_from_int","Invalid note significance found",{})}function Oc(){return H("n",z,e=>H("p",z,t=>H("s",Ot,r=>H("u",z,n=>H("m",z,i=>H("x",oi(z),s=>H("t",Ot,u=>H("e",zr,a=>kt(new es(e,t,kc(r),n,i,s,Hi(u),a))))))))))}function vu(e){return e instanceof rt?new y:e instanceof nt?new _("Unanswered Question"):e instanceof it?new _("Answered"):e instanceof st?new _("Answer"):e instanceof ot?new _("Incomplete ToDo"):e instanceof ut?new _("Complete"):e instanceof lt?new _("Completion"):e instanceof gr?new _("Unconfirmed Finding"):e instanceof at?new _("Confirmed Finding"):e instanceof ct?new _("Rejected Finding"):e instanceof ft?new _("Confirmation"):e instanceof pt?new _("Rejection"):e instanceof _t?new _("Unanswered Dev Question"):e instanceof dt?new _("Answered Dev Question"):e instanceof mt?new _("Info"):e instanceof $t?new _("Incorrect Info"):e instanceof ht?new _("Rejection"):new _("Confirmation")}function ku(e){return e instanceof rt?!1:e instanceof nt||e instanceof it?!0:e instanceof st?!1:e instanceof ot||e instanceof ut?!0:e instanceof lt?!1:e instanceof gr||e instanceof at||e instanceof ct?!0:e instanceof ft||e instanceof pt?!1:e instanceof _t||e instanceof dt||e instanceof mt||e instanceof $t?!0:(e instanceof ht,!1)}function Lc(){return H("note_id",z,e=>H("thread_notes",ui(Oc()),t=>kt([e,t])))}function Ou(e){return Z(se(e,z),t=>{let r=Us(t,ui(Lc()));return Ue(r,o([new ae("json-encoded computed note",Ie(t),o([]))]))})}var Lu="user-submitted-line-note",ju="user-clicked-discussion-preview",ts="user-focused-input",Su="user-unfocused-input",Au="user-maximized-thread";function rs(e){return Bt("keydown",t=>{let r=H("ctrlKey",zr,i=>H("key",z,s=>kt([i,s]))),n=o([new N("","",o([]))]);return Z((()=>{let i=se(t,r);return Ue(i,n)})(),i=>{let s=i[0],u=i[1];return s&&u==="Enter"?new m(e):new h(n)})})}var D=class extends l{constructor(t,r,n,i,s,u,a,c,g,d,x,w,$,b){super(),this.user_name=t,this.line_number=r,this.line_id=n,this.line_tag=i,this.line_number_text=s,this.notes=u,this.current_note_draft=a,this.current_thread_id=c,this.current_thread_notes=g,this.active_thread=d,this.show_expanded_message_box=x,this.current_expanded_message_draft=w,this.expanded_messages=$,this.editing_note=b}},ns=class extends l{constructor(t,r,n,i){super(),this.current_thread_id=t,this.parent_note=r,this.prior_thread_id=n,this.prior_thread=i}},hn=class extends l{constructor(t){super(),this[0]=t}},xn=class extends l{constructor(t){super(),this[0]=t}},wn=class extends l{constructor(t){super(),this[0]=t}},gn=class extends l{constructor(t){super(),this[0]=t}},br=class extends l{},yn=class extends l{constructor(t,r){super(),this.new_thread_id=t,this.parent_note=r}},bn=class extends l{},vn=class extends l{constructor(t){super(),this[0]=t}},kn=class extends l{constructor(t){super(),this[0]=t}},On=class extends l{constructor(t){super(),this.for_note_id=t}},is=class extends l{},Ln=class extends l{},jn=class extends l{},vr=class extends l{},Sn=class extends l{},An=class extends l{constructor(t){super(),this[0]=t}},ss=class extends l{};function Mc(e){return[new D("guest",0,"","","",X(),"","",o([]),new y,!1,new y,Wr(),new y),J()]}function Tc(e){let t=e.active_thread;if(t instanceof _){let r=t[0];return R(o([]),o([R(o([k("flex justify-end width-full")]),o([Ne(o([Fe(new bn),k("icon-button flex gap-[.5rem] pl-[.5rem] pr-[.3rem] pt-[.3rem] pb-[.1rem] mb-[.25rem]")]),o([_e("Close Thread"),Xi(o([]))]))])),_e("Current Thread: "),_e(r.parent_note.message),(()=>{let n=r.parent_note.expanded_message;if(n instanceof _){let i=n[0];return R(o([k("mt-[.5rem]")]),o([$r(o([]),o([_e(i)]))]))}else return Se(o([]))})(),Ui(o([k("mt-[.5rem]")]))]))}else return R(o([k("flex items-center justify-between width-full")]),o([Ri(o([k("pt-[.1rem]")]),o([_e(e.line_tag)])),Ne(o([Fe(new Sn),k("icon-button p-[.3rem] ")]),o([xu(o([]))]))]))}function Ec(e){let t="input-border rounded-md text-[0.65rem] pb-[0.15rem] pt-1 px-[0.5rem]",r=vu(e);if(r instanceof _){let n=r[0];return Ri(o([k(t)]),o([_e(n)]))}else return Se(o([]))}function qc(e){return Y(e.current_thread_notes,t=>R(o([k("line-discussion-item")]),o([R(o([k("flex justify-between mb-[.2rem]")]),o([R(o([k("flex gap-[.5rem] items-start")]),o([$r(o([]),o([_e(t.user_name)])),Ec(t.significance)])),R(o([k("flex gap-[.5rem]")]),o([Ne(o([fe("edit-message-button"),k("icon-button p-[.3rem]"),Fe(new An(t))]),o([wu(o([]))])),t.expanded_message instanceof _?Ne(o([fe("expand-message-button"),k("icon-button p-[.3rem]"),Fe(new On(t.note_id))]),o([hu(o([]))])):Se(o([])),ku(t.significance)?Ne(o([fe("switch-thread-button"),k("icon-button p-[.3rem]"),Fe(new yn(t.note_id,t))]),o([mu(o([]))])):Se(o([]))]))])),$r(o([]),o([_e(t.message)])),mi(e.expanded_messages,t.note_id)?R(o([k("mt-[.5rem]")]),o([$r(o([]),o([_e((()=>{let n=t.expanded_message;return Or(n,"")})())]))])):Se(o([])),Ui(o([k("mt-[.5rem]")]))])))}function Ic(e){return R(o([k("flex justify-between items-center gap-[.35rem]")]),o([Ne(o([fe("toggle-expanded-message-button"),k("icon-button p-[.3rem]"),Fe(new vn(!e.show_expanded_message_box))]),o([$u(o([]))])),e.editing_note instanceof _?Ne(o([fe("cancel-message-edit-button"),k("icon-button p-[.3rem]"),Fe(new ss)]),o([Xi(o([]))])):Se(o([])),pu(o([fe("new-comment-input"),k("inline-block w-full grow text-[0.9rem] pl-2 pb-[.2rem] p-[0.3rem] border-[none] border-t border-solid;"),pi("Add a new comment"),Vi(t=>new gn(t)),Gi(new Ln),Zi(new vr),rs(new br),ro(e.current_note_draft)]))]))}function Bc(e){let t="absolute overlay p-[.5rem] flex w-[100%] h-60 mt-2",r="grow text-[.95rem] resize-none p-[.3rem]";return R(o([fe("expanded-message"),e.show_expanded_message_box?k(t+" show-exp"):k(t)]),o([_u(o([fe("expanded-message-box"),k(r),pi("Write an expanded message body"),Vi(n=>new kn(n)),Gi(new jn),Zi(new vr),rs(new br)]),(()=>{let n=e.current_expanded_message_draft;return Or(n,"")})())]))}function zc(e,t){if(t){if(e==="done")return[new tt,"done"];if(e.startsWith("done: ")){let r=e.slice(6);return[new tt,r]}else if(e.startsWith("a: ")){let r=e.slice(3);return[new et,r]}else if(e.startsWith("answer: ")){let r=e.slice(8);return[new et,r]}else if(e.startsWith("reject: ")){let r=e.slice(8);return[new Nt,r]}else if(e.startsWith("confirm: ")){let r=e.slice(9);return[new Ct,r]}else if(e.startsWith("incorrect: ")){let r=e.slice(11);return[new Jt,r]}else if(e.startsWith("correct: ")){let r=e.slice(9);return[new xr,r]}else return[new Qe,e]}else if(e.startsWith("todo: ")){let r=e.slice(6);return[new zt,r]}else if(e.startsWith("q: ")){let r=e.slice(3);return[new Xe,r]}else if(e.startsWith("question: ")){let r=e.slice(10);return[new Xe,r]}else if(e.startsWith("finding: ")){let r=e.slice(9);return[new Dt,r]}else if(e.startsWith("dev: ")){let r=e.slice(5);return[new Ft,r]}else if(e.startsWith("info: ")){let r=e.slice(6);return[new Wt,r]}else return[new Qe,e]}function Dc(e){return e instanceof st?"a: ":e instanceof dt?"dev: ":e instanceof it?"q: ":e instanceof rt?"":e instanceof ut?"todo: ":e instanceof at?"finding: ":e instanceof ft?"confirm: ":e instanceof pt?"reject: ":e instanceof ot?"todo: ":e instanceof mt?"info: ":e instanceof yr?"correct: ":e instanceof ht?"incorrect: ":e instanceof ct?"finding: ":e instanceof $t?"info: ":e instanceof lt?"done: ":e instanceof _t?"dev: ":e instanceof nt?"q: ":"finding: "}function Cc(e,t){if(t instanceof hn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,r,n.line_tag,n.line_number_text,n.notes,n.current_note_draft,r,(()=>{let i=ue(e.notes,r);return vt(i,o([]))})(),n.active_thread,n.show_expanded_message_box,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),J()]}else if(t instanceof xn){let r=t[0],n=M(r);return[(()=>{let i=e;return new D(i.user_name,r,i.line_id,"L"+n,n,i.notes,i.current_note_draft,i.current_thread_id,i.current_thread_notes,i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),J()]}else if(t instanceof wn){let r=t[0],n=Kt(r);return[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,n,i.current_note_draft,i.current_thread_id,(()=>{let s=ue(n,e.current_thread_id);return vt(s,o([]))})(),i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),J()]}else if(t instanceof gn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,n.notes,r,n.current_thread_id,n.current_thread_notes,n.active_thread,n.show_expanded_message_box,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),J()]}else{if(t instanceof br)return co(e.current_note_draft==="",()=>[e,J()],()=>{let r=lu(),n=au(r),i=e.user_name+(()=>{let b=cu(r);return M(b)})()+(()=>{let b=mr(n);return M(b)})(),s=(()=>{let $=e.editing_note;if($ instanceof _){let b=$[0];return[new Pt,b.note_id]}else return[new wr,e.current_thread_id]})(),u=s[0],a=s[1],c=zc(e.current_note_draft,qn(e.active_thread)),g=c[0],d=c[1],x=(()=>{let $=(()=>{let b=e.current_expanded_message_draft;return Lr(b,As)})();return $ instanceof _&&$[0]===""?new y:$})(),w=new hr(i,a,g,"user"+(()=>{let $=Kn(100);return M($)})(),d,x,n,u);return[(()=>{let $=e;return new D($.user_name,$.line_number,$.line_id,$.line_tag,$.line_number_text,$.notes,"",$.current_thread_id,$.current_thread_notes,$.active_thread,!1,new y,$.expanded_messages,new y)})(),Ve(Lu,yu(w))]});if(t instanceof yn){let r=t.new_thread_id,n=t.parent_note;return[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,i.notes,i.current_note_draft,r,(()=>{let s=ue(e.notes,r);return vt(s,o([]))})(),new _(new ns(r,n,e.current_thread_id,e.active_thread)),i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),J()]}else if(t instanceof bn){let r=(()=>{let i=e.active_thread,s=Lr(i,u=>u.prior_thread);return cs(s)})(),n=(()=>{let i=Lr(r,s=>s.current_thread_id);return Or(i,e.line_id)})();return[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,i.notes,i.current_note_draft,n,(()=>{let s=ue(e.notes,n);return vt(s,o([]))})(),r,i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),J()]}else if(t instanceof vn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,n.notes,n.current_note_draft,n.current_thread_id,n.current_thread_notes,n.active_thread,r,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),J()]}else if(t instanceof kn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,n.notes,n.current_note_draft,n.current_thread_id,n.current_thread_notes,n.active_thread,n.show_expanded_message_box,new _(r),n.expanded_messages,n.editing_note)})(),J()]}else if(t instanceof On){let r=t.for_note_id;return mi(e.expanded_messages,r)?[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,i.notes,i.current_note_draft,i.current_thread_id,i.current_thread_notes,i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,no(e.expanded_messages,r),i.editing_note)})(),J()]:[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,i.notes,i.current_note_draft,i.current_thread_id,i.current_thread_notes,i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,$i(e.expanded_messages,r),i.editing_note)})(),J()]}else{if(t instanceof is)return[e,Ve(ju,ye(o([["line_number",T(e.line_number)],["discussion_lane",T(1)]])))];if(t instanceof Ln)return[e,Ve(ts,ye(o([["line_number",T(e.line_number)],["discussion_lane",T(1)]])))];if(t instanceof jn)return[(()=>{let r=e;return new D(r.user_name,r.line_number,r.line_id,r.line_tag,r.line_number_text,r.notes,r.current_note_draft,r.current_thread_id,r.current_thread_notes,r.active_thread,!0,r.current_expanded_message_draft,r.expanded_messages,r.editing_note)})(),Ve(ts,ye(o([["line_number",T(e.line_number)],["discussion_lane",T(1)]])))];if(t instanceof vr)return[e,Ve(Su,ye(o([["line_number",T(e.line_number)],["discussion_lane",T(1)]])))];if(t instanceof Sn)return[e,Ve(Au,ye(o([["line_number",T(e.line_number)],["discussion_lane",T(1)]])))];if(t instanceof An){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,n.notes,Dc(r.significance)+r.message,n.current_thread_id,n.current_thread_notes,n.active_thread,r.expanded_message instanceof _,r.expanded_message,n.expanded_messages,new _(r))})(),J()]}else return[(()=>{let r=e;return new D(r.user_name,r.line_number,r.line_id,r.line_tag,r.line_number_text,r.notes,"",r.current_thread_id,r.current_thread_notes,r.active_thread,!1,new y,r.expanded_messages,new y)})(),J()]}}}var Mu=gu,Nc=`
:host {
  display: inline-block;
}

/* Delay the overlay transitions by 1ms so they are done last, and any 
  actions on them can be done first (like focusing the input) */

#expanded-message {
  visibility: hidden;
  opacity: 0;
  transition-property: opacity, visibility;
  transition-delay: 1ms, 1ms;
}

#expanded-message.show-exp,
#expanded-message:focus-within {
  visibility: visible;
  opacity: 1;
}

button.icon-button {
  background-color: var(--overlay-background-color);
  color: var(--text-color);
  border-radius: 4px;
  border: none;
  cursor: pointer;
}

button.icon-button:hover {
  background-color: var(--input-background-color);
}

button.icon-button svg {
  height: 1.25rem;
  width: 1.25rem;
}

input, textarea {
  background-color: var(--input-background-color);
  color: var(--text-color);
  border-radius: 6px;
}

input, textarea {
  border: 1px solid var(--input-border-color);
}

hr {
  border: 1px solid var(--comment-color);
}

.overlay {
  background-color: var(--overlay-background-color);
  border: 1px solid var(--input-border-color);
  border-radius: 6px;
}

.absolute {
  position: absolute;
}
`;function Fc(e){return Rn("Rendering line discussion "+e.line_tag),R(o([fe("line-discussion-overlay")]),o([fu(o([]),Nc),R(o([k("overlay p-[.5rem]")]),o([qn(e.active_thread)||ei(e.current_thread_notes)>0?R(o([fe("comment-list"),k("flex flex-col-reverse overflow-auto max-h-[30rem] gap-[.5rem] mb-[.5rem]")]),o([Se(qc(e)),Tc(e)])):Se(o([])),Ic(e)])),Bc(e)]))}function Tu(){return uo(Mc,Cc,Fc,Kt(o([["line-discussion",e=>{let t=Ou(e);if(t.isOk()){let r=t[0];return new m(new wn(r))}else return new h(o([new N("line-discussion",Ie(e),o([]))]))}],["line-id",e=>{let t=se(e,z);if(t.isOk()){let r=t[0];return new m(new hn(r))}else return new h(o([new N("line-id",Ie(e),o([]))]))}],["line-number",e=>{let t=se(e,z);if(t.isOk()){let r=t[0],n=Ye(r);if(n.isOk()){let i=n[0];return new m(new xn(i))}else return new h(o([new N("line-number",r,o([]))]))}else return new h(o([new N("line-number",Ie(e),o([]))]))}]])))}xi(Tu(),Mu);
