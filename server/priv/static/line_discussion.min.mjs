var a=class{withFields(t){let r=Object.keys(this).map(n=>n in t?t[n]:this[n]);return new this.constructor(...r)}},M=class{static fromArray(t,r){let n=r||new Ut;for(let i=t.length-1;i>=0;--i)n=new Pe(t[i],n);return n}[Symbol.iterator](){return new Bn(this)}toArray(){return[...this]}atLeastLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return r!==void 0}hasLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return t===-1&&r instanceof Ut}countLength(){let t=this,r=0;for(;t;)t=t.tail,r++;return r-1}};function $(e,t){return new Pe(e,t)}function u(e,t){return M.fromArray(e,t)}var Bn=class{#e;constructor(t){this.#e=t}next(){if(this.#e instanceof Ut)return{done:!0};{let{head:t,tail:r}=this.#e;return this.#e=r,{value:t,done:!1}}}},Ut=class extends M{},Pe=class extends M{constructor(t,r){super(),this.head=t,this.tail=r}},ae=class{bitSize;byteSize;bitOffset;rawBuffer;constructor(t,r,n){if(!(t instanceof Uint8Array))throw globalThis.Error("BitArray can only be constructed from a Uint8Array");if(this.bitSize=r??t.length*8,this.byteSize=Math.trunc((this.bitSize+7)/8),this.bitOffset=n??0,this.bitSize<0)throw globalThis.Error(`BitArray bit size is invalid: ${this.bitSize}`);if(this.bitOffset<0||this.bitOffset>7)throw globalThis.Error(`BitArray bit offset is invalid: ${this.bitOffset}`);if(t.length!==Math.trunc((this.bitOffset+this.bitSize+7)/8))throw globalThis.Error("BitArray buffer length is invalid");this.rawBuffer=t}byteAt(t){if(!(t<0||t>=this.byteSize))return Ht(this.rawBuffer,this.bitOffset,t)}equals(t){if(this.bitSize!==t.bitSize)return!1;let r=Math.trunc(this.bitSize/8);if(this.bitOffset===0&&t.bitOffset===0){for(let i=0;i<r;i++)if(this.rawBuffer[i]!==t.rawBuffer[i])return!1;let n=this.bitSize%8;if(n){let i=8-n;if(this.rawBuffer[r]>>i!==t.rawBuffer[r]>>i)return!1}}else{for(let i=0;i<r;i++){let s=Ht(this.rawBuffer,this.bitOffset,i),o=Ht(t.rawBuffer,t.bitOffset,i);if(s!==o)return!1}let n=this.bitSize%8;if(n){let i=Ht(this.rawBuffer,this.bitOffset,r),s=Ht(t.rawBuffer,t.bitOffset,r),o=8-n;if(i>>o!==s>>o)return!1}}return!0}get buffer(){if(as("buffer","Use BitArray.byteAt() or BitArray.rawBuffer instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.buffer does not support unaligned bit arrays");return this.rawBuffer}get length(){if(as("length","Use BitArray.bitSize or BitArray.byteSize instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.length does not support unaligned bit arrays");return this.rawBuffer.length}};function Ht(e,t,r){if(t===0)return e[r]??0;{let n=e[r]<<t&255,i=e[r+1]>>8-t;return n|i}}var wt=class{constructor(t){this.value=t}},ls={};function as(e,t){ls[e]||(console.warn(`Deprecated BitArray.${e} property used in JavaScript FFI code. ${t}.`),ls[e]=!0)}function In(e,t,r){if(r??=e.bitSize,ps(e,t,r),t===r)return new ae(new Uint8Array);if(t===0&&r===e.bitSize)return e;t+=e.bitOffset,r+=e.bitOffset;let n=Math.trunc(t/8),s=Math.trunc((r+7)/8)-n,o;return n===0&&s===e.rawBuffer.byteLength?o=e.rawBuffer:o=new Uint8Array(e.rawBuffer.buffer,e.rawBuffer.byteOffset+n,s),new ae(o,r-t,t%8)}function fs(e,t,r,n,i){if(ps(e,t,r),t===r)return 0;t+=e.bitOffset,r+=e.bitOffset;let s=t%8===0,o=r%8===0;if(s&&o)return Cu(e,t/8,r/8,n,i);let l=r-t,c=Math.trunc(t/8),p=Math.trunc((r-1)/8);if(c==p){let f=255>>t%8,_=(8-r%8)%8,h=(e.rawBuffer[c]&f)>>_;if(i){let m=2**(l-1);h>=m&&(h-=m*2)}return h}return l<=53?Wu(e.rawBuffer,t,r,n,i):Ju(e.rawBuffer,t,r,n,i)}function Cu(e,t,r,n,i){return r-t<=6?Nu(e.rawBuffer,t,r,n,i):Fu(e.rawBuffer,t,r,n,i)}function Nu(e,t,r,n,i){let s=r-t,o=0;if(n)for(let l=t;l<r;l++)o*=256,o+=e[l];else for(let l=r-1;l>=t;l--)o*=256,o+=e[l];if(i){let l=2**(s*8-1);o>=l&&(o-=l*2)}return o}function Fu(e,t,r,n,i){let s=r-t,o=0n;if(n)for(let l=t;l<r;l++)o*=256n,o+=BigInt(e[l]);else for(let l=r-1;l>=t;l--)o*=256n,o+=BigInt(e[l]);if(i){let l=1n<<BigInt(s*8-1);o>=l&&(o-=l*2n)}return Number(o)}function Wu(e,t,r,n,i){let s=t%8===0,o=r-t,l=Math.trunc(t/8),c=0;if(n){if(!s){let p=8-t%8;c=e[l++]&(1<<p)-1,o-=p}for(;o>=8;)c*=256,c+=e[l++],o-=8;o>0&&(c*=2**o,c+=e[l]>>8-o)}else if(s){let p=r-t,f=1;for(;p>=8;)c+=e[l++]*f,f*=256,p-=8;c+=(e[l]>>8-p)*f}else{let p=t%8,f=8-p,_=r-t,h=1;for(;_>=8;){let m=e[l]<<p|e[l+1]>>f;c+=(m&255)*h,h*=256,_-=8,l++}if(_>0){let m=_-Math.max(0,_-f),y=(e[l]&(1<<f)-1)>>f-m;_-=m,_>0&&(y*=2**_,y+=e[l+1]>>8-_),c+=y*h}}if(i){let p=2**(r-t-1);c>=p&&(c-=p*2)}return c}function Ju(e,t,r,n,i){let s=t%8===0,o=r-t,l=Math.trunc(t/8),c=0n;if(n){if(!s){let p=8-t%8;c=BigInt(e[l++]&(1<<p)-1),o-=p}for(;o>=8;)c*=256n,c+=BigInt(e[l++]),o-=8;o>0&&(c<<=BigInt(o),c+=BigInt(e[l]>>8-o))}else if(s){let p=r-t,f=0n;for(;p>=8;)c+=BigInt(e[l++])<<f,f+=8n,p-=8;c+=BigInt(e[l]>>8-p)<<f}else{let p=t%8,f=8-p,_=r-t,h=0n;for(;_>=8;){let m=e[l]<<p|e[l+1]>>f;c+=BigInt(m&255)<<h,h+=8n,_-=8,l++}if(_>0){let m=_-Math.max(0,_-f),y=(e[l]&(1<<f)-1)>>f-m;_-=m,_>0&&(y<<=_,y+=e[l+1]>>8-_),c+=BigInt(y)<<h}}if(i){let p=2n**BigInt(r-t-1);c>=p&&(c-=p*2n)}return Number(c)}function ps(e,t,r){if(t<0||t>e.bitSize||r<t||r>e.bitSize){let n=`Invalid bit array slice: start = ${t}, end = ${r}, bit size = ${e.bitSize}`;throw new globalThis.Error(n)}}var gt=class e extends a{static isResult(t){return t instanceof e}},w=class extends gt{constructor(t){super(),this[0]=t}isOk(){return!0}},g=class extends gt{constructor(t){super(),this[0]=t}isOk(){return!1}};function v(e,t){let r=[e,t];for(;r.length;){let n=r.pop(),i=r.pop();if(n===i)continue;if(!cs(n)||!cs(i)||!Vu(n,i)||Yu(n,i)||Hu(n,i)||Uu(n,i)||Ru(n,i)||Gu(n,i)||Zu(n,i))return!1;let o=Object.getPrototypeOf(n);if(o!==null&&typeof o.equals=="function")try{if(n.equals(i))continue;return!1}catch{}let[l,c]=Pu(n);for(let p of l(n))r.push(c(n,p),c(i,p))}return!0}function Pu(e){if(e instanceof Map)return[t=>t.keys(),(t,r)=>t.get(r)];{let t=e instanceof globalThis.Error?["message"]:[];return[r=>[...t,...Object.keys(r)],(r,n)=>r[n]]}}function Yu(e,t){return e instanceof Date&&(e>t||e<t)}function Hu(e,t){return!(e instanceof ae)&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT&&!(e.byteLength===t.byteLength&&e.every((r,n)=>r===t[n]))}function Uu(e,t){return Array.isArray(e)&&e.length!==t.length}function Ru(e,t){return e instanceof Map&&e.size!==t.size}function Gu(e,t){return e instanceof Set&&(e.size!=t.size||[...e].some(r=>!t.has(r)))}function Zu(e,t){return e instanceof RegExp&&(e.source!==t.source||e.flags!==t.flags)}function cs(e){return typeof e=="object"&&e!==null}function Vu(e,t){return typeof e!="object"&&typeof t!="object"&&(!e||!t)||[Promise,WeakSet,WeakMap,Function].some(n=>e instanceof n)?!1:e.constructor===t.constructor}function K(e,t){return t===0?0:e%t}function I(e,t){return Math.trunc(yt(e,t))}function yt(e,t){return t===0?0:e/t}function ce(e,t,r,n,i,s){let o=new globalThis.Error(i);o.gleam_error=e,o.module=t,o.line=r,o.function=n,o.fn=n;for(let l in s)o[l]=s[l];return o}var x=class extends a{constructor(t){super(),this[0]=t}},b=class extends a{};function qn(e){return!v(e,new b)}function _s(e,t){if(e instanceof x){let r=e[0];return new w(r)}else return new g(t)}function Or(e,t){return e instanceof x?e[0]:t}function Lr(e,t){if(e instanceof x){let r=e[0];return new x(t(r))}else return new b}function ds(e){return e instanceof x?e[0]:new b}var ms=new WeakMap,Dn=new DataView(new ArrayBuffer(8)),zn=0;function Cn(e){let t=ms.get(e);if(t!==void 0)return t;let r=zn++;return zn===2147483647&&(zn=0),ms.set(e,r),r}function Nn(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function Wn(e){let t=0,r=e.length;for(let n=0;n<r;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function hs(e){Dn.setFloat64(0,e);let t=Dn.getInt32(0),r=Dn.getInt32(4);return Math.imul(73244475,t>>16^t)^r}function Ku(e){return Wn(e.toString())}function Qu(e){let t=Object.getPrototypeOf(e);if(t!==null&&typeof t.hashCode=="function")try{let n=e.hashCode(e);if(typeof n=="number")return n}catch{}if(e instanceof Promise||e instanceof WeakSet||e instanceof WeakMap)return Cn(e);if(e instanceof Date)return hs(e.getTime());let r=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||e instanceof Uint8Array)for(let n=0;n<e.length;n++)r=Math.imul(31,r)+re(e[n])|0;else if(e instanceof Set)e.forEach(n=>{r=r+re(n)|0});else if(e instanceof Map)e.forEach((n,i)=>{r=r+Nn(re(n),re(i))|0});else{let n=Object.keys(e);for(let i=0;i<n.length;i++){let s=n[i],o=e[s];r=r+Nn(re(o),Wn(s))|0}}return r}function re(e){if(e===null)return 1108378658;if(e===void 0)return 1108378659;if(e===!0)return 1108378657;if(e===!1)return 1108378656;switch(typeof e){case"number":return hs(e);case"string":return Wn(e);case"bigint":return Ku(e);case"object":return Qu(e);case"symbol":return Cn(e);case"function":return Cn(e);default:return 0}}var ve=5,Jn=Math.pow(2,ve),Xu=Jn-1,el=Jn/2,tl=Jn/4,P=0,be=1,Q=2,Ye=3,Pn={type:Q,bitmap:0,array:[]};function Rt(e,t){return e>>>t&Xu}function Sr(e,t){return 1<<Rt(e,t)}function rl(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Yn(e,t){return rl(e&t-1)}function ne(e,t,r){let n=e.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=e[s];return i[t]=r,i}function nl(e,t,r){let n=e.length,i=new Array(n+1),s=0,o=0;for(;s<t;)i[o++]=e[s++];for(i[o++]=r;s<n;)i[o++]=e[s++];return i}function Fn(e,t){let r=e.length,n=new Array(r-1),i=0,s=0;for(;i<t;)n[s++]=e[i++];for(++i;i<r;)n[s++]=e[i++];return n}function xs(e,t,r,n,i,s){let o=re(t);if(o===n)return{type:Ye,hash:o,array:[{type:P,k:t,v:r},{type:P,k:i,v:s}]};let l={val:!1};return Gt(Hn(Pn,e,o,t,r,l),e,n,i,s,l)}function Gt(e,t,r,n,i,s){switch(e.type){case be:return il(e,t,r,n,i,s);case Q:return Hn(e,t,r,n,i,s);case Ye:return sl(e,t,r,n,i,s)}}function il(e,t,r,n,i,s){let o=Rt(r,t),l=e.array[o];if(l===void 0)return s.val=!0,{type:be,size:e.size+1,array:ne(e.array,o,{type:P,k:n,v:i})};if(l.type===P)return v(n,l.k)?i===l.v?e:{type:be,size:e.size,array:ne(e.array,o,{type:P,k:n,v:i})}:(s.val=!0,{type:be,size:e.size,array:ne(e.array,o,xs(t+ve,l.k,l.v,r,n,i))});let c=Gt(l,t+ve,r,n,i,s);return c===l?e:{type:be,size:e.size,array:ne(e.array,o,c)}}function Hn(e,t,r,n,i,s){let o=Sr(r,t),l=Yn(e.bitmap,o);if(e.bitmap&o){let c=e.array[l];if(c.type!==P){let f=Gt(c,t+ve,r,n,i,s);return f===c?e:{type:Q,bitmap:e.bitmap,array:ne(e.array,l,f)}}let p=c.k;return v(n,p)?i===c.v?e:{type:Q,bitmap:e.bitmap,array:ne(e.array,l,{type:P,k:n,v:i})}:(s.val=!0,{type:Q,bitmap:e.bitmap,array:ne(e.array,l,xs(t+ve,p,c.v,r,n,i))})}else{let c=e.array.length;if(c>=el){let p=new Array(32),f=Rt(r,t);p[f]=Hn(Pn,t+ve,r,n,i,s);let _=0,h=e.bitmap;for(let m=0;m<32;m++){if(h&1){let y=e.array[_++];p[m]=y}h=h>>>1}return{type:be,size:c+1,array:p}}else{let p=nl(e.array,l,{type:P,k:n,v:i});return s.val=!0,{type:Q,bitmap:e.bitmap|o,array:p}}}}function sl(e,t,r,n,i,s){if(r===e.hash){let o=Un(e,n);if(o!==-1)return e.array[o].v===i?e:{type:Ye,hash:r,array:ne(e.array,o,{type:P,k:n,v:i})};let l=e.array.length;return s.val=!0,{type:Ye,hash:r,array:ne(e.array,l,{type:P,k:n,v:i})}}return Gt({type:Q,bitmap:Sr(e.hash,t),array:[e]},t,r,n,i,s)}function Un(e,t){let r=e.array.length;for(let n=0;n<r;n++)if(v(t,e.array[n].k))return n;return-1}function jr(e,t,r,n){switch(e.type){case be:return ol(e,t,r,n);case Q:return ul(e,t,r,n);case Ye:return ll(e,n)}}function ol(e,t,r,n){let i=Rt(r,t),s=e.array[i];if(s!==void 0){if(s.type!==P)return jr(s,t+ve,r,n);if(v(n,s.k))return s}}function ul(e,t,r,n){let i=Sr(r,t);if(!(e.bitmap&i))return;let s=Yn(e.bitmap,i),o=e.array[s];if(o.type!==P)return jr(o,t+ve,r,n);if(v(n,o.k))return o}function ll(e,t){let r=Un(e,t);if(!(r<0))return e.array[r]}function Rn(e,t,r,n){switch(e.type){case be:return al(e,t,r,n);case Q:return cl(e,t,r,n);case Ye:return fl(e,n)}}function al(e,t,r,n){let i=Rt(r,t),s=e.array[i];if(s===void 0)return e;let o;if(s.type===P){if(!v(s.k,n))return e}else if(o=Rn(s,t+ve,r,n),o===s)return e;if(o===void 0){if(e.size<=tl){let l=e.array,c=new Array(e.size-1),p=0,f=0,_=0;for(;p<i;){let h=l[p];h!==void 0&&(c[f]=h,_|=1<<p,++f),++p}for(++p;p<l.length;){let h=l[p];h!==void 0&&(c[f]=h,_|=1<<p,++f),++p}return{type:Q,bitmap:_,array:c}}return{type:be,size:e.size-1,array:ne(e.array,i,o)}}return{type:be,size:e.size,array:ne(e.array,i,o)}}function cl(e,t,r,n){let i=Sr(r,t);if(!(e.bitmap&i))return e;let s=Yn(e.bitmap,i),o=e.array[s];if(o.type!==P){let l=Rn(o,t+ve,r,n);return l===o?e:l!==void 0?{type:Q,bitmap:e.bitmap,array:ne(e.array,s,l)}:e.bitmap===i?void 0:{type:Q,bitmap:e.bitmap^i,array:Fn(e.array,s)}}return v(n,o.k)?e.bitmap===i?void 0:{type:Q,bitmap:e.bitmap^i,array:Fn(e.array,s)}:e}function fl(e,t){let r=Un(e,t);if(r<0)return e;if(e.array.length!==1)return{type:Ye,hash:e.hash,array:Fn(e.array,r)}}function ws(e,t){if(e===void 0)return;let r=e.array,n=r.length;for(let i=0;i<n;i++){let s=r[i];if(s!==void 0){if(s.type===P){t(s.v,s.k);continue}ws(s,t)}}}var ie=class e{static fromObject(t){let r=Object.keys(t),n=e.new();for(let i=0;i<r.length;i++){let s=r[i];n=n.set(s,t[s])}return n}static fromMap(t){let r=e.new();return t.forEach((n,i)=>{r=r.set(i,n)}),r}static new(){return new e(void 0,0)}constructor(t,r){this.root=t,this.size=r}get(t,r){if(this.root===void 0)return r;let n=jr(this.root,0,re(t),t);return n===void 0?r:n.v}set(t,r){let n={val:!1},i=this.root===void 0?Pn:this.root,s=Gt(i,0,re(t),t,r,n);return s===this.root?this:new e(s,n.val?this.size+1:this.size)}delete(t){if(this.root===void 0)return this;let r=Rn(this.root,0,re(t),t);return r===this.root?this:r===void 0?e.new():new e(r,this.size-1)}has(t){return this.root===void 0?!1:jr(this.root,0,re(t),t)!==void 0}entries(){if(this.root===void 0)return[];let t=[];return this.forEach((r,n)=>t.push([n,r])),t}forEach(t){ws(this.root,t)}hashCode(){let t=0;return this.forEach((r,n)=>{t=t+Nn(re(r),re(n))|0}),t}equals(t){if(!(t instanceof e)||this.size!==t.size)return!1;try{return this.forEach((r,n)=>{if(!v(t.get(n,!r),r))throw $s}),!0}catch(r){if(r===$s)return!1;throw r}}},$s=Symbol();var Gn=void 0,gs={};function He(e){return/^[-+]?(\d+)$/.test(e)?new w(parseInt(e)):new g(Gn)}function T(e){return e.toString()}function Ar(e){let t=e.toString().replace("+","");if(t.indexOf(".")>=0)return t;{let r=t.indexOf("e");return r>=0?t.slice(0,r)+".0"+t.slice(r):t+".0"}}var ys;function dl(e){if(globalThis.Intl&&Intl.Segmenter)return ys||=new Intl.Segmenter,ys.segment(e)[Symbol.iterator]()}function vs(e){let t,r=dl(e);return r?t=r.next().value?.segment:t=e.match(/./su)?.[0],t?new w([t,e.slice(t.length)]):new g(Gn)}function qe(e){let t="";for(let r of e)t=t+r;return t}var ks=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),ml=new RegExp(`^[${ks}]*`),$l=new RegExp(`[${ks}]*$`);function Os(e){return e.replace(ml,"")}function Ls(e){return e.replace($l,"")}function Zn(e){console.log(e)}function Zt(e){return Math.floor(e)}function Vn(e){return Math.round(e)}function Vt(){let e=Math.random();return e===1?Vt():e}function G(){return ie.new()}function Mr(e){return M.fromArray(e.entries())}function js(e,t){return t.delete(e)}function se(e,t){let r=e.get(t,gs);return r===gs?new g(Gn):new w(r)}function Ss(e,t,r){return r.set(e,t)}function oe(e){if(typeof e=="string")return"String";if(typeof e=="boolean")return"Bool";if(e instanceof gt)return"Result";if(e instanceof M)return"List";if(e instanceof ae)return"BitArray";if(e instanceof ie)return"Dict";if(Number.isInteger(e))return"Int";if(Array.isArray(e))return`Tuple of ${e.length} elements`;if(typeof e=="number")return"Float";if(e===null)return"Null";if(e===void 0)return"Nil";{let t=typeof e;return t.charAt(0).toUpperCase()+t.slice(1)}}function Kn(e,t){return hl(e,oe(t))}function hl(e,t){return new g(M.fromArray([new C(e,t,M.fromArray([]))]))}function Qn(e){return typeof e=="string"?new w(e):Kn("String",e)}function As(e){return Number.isInteger(e)?new w(e):Kn("Int",e)}function Ms(e,t){let r=()=>Kn("Dict",e);if(e instanceof ie||e instanceof WeakMap||e instanceof Map){let n=se(e,t);return new w(n.isOk()?new x(n[0]):new b)}else return e===null?r():Object.getPrototypeOf(e)==Object.prototype?bs(e,t,()=>new w(new b)):bs(e,t,r)}function bs(e,t,r){try{return t in e?new w(new x(e[t])):r()}catch{return r()}}function ke(e){let t=typeof e;if(e===!0)return"True";if(e===!1)return"False";if(e===null)return"//js(null)";if(e===void 0)return"Nil";if(t==="string")return xl(e);if(t==="bigint"||Number.isInteger(e))return e.toString();if(t==="number")return Ar(e);if(Array.isArray(e))return`#(${e.map(ke).join(", ")})`;if(e instanceof M)return bl(e);if(e instanceof wt)return kl(e);if(e instanceof ae)return vl(e);if(e instanceof a)return yl(e);if(e instanceof ie)return wl(e);if(e instanceof Set)return`//js(Set(${[...e].map(ke).join(", ")}))`;if(e instanceof RegExp)return`//js(${e})`;if(e instanceof Date)return`//js(Date("${e.toISOString()}"))`;if(e instanceof Function){let r=[];for(let n of Array(e.length).keys())r.push(String.fromCharCode(n+97));return`//fn(${r.join(", ")}) { ... }`}return gl(e)}function xl(e){let t='"';for(let r=0;r<e.length;r++){let n=e[r];switch(n){case`
`:t+="\\n";break;case"\r":t+="\\r";break;case"	":t+="\\t";break;case"\f":t+="\\f";break;case"\\":t+="\\\\";break;case'"':t+='\\"';break;default:n<" "||n>"~"&&n<"\xA0"?t+="\\u{"+n.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":t+=n}}return t+='"',t}function wl(e){let t="dict.from_list([",r=!0;return e.forEach((n,i)=>{r||(t=t+", "),t=t+"#("+ke(i)+", "+ke(n)+")",r=!1}),t+"])"}function gl(e){let t=Object.getPrototypeOf(e)?.constructor?.name||"Object",r=[];for(let s of Object.keys(e))r.push(`${ke(s)}: ${ke(e[s])}`);let n=r.length?" "+r.join(", ")+" ":"";return`//js(${t==="Object"?"":t+" "}{${n}})`}function yl(e){let t=Object.keys(e).map(r=>{let n=ke(e[r]);return isNaN(parseInt(r))?`${r}: ${n}`:n}).join(", ");return t?`${e.constructor.name}(${t})`:e.constructor.name}function bl(e){return`[${e.toArray().map(ke).join(", ")}]`}function vl(e){return`<<${Array.from(e.buffer).join(", ")}>>`}function kl(e){return`//utfcodepoint(${String.fromCodePoint(e.value)})`}function jl(e){return-1*e}function Tr(e){return e>=0?Vn(e):0-Vn(jl(e))}function Xn(e){let t=Vt()*e,r=Zt(t);return Tr(r)}function Oe(e,t,r){return Ss(t,r,e)}function Al(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head[0],s=r.head[1];e=r.tail,t=Oe(n,i,s)}}}function Er(e){return Al(e,G())}function Ml(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=$(i,n)}}}function Tl(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return Ml(n,u([]));{let i=r.head[0];e=r.tail,t=$(i,n)}}}function ei(e){return Tl(Mr(e),u([]))}function ti(e,t){return js(t,e)}function Bl(e,t){for(;;){let r=e,n=t;if(r.atLeastLength(1))e=r.tail,t=n+1;else return n}}function ri(e){return Bl(e,0)}function Il(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=$(i,n)}}}function N(e){return Il(e,u([]))}function ql(e){return(t,r)=>{let n=se(t,e(r));if(n.isOk()){let i=n[0];return Oe(t,e(r),$(r,i))}else return Oe(t,e(r),u([r]))}}function Dl(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return N(s);{let o=n.head;e=n.tail,t=i,r=$(i(o),s)}}}function Y(e,t){return Dl(e,t,u([]))}function zl(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=$(i,n)}}}function vt(e,t){return zl(N(e),t)}function ue(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return i;{let o=n.head;e=n.tail,t=s(i,o),r=s}}}function Ts(e,t){return ue(e,G(),ql(t))}function Cl(e,t,r,n){for(;;){let i=e,s=t,o=r,l=n;if(i.hasLength(0))return s;{let c=i.head;e=i.tail,t=o(s,c,l),r=o,n=l+1}}}function Ir(e,t,r){return Cl(e,t,r,0)}function Is(e){let r=Os(e);return Ls(r)}function qr(e,t){for(;;){let r=e,n=t;if(n>0){let s=vs(r);if(s.isOk())e=s[0][1],t=n-1;else return r}else return r}}function fe(e){let t=ke(e);return t}function Cs(e){return!!e.isOk()}function pe(e,t){if(e.isOk()){let r=e[0];return new w(t(r))}else{let r=e[0];return new g(r)}}function Me(e,t){if(e.isOk()){let r=e[0];return new w(r)}else{let r=e[0];return new g(t(r))}}function Z(e,t){if(e.isOk()){let r=e[0];return t(r)}else{let r=e[0];return new g(r)}}function si(e,t){return Z(e,t)}function Ot(e,t){return e.isOk()?e[0]:t}function Re(e,t){if(e.isOk()){let r=e[0];return new w(r)}else return new g(t)}var C=class extends a{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}};function Ql(e,t){return Me(e,r=>Y(r,t))}function Ns(e){return Qn(e)}function Fs(e){return t=>{if(e.hasLength(0))return new g(u([new C("another type",oe(t),u([]))]));{let r=e.head,n=e.tail,i=r(t);if(i.isOk()){let s=i[0];return new w(s)}else return Fs(n)(t)}}}function Xl(e,t){let r=t,n=Fs(u([Qn,o=>pe(As(o),T)])),i=(()=>{let o=n(r);if(o.isOk())return o[0];{let l=u(["<",oe(r),">"]),c=qe(l);return c}})(),s=e;return new C(s.expected,s.found,$(i,e.path))}function oi(e,t){return r=>{let n=new C("field","nothing",u([]));return Z(Ms(r,e),i=>{let o=_s(i,u([n])),l=Z(o,t);return Ql(l,c=>Xl(c,e))})}}function Ws(e,t){let r=Number.isInteger(t);if(e instanceof ie||e instanceof WeakMap||e instanceof Map){let n={},i=e.get(t,n);return i===n?new w(new b):new w(new x(i))}if(Number.isInteger(t)&&t<8&&e instanceof M){let n=0;for(let i of e){if(n===t)return new w(new x(i));n++}return new g("Indexable")}return r&&Array.isArray(e)||e&&typeof e=="object"||e&&Object.getPrototypeOf(e)===Object.prototype?t in e?new w(new x(e[t])):new w(new b):new g(r?"Indexable":"Dict")}function Js(e,t,r,n,i){if(!(e instanceof M||Array.isArray(e))){let o=new _e("List",oe(e),i);return[i,M.fromArray([o])]}let s=[];for(let o of e){let l=t(o),[c,p]=l;if(p instanceof Pe){let[f,_]=r(l,n.toString());return[i,_]}s.push(c),n++}return[M.fromArray(s),i]}function Ps(e){return Number.isInteger(e)?new w(e):new g(0)}function Ys(e){return typeof e=="string"?new w(e):new g(0)}function Hs(e){return e==null}var _e=class extends a{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}},de=class extends a{constructor(t){super(),this.function=t}};function le(e,t){let r=t.function(e),n=r[0],i=r[1];return i.hasLength(0)?new w(n):new g(i)}function Qt(e){return new de(t=>[e,u([])])}function ea(e,t){return new de(r=>{let n=e.function(r),i=n[0],s=n[1];return[t(i),s]})}function ta(e,t,r){for(;;){let n=e,i=t,s=r;if(s.hasLength(0))return i;{let o=s.head,l=s.tail,c=o.function(n),p=c;if(c[1].hasLength(0))return p;e=n,t=i,r=l}}}function ra(e,t){return new de(r=>{let n=e.function(r),i=n;return n[1].hasLength(0)?i:ta(r,i,t)})}function li(e){return new de(t=>{if(Hs(t))return[new b,u([])];{let n=e.function(t),i=n[0],s=n[1];return[new x(i),s]}})}function na(e,t){return u([new _e(e,oe(t),u([]))])}function Us(e,t,r){let n=r(e);return n.isOk()?[n[0],u([])]:[n[0],u([new _e(t,oe(e),u([]))])]}function ia(e){return v(!0,e)?[!0,u([])]:v(!1,e)?[!1,u([])]:[!1,na("Bool",e)]}function sa(e){return Us(e,"Int",Ps)}var zr=new de(ia),Lt=new de(sa);function oa(e){return Us(e,"String",Ys)}var W=new de(oa);function Rs(e){return new de(t=>Js(t,e.function,(r,n)=>Dr(r,u([n])),0,u([])))}function Dr(e,t){let r=ra(W,u([ea(Lt,T)])),n=Y(t,s=>{let o=s,l=le(o,r);return l.isOk()?l[0]:"<"+oe(o)+">"}),i=Y(e[1],s=>{let o=s;return new _e(o.expected,o.found,vt(n,s.path))});return[e[0],i]}function ua(e,t,r,n,i){for(;;){let s=e,o=t,l=r,c=n,p=i;if(s.hasLength(0)){let f=l(c);return Dr(f,N(o))}else{let f=s.head,_=s.tail,h=Ws(c,f);if(h.isOk()&&h[0]instanceof x){let m=h[0][0];e=_,t=$(f,o),r=l,n=m,i=p}else{if(h.isOk()&&h[0]instanceof b)return p(c,$(f,o));{let m=h[0],te=[l(c)[0],u([new _e(m,oe(c),u([]))])];return Dr(te,N(o))}}}}}function Gs(e,t,r){return new de(n=>{let i=ua(e,u([]),t.function,n,(f,_)=>{let y=[t.function(f)[0],u([new _e("Field","Nothing",u([]))])];return Dr(y,N(_))}),s=i[0],o=i[1],l=r(s).function(n),c=l[0],p=l[1];return[c,vt(o,p)]})}function ee(e,t,r){return Gs(u([e]),t,r)}function ai(e,t,r){return e?t():r()}function Zs(e){return Object.fromEntries(e)}function Vs(){return null}function Ks(e){try{let t=JSON.parse(e);return new w(t)}catch(t){return new g(aa(t,e))}}function aa(e,t){return ca(e)?new Nr:fa(e,t)}function ca(e){return/((unexpected (end|eof))|(end of data)|(unterminated string)|(json( parse error|\.parse)\: expected '(\:|\}|\])'))/i.test(e.message)}function fa(e,t){let r=[pa,_a,ma,da];for(let n of r){let i=n(e,t);if(i)return i}return new ze("",0)}function pa(e){let r=/unexpected token '(.)', ".+" is not valid JSON/i.exec(e.message);if(!r)return null;let n=Cr(r[1]);return new ze(n,-1)}function _a(e){let r=/unexpected token (.) in JSON at position (\d+)/i.exec(e.message);if(!r)return null;let n=Cr(r[1]),i=Number(r[2]);return new ze(n,i)}function da(e,t){let n=/(unexpected character|expected .*) at line (\d+) column (\d+)/i.exec(e.message);if(!n)return null;let i=Number(n[2]),s=Number(n[3]),o=$a(i,s,t),l=Cr(t[o]);return new ze(l,o)}function ma(e){let r=/unexpected (identifier|token) "(.)"/i.exec(e.message);if(!r)return null;let n=Cr(r[2]);return new ze(n,0)}function Cr(e){return"0x"+e.charCodeAt(0).toString(16).toUpperCase()}function $a(e,t,r){if(e===1)return t-1;let n=1,i=0;return r.split("").find((s,o)=>(s===`
`&&(n+=1),n===e?(i=o+t,!0):!1)),i}var Nr=class extends a{},ze=class extends a{constructor(t){super(),this[0]=t}};var fi=class extends a{constructor(t){super(),this[0]=t}};function xa(e,t){return si(Ks(e),r=>{let n=le(r,t);return Me(n,i=>new fi(i))})}function Qs(e,t){return xa(e,t)}function me(e){return e}function E(e){return e}function Xs(){return Vs()}function eo(e,t){if(e instanceof x){let r=e[0];return t(r)}else return Xs()}function $e(e){return Zs(e)}var Fr=class extends a{constructor(t){super(),this.all=t}};function to(e){return new Fr(u([t=>e(t.dispatch,t.emit,t.select,t.root)]))}function ro(e,t){return to((r,n,i,s)=>n(e,t))}function J(){return new Fr(u([]))}var jt=class extends a{constructor(t){super(),this.content=t}},A=class extends a{constructor(t,r,n,i,s,o,l){super(),this.key=t,this.namespace=r,this.tag=n,this.attrs=i,this.children=s,this.self_closing=o,this.void=l}},er=class extends a{constructor(t){super(),this.subtree=t}},St=class extends a{constructor(t,r,n){super(),this[0]=t,this[1]=r,this.as_property=n}},tr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}};function va(e){if(e instanceof St)return new g(void 0);{let t=e[0],r=e[1],n=qr(t,2);return new w([n,r])}}function ka(e,t,r){return Ir(e,t,(n,i,s)=>{let o=r+"-"+T(s);return no(i,n,o)})}function no(e,t,r){for(;;){let n=e,i=t,s=r;if(n instanceof jt)return i;if(n instanceof er){let o=n.subtree;e=o(),t=i,r=s}else{let o=n.attrs,l=n.children,c=ue(o,i,(p,f)=>{let _=va(f);if(_.isOk()){let h=_[0][0],m=_[0][1];return Oe(p,s+"-"+h,m)}else return p});return ka(l,c,s)}}}function io(e){return no(e,G(),"0")}function d(e,t){return new St(e,t,!1)}function oo(e,t){return new tr("on"+e,t)}function uo(e){return d("style",ue(e,"",(t,r)=>{let n=r[0],i=r[1];return t+n+":"+i+";"}))}function k(e){return d("class",e)}function he(e){return d("id",e)}function lo(e){return d("value",e)}function _i(e){return d("placeholder",e)}function xe(e,t,r){return e==="area"?new A("","",e,t,u([]),!1,!0):e==="base"?new A("","",e,t,u([]),!1,!0):e==="br"?new A("","",e,t,u([]),!1,!0):e==="col"?new A("","",e,t,u([]),!1,!0):e==="embed"?new A("","",e,t,u([]),!1,!0):e==="hr"?new A("","",e,t,u([]),!1,!0):e==="img"?new A("","",e,t,u([]),!1,!0):e==="input"?new A("","",e,t,u([]),!1,!0):e==="link"?new A("","",e,t,u([]),!1,!0):e==="meta"?new A("","",e,t,u([]),!1,!0):e==="param"?new A("","",e,t,u([]),!1,!0):e==="source"?new A("","",e,t,u([]),!1,!0):e==="track"?new A("","",e,t,u([]),!1,!0):e==="wbr"?new A("","",e,t,u([]),!1,!0):new A("","",e,t,r,!1,!1)}function At(e,t,r,n){return new A("",e,t,r,n,!1,!1)}function rr(e){return new jt(e)}function Te(e){return xe("lustre-fragment",u([uo(u([["display","contents"]]))]),e)}var nr=class extends a{constructor(t){super(),this.dict=t}};function Jr(){return new nr(G())}function $i(e,t){let r=e.dict,n=se(r,t);return Cs(n)}function ao(e,t){return new nr(ti(e.dict,t))}var Oa=void 0;function hi(e,t){return new nr(Oe(e.dict,t,Oa))}var Pr=class extends a{constructor(t){super(),this[0]=t}},Yr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}},Hr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}};function po(e){return v(e.created,G())&&v(e.removed,Jr())&&v(e.updated,G())}var Ur=class extends a{constructor(t){super(),this[0]=t}},Rr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}},Mt=class extends a{constructor(t){super(),this[0]=t}},V=class extends a{constructor(t){super(),this[0]=t}},Tt=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}},Gr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}};var sr=class extends a{},Zr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}},Vr=class extends a{constructor(t){super(),this[0]=t}},or=class extends a{constructor(t){super(),this[0]=t}};var xi=class extends a{constructor(t,r,n,i){super(),this.init=t,this.update=r,this.view=n,this.on_attribute_change=i}};var Kr=class extends a{constructor(t){super(),this.name=t}},Qr=class extends a{constructor(t){super(),this.name=t}},Xr=class extends a{constructor(t){super(),this.selector=t}},ur=class extends a{};function _o(e,t,r,n){return new xi(e,t,r,new x(n))}globalThis.customElements&&!globalThis.customElements.get("lustre-fragment")&&globalThis.customElements.define("lustre-fragment",class extends HTMLElement{constructor(){super()}});function cr(e,t,r){let n,i=[{prev:e,next:t,parent:e.parentNode}];for(;i.length;){let{prev:s,next:o,parent:l}=i.pop();for(;o.subtree!==void 0;)o=o.subtree();if(o.content!==void 0)if(s)if(s.nodeType===Node.TEXT_NODE)s.textContent!==o.content&&(s.textContent=o.content),n??=s;else{let c=document.createTextNode(o.content);l.replaceChild(c,s),n??=c}else{let c=document.createTextNode(o.content);l.appendChild(c),n??=c}else if(o.tag!==void 0){let c=Ea({prev:s,next:o,dispatch:r,stack:i});s?s!==c&&l.replaceChild(c,s):l.appendChild(c),n??=c}}return n}function Ea({prev:e,next:t,dispatch:r,stack:n}){let i=t.namespace||"http://www.w3.org/1999/xhtml",s=e&&e.nodeType===Node.ELEMENT_NODE&&e.localName===t.tag&&e.namespaceURI===(t.namespace||"http://www.w3.org/1999/xhtml"),o=s?e:i?document.createElementNS(i,t.tag):document.createElement(t.tag),l;if(lr.has(o))l=lr.get(o);else{let O=new Map;lr.set(o,O),l=O}let c=s?new Set(l.keys()):null,p=s?new Set(Array.from(e.attributes,O=>O.name)):null,f=null,_=null,h=null;if(s&&t.tag==="textarea"){let O=t.children[Symbol.iterator]().next().value?.content;O!==void 0&&(o.value=O)}let m=[];for(let O of t.attrs){let L=O[0],z=O[1];if(O.as_property)o[L]!==z&&(o[L]=z),s&&p.delete(L);else if(L.startsWith("on")){let ye=L.slice(2),En=r(z,ye==="input");l.has(ye)||o.addEventListener(ye,ar),l.set(ye,En),s&&c.delete(ye)}else if(L.startsWith("data-lustre-on-")){let ye=L.slice(15),En=r(Ba);l.has(ye)||o.addEventListener(ye,ar),l.set(ye,En),o.setAttribute(L,z),s&&(c.delete(ye),p.delete(L))}else L.startsWith("delegate:data-")||L.startsWith("delegate:aria-")?(o.setAttribute(L,z),m.push([L.slice(10),z])):L==="class"?f=f===null?z:f+" "+z:L==="style"?_=_===null?z:_+z:L==="dangerous-unescaped-html"?h=z:(o.getAttribute(L)!==z&&o.setAttribute(L,z),(L==="value"||L==="selected")&&(o[L]=z),s&&p.delete(L))}if(f!==null&&(o.setAttribute("class",f),s&&p.delete("class")),_!==null&&(o.setAttribute("style",_),s&&p.delete("style")),s){for(let O of p)o.removeAttribute(O);for(let O of c)l.delete(O),o.removeEventListener(O,ar)}if(t.tag==="slot"&&window.queueMicrotask(()=>{for(let O of o.assignedElements())for(let[L,z]of m)O.hasAttribute(L)||O.setAttribute(L,z)}),t.key!==void 0&&t.key!=="")o.setAttribute("data-lustre-key",t.key);else if(h!==null)return o.innerHTML=h,o;let y=o.firstChild,R=null,te=null,ge=null,Tn=en(t).next().value;if(s&&Tn!==void 0&&Tn.key!==void 0&&Tn.key!==""){R=new Set,te=mo(e),ge=mo(t);for(let O of en(t))y=Ia(y,O,o,n,ge,te,R)}else for(let O of en(t))n.unshift({prev:y,next:O,parent:o}),y=y?.nextSibling;for(;y;){let O=y.nextSibling;o.removeChild(y),y=O}return o}var lr=new WeakMap;function ar(e){let t=e.currentTarget;if(!lr.has(t)){t.removeEventListener(e.type,ar);return}let r=lr.get(t);if(!r.has(e.type)){t.removeEventListener(e.type,ar);return}r.get(e.type)(e)}function Ba(e){let t=e.currentTarget,r=t.getAttribute(`data-lustre-on-${e.type}`),n=JSON.parse(t.getAttribute("data-lustre-data")||"{}"),i=JSON.parse(t.getAttribute("data-lustre-include")||"[]");switch(e.type){case"input":case"change":i.push("target.value");break}return{tag:r,data:i.reduce((s,o)=>{let l=o.split(".");for(let c=0,p=s,f=e;c<l.length;c++)c===l.length-1?p[l[c]]=f[l[c]]:(p[l[c]]??={},f=f[l[c]],p=p[l[c]]);return s},{data:n})}}function mo(e){let t=new Map;if(e)for(let r of en(e)){let n=r?.key||r?.getAttribute?.("data-lustre-key");n&&t.set(n,r)}return t}function Ia(e,t,r,n,i,s,o){for(;e&&!i.has(e.getAttribute("data-lustre-key"));){let c=e.nextSibling;r.removeChild(e),e=c}if(s.size===0)return n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e;if(o.has(t.key))return console.warn(`Duplicate key found in Lustre vnode: ${t.key}`),n.unshift({prev:null,next:t,parent:r}),e;o.add(t.key);let l=s.get(t.key);if(!l&&!e)return n.unshift({prev:null,next:t,parent:r}),e;if(!l&&e!==null){let c=document.createTextNode("");return r.insertBefore(c,e),n.unshift({prev:c,next:t,parent:r}),e}return!l||l===e?(n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e):(r.insertBefore(l,e),n.unshift({prev:l,next:t,parent:r}),e)}function*en(e){for(let t of e.children)yield*$o(t)}function*$o(e){e.subtree!==void 0?yield*$o(e.subtree()):yield e}var yi=class e{static start({init:t,update:r,view:n},i,s){if(!gi())return new g(new ur);let o=i instanceof HTMLElement?i:document.querySelector(i);if(!o)return new g(new Xr(i));let l=new e(o,t(s),r,n);return new w(c=>l.send(c))}constructor(t,[r,n],i,s){this.root=t,this.#e=r,this.#s=i,this.#r=s,this.#t=window.setTimeout(()=>this.#i(n.all.toArray(),!0),0)}root;send(t){if(t instanceof Mt){if(t[0]instanceof or){this.#t=window.clearTimeout(this.#t),this.#n=[],this.#e=t[0][0];let r=this.#r(this.#e),n=(s,o=!1)=>l=>{let c=s(l);c instanceof w&&this.send(new V(c[0],o))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));cr(i,r,n)}}else if(t instanceof V){let r=t[0],n=t[1]??!1;this.#n.push(r),n?(this.#t=window.clearTimeout(this.#t),this.#i()):this.#t||(this.#t=window.setTimeout(()=>this.#i()))}else if(t instanceof Tt){let r=t[0],n=t[1];this.root.dispatchEvent(new CustomEvent(r,{detail:n,bubbles:!0,composed:!0}))}else if(t instanceof sr)for(this.#t=window.clearTimeout(this.#t),this.#e=null,this.#s=null,this.#r=null,this.#n=null;this.root.firstChild;)this.root.firstChild.remove()}#e;#s;#r;#n=[];#t;#i(t=[]){this.#t=void 0,this.#o(t);let r=this.#r(this.#e),n=(s,o=!1)=>l=>{let c=s(l);c instanceof w&&this.send(new V(c[0],o))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));cr(i,r,n)}#o(t=[]){for(;this.#n.length>0;){let r=this.#n.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;){let r=t.shift(),n=l=>this.send(new V(l)),i=(l,c)=>this.root.dispatchEvent(new CustomEvent(l,{detail:c,bubbles:!0,composed:!0})),s=()=>{},o=this.root;r({dispatch:n,emit:i,select:s,root:o})}this.#n.length>0&&this.#o(t)}},Ma=yi.start,wi=({init:e,update:t,view:r,on_attribute_change:n},i)=>{if(!gi())return new g(new ur);if(!i.includes("-"))return new g(new Kr(i));if(window.customElements.get(i))return new g(new Qr(i));let[s,o]=e(void 0),l=n instanceof x,c=class extends HTMLElement{static get observedAttributes(){return l?n[0].entries().map(([f])=>f):[]}constructor(){super(),this.attachShadow({mode:"open"}),this.internals=this.attachInternals(),l&&n[0].forEach((f,_)=>{let h=`__mirrored__${_}`;Object.defineProperty(this,_,{get(){return this[h]},set(m){let y=this[h];if(this.#t&&v(y,m))return;this[h]=m;let R=f(m);R instanceof g||(this.#r.push(R[0]),this.#t&&!this.#n&&(this.#n=window.requestAnimationFrame(()=>this.#i())))}})})}connectedCallback(){this.#u().finally(()=>{this.#i(o.all.toArray(),!0),this.#t=!0})}attributeChangedCallback(f,_,h){_!==h&&(this[f]=h)}disconnectedCallback(){this.#s=null,this.#r=[],this.#n=window.cancelAnimationFrame(this.#n),this.#t=!1}send(f){if(f instanceof Mt){if(f[0]instanceof or){this.#n=window.cancelAnimationFrame(this.#n),this.#r=[],this.#s=f[0][0];let _=r(this.#s),h=(y,R=!1)=>te=>{let ge=y(te);ge instanceof w&&this.send(new V(ge[0],R))},m=this.shadowRoot.childNodes[this.#e.length]??this.shadowRoot.appendChild(document.createTextNode(""));cr(m,_,h)}}else if(f instanceof V){let _=f[0],h=f[1]??!1;this.#r.push(_),h?(this.#n=window.cancelAnimationFrame(this.#n),this.#i()):this.#n||(this.#n=window.requestAnimationFrame(()=>this.#i()))}else if(f instanceof Tt){let _=f[0],h=f[1];this.dispatchEvent(new CustomEvent(_,{detail:h,bubbles:!0,composed:!0}))}}#e=[];#s=s;#r=[];#n;#t=!0;#i(f=[]){if(!this.#t)return;this.#n=void 0,this.#o(f);let _=r(this.#s),h=(y,R=!1)=>te=>{let ge=y(te);ge instanceof w&&this.send(new V(ge[0],R))},m=this.shadowRoot.childNodes[this.#e.length]??this.shadowRoot.appendChild(document.createTextNode(""));cr(m,_,h)}#o(f=[]){for(;this.#r.length>0;){let _=this.#r.shift(),[h,m]=t(this.#s,_);f=f.concat(m.all.toArray()),this.#s=h}for(;f.length>0;){let _=f.shift(),h=te=>this.send(new V(te)),m=(te,ge)=>this.dispatchEvent(new CustomEvent(te,{detail:ge,bubbles:!0,composed:!0})),y=()=>{},R=this.shadowRoot;_({dispatch:h,emit:m,select:y,root:R})}this.#r.length>0&&this.#o(f)}async#u(){let f=[];for(let h of document.querySelectorAll("link[rel=stylesheet]"))h.sheet||f.push(new Promise((m,y)=>{h.addEventListener("load",m),h.addEventListener("error",y)}));for(await Promise.allSettled(f);this.#e.length;)this.#e.shift().remove(),this.shadowRoot.firstChild.remove();this.shadowRoot.adoptedStyleSheets=this.getRootNode().adoptedStyleSheets;let _=[];for(let h of document.styleSheets)try{this.shadowRoot.adoptedStyleSheets.push(h)}catch{try{let m=new CSSStyleSheet;for(let y of h.cssRules)m.insertRule(y.cssText,m.cssRules.length);this.shadowRoot.adoptedStyleSheets.push(m)}catch{let m=h.ownerNode.cloneNode();this.shadowRoot.prepend(m),this.#e.push(m),_.push(new Promise((y,R)=>{m.onload=y,m.onerror=R}))}}return Promise.allSettled(_)}};return window.customElements.define(i,c),new w(void 0)},bi=class e{static start({init:t,update:r,view:n,on_attribute_change:i},s){let o=new e(t(s),r,n,i);return new w(l=>o.send(l))}constructor([t,r],n,i,s){this.#e=t,this.#s=n,this.#n=i,this.#t=i(t),this.#u=s,this.#i=new Map,this.#o=io(this.#t),this.#l(r.all.toArray())}send(t){if(t instanceof Ur){for(let r of t[0]){let n=this.#u.get(r[0]);if(!n)continue;let i=n(r[1]);i instanceof g||this.#r.push(i)}this.#l()}else if(t instanceof Rr)this.#r=this.#r.concat(t[0].toArray()),this.#l(t[1].all.toArray());else if(!(t instanceof Mt))if(t instanceof V)this.#r.push(t[0]),this.#l();else if(t instanceof Tt){let r=new Yr(t[0],t[1]);for(let[n,i]of this.#i)i(r)}else if(t instanceof Gr){let r=this.#o.get(t[0]);if(!r)return;let n=r(t[1]);if(n instanceof g)return;this.#r.push(n[0]),this.#l()}else if(t instanceof Zr){let r=ei(this.#u),n=new Hr(r,this.#t);this.#i=this.#i.set(t[0],t[1]),t[1](n)}else t instanceof Vr&&(this.#i=this.#i.delete(t[0]))}#e;#s;#r;#n;#t;#i;#o;#u;#l(t=[]){this.#a(t);let r=this.#n(this.#e),n=elements(this.#t,r);if(!po(n)){let i=new Pr(n);for(let[s,o]of this.#i)o(i)}this.#t=r,this.#o=n.handlers}#a(t=[]){for(;this.#r.length>0;){let r=this.#r.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;)t.shift()({dispatch:l=>this.send(new V(l)),emit:(l,c)=>this.root.dispatchEvent(new CustomEvent(l,{detail:c,bubbles:!0,composed:!0})),select:()=>{},root:null});this.#r.length>0&&this.#a(t)}},Ta=bi.start,gi=()=>globalThis.window&&window.document;function ho(e,t,r){return e?t():r()}var Ce=class extends a{constructor(t,r){super(),this.seconds=t,this.nanoseconds=r}};function vi(e){let t=1e9,r=K(e.nanoseconds,t),n=e.nanoseconds-r,i=e.seconds+I(n,t);return r>=0?new Ce(i,r):new Ce(i-1,t+r)}function xo(e,t){let r=new Ce(t.seconds-e.seconds,t.nanoseconds-e.nanoseconds);return vi(r)}function fr(e,t){let r=new Ce(e.seconds+t.seconds,e.nanoseconds+t.nanoseconds);return vi(r)}function pr(e){return new Ce(e,0)}function tn(e){let t=new Ce(0,e);return vi(t)}function _r(e){return[e.seconds,e.nanoseconds]}var H=864e8;function bo(e){return e*H}function vo(e){return I(e,H)}var Lo=1,ln=0,Xa=0,ec=0,jo=!1,So=!1,an=0;function ko(){return Date.now()*1e3+an}function Oo(){return Math.trunc(performance.now()*1e3)+an}function Oi(){if(So)return ln+an;if(jo){let e=ko()-Xa,t=Math.trunc(e*Lo);return ln+t}return ko()}function Li(){return-new Date().getTimezoneOffset()}function Ao(){if(So)return ln+an;if(jo){let e=Oo()-ec,t=Math.trunc(e*Lo);return ln+t}return Oo()}var tc=1;function Mo(){return tc++}var ji=class extends a{constructor(t,r,n,i){super(),this.timestamp_utc_us=t,this.offset_local_us=r,this.monotonic_us=n,this.unique=i}},cn=class extends a{constructor(t,r,n){super(),this.date=t,this.time=r,this.offset=n}};var Bt=class extends a{constructor(t,r){super(),this.date=t,this.time=r}},Si=class extends a{constructor(t){super(),this.minutes=t}},It=class extends a{constructor(t){super(),this.unix_days=t}};var Ne=class extends a{constructor(t){super(),this.microseconds=t}},Ai=class extends a{},dr=class extends a{constructor(t){super(),this.microseconds=t}};function Fo(e){return e.unique}function Wo(e,t,r){return new cn(e,t,r)}function Jo(e){return new Bt(e.date,e.time)}function Bi(e){return e.date}function Ii(e){return e.time}function Po(e){return new It(I(e,86400))}function Yo(e){return new It(I(e,H))}function Ho(e){return Yo(e.timestamp_utc_us)}function Uo(e){return e.unix_days*86400}function Ro(e,t){return new It(e.unix_days+t)}function Go(e,t){return new It(e.unix_days-t)}function fn(e){if(e instanceof Ne&&e.microseconds<0){let t=e.microseconds;return new Ne(H+K(t,H))}else if(e instanceof Ne&&e.microseconds>=H){let t=e.microseconds;return new Ne(K(t,H))}else return e}function qt(e){return new Ne(e)}function Ee(e){let t=fn(e);if(t instanceof Ne)return t.microseconds;if(t instanceof Ai)return H;{let r=t.microseconds;return H+r}}function Zo(e){return qt(K(e,H))}function Vo(e){return Zo(e.timestamp_utc_us)}function Ve(e){return tn(e*1e3)}function oc(e){let t=-e.minutes*6e7;return Ve(t)}function qi(e){let t=Ee(e);return Ve(t)}function Ze(e){let t=_r(e),r=t[0],n=t[1];return r*1e6+I(n,1e3)}function Ko(e,t){let r=Ze(t);if(r===0)return e;if(e instanceof dr&&r+e.microseconds<1e6){let i=e.microseconds;return new dr(i+r)}else if(e instanceof dr){let i=Ee(e)+(r-1e6),s=qt(i);return fn(s)}else{let i=Ee(e)+r,s=qt(i);return fn(s)}}function Qo(e,t){if(Ze(t)===0)return e;{let n=Ee(e)-Ze(t),i=qt(n);return fn(i)}}function uc(e,t){let r=pr(e);return fr(r,tn(t))}function Di(e){let r=bo(e);return Ve(r)}function Xo(e,t){return fr(e,t)}function zi(e){let t=_r(e),r=t[0],n=t[1];if(r>=0&&n>=0)return e;{let s=r<0?-r:r,o=n<0?-n:n;return uc(s,o)}}function eu(e){return xo(e,pr(0))}function pn(e,t){return fr(e,eu(t))}function Ci(e){let t=_r(e),r=t[0],n=t[1];return r>=0&&n>=0}function Ni(e){let t=Ze(e);return vo(t)}function tu(e){return Ze(e)}function ru(){return Li()*6e7}function nu(){return new ji(Oi(),ru(),Ao(),Mo())}var mr=new Si(0);function iu(e){return new cn(Ho(e),Vo(e),mr)}function su(e,t){return ai(!Ci(t),()=>Fi(e,zi(t)),()=>{let r=Ni(t),n=pn(t,Di(r)),i=(()=>{let _=e.time,h=qi(_),m=pn(h,n);return tu(m)})(),s=i<0?[i+H,r+1]:[i,r],o=s[0],l=s[1],c=Ve(Ee(e.time)-o),p=(()=>{let _=e.date;return Go(_,l)})(),f=(()=>{let _=e.time;return Qo(_,c)})();return new Bt(p,f)})}function Fi(e,t){return ai(!Ci(t),()=>su(e,zi(t)),()=>{let r=Ni(t),n=pn(t,Di(r)),i=(()=>{let _=e.time,h=qi(_),m=Xo(h,n);return tu(m)})(),s=i>=H?[i-H,r+1]:[i,r],o=s[0],l=s[1],c=Ve(o-Ee(e.time)),p=(()=>{let _=e.date;return Ro(_,l)})(),f=(()=>{let _=e.time;return Ko(_,c)})();return new Bt(p,f)})}function ou(e){let t=(()=>{let n=Jo(e);return Fi(n,oc(e.offset))})();return new Bt(t.date,t.time)}function Pi(e){return Po(e)}function Yi(e){return Uo(e)}function _n(e){return Pi(I(e,1e3))}function dn(e){return Yi(e)*1e3}function _u(e){let t=(e-dn(_n(e)))*1e3;return qt(t)}function Lc(e,t,r){return Wo(e,t,r)}function Ui(e){return Lc(_n(e),_u(e),mr)}function jc(e){return ou(e)}function $r(e){let t=jc(e);return dn(Bi(t))+I(Ee(Ii(t)),1e3)}function du(){return nu()}function mu(e){return iu(e)}function $u(e){return Fo(e)}function we(e){return rr(e)}function hu(e,t){return xe("style",e,u([we(t)]))}function U(e,t){return xe("div",e,t)}function Ri(e){return xe("hr",e,u([]))}function hr(e,t){return xe("p",e,t)}function Gi(e,t){return xe("span",e,t)}function We(e,t){return xe("button",e,t)}function xu(e){return xe("input",e,u([]))}function wu(e,t){return xe("textarea",e,u([rr(t)]))}function Ke(e,t){return ro(e,t)}function Dt(e,t){return oo(e,t)}function Je(e){return Dt("click",t=>new w(e))}function Zi(e){return Dt("focus",t=>new w(e))}function Vi(e){return Dt("blur",t=>new w(e))}function Tc(e){let t=e;return oi("target",oi("value",Ns))(t)}function Ki(e){return Dt("input",t=>{let r=Tc(t);return pe(r,e)})}var hn="http://www.w3.org/2000/svg";function Qi(e){return At(hn,"line",e,u([]))}function Xi(e){return At(hn,"polyline",e,u([]))}function Qe(e,t){return At(hn,"svg",e,t)}function B(e){return At(hn,"path",e,u([]))}function yu(e){return Qe($(d("stroke-linejoin","round"),$(d("stroke-linecap","round"),$(d("stroke-width","2"),$(d("stroke","currentColor"),$(d("fill","none"),$(d("viewBox","0 0 24 24"),$(d("height","24"),$(d("width","24"),e)))))))),u([B(u([d("d","M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z")])),B(u([d("d","M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1")]))]))}function bu(e){return Qe($(d("stroke-linejoin","round"),$(d("stroke-linecap","round"),$(d("stroke-width","2"),$(d("stroke","currentColor"),$(d("fill","none"),$(d("viewBox","0 0 24 24"),$(d("height","24"),$(d("width","24"),e)))))))),u([B(u([d("d","M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13")])),B(u([d("d","m8 6 2-2")])),B(u([d("d","m18 16 2-2")])),B(u([d("d","m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17")])),B(u([d("d","M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z")])),B(u([d("d","m15 5 4 4")]))]))}function vu(e){return Qe($(d("stroke-linejoin","round"),$(d("stroke-linecap","round"),$(d("stroke-width","2"),$(d("stroke","currentColor"),$(d("fill","none"),$(d("viewBox","0 0 24 24"),$(d("height","24"),$(d("width","24"),e)))))))),u([B(u([d("d","m3 10 2.5-2.5L3 5")])),B(u([d("d","m3 19 2.5-2.5L3 14")])),B(u([d("d","M10 6h11")])),B(u([d("d","M10 12h11")])),B(u([d("d","M10 18h11")]))]))}function ku(e){return Qe($(d("stroke-linejoin","round"),$(d("stroke-linecap","round"),$(d("stroke-width","2"),$(d("stroke","currentColor"),$(d("fill","none"),$(d("viewBox","0 0 24 24"),$(d("height","24"),$(d("width","24"),e)))))))),u([Xi(u([d("points","15 3 21 3 21 9")])),Xi(u([d("points","9 21 3 21 3 15")])),Qi(u([d("y2","10"),d("y1","3"),d("x2","14"),d("x1","21")])),Qi(u([d("y2","14"),d("y1","21"),d("x2","10"),d("x1","3")]))]))}function es(e){return Qe($(d("stroke-linejoin","round"),$(d("stroke-linecap","round"),$(d("stroke-width","2"),$(d("stroke","currentColor"),$(d("fill","none"),$(d("viewBox","0 0 24 24"),$(d("height","24"),$(d("width","24"),e)))))))),u([B(u([d("d","M18 6 6 18")])),B(u([d("d","m6 6 12 12")]))]))}function Ou(e){return Qe($(d("stroke-linejoin","round"),$(d("stroke-linecap","round"),$(d("stroke-width","2"),$(d("stroke","currentColor"),$(d("fill","none"),$(d("viewBox","0 0 24 24"),$(d("height","24"),$(d("width","24"),e)))))))),u([B(u([d("d","M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z")])),B(u([d("d","m15 5 4 4")]))]))}var Lu="line-discussion";var xr=class extends a{constructor(t,r,n,i,s,o,l,c){super(),this.note_id=t,this.parent_id=r,this.significance=n,this.user_name=i,this.message=s,this.expanded_message=o,this.time=l,this.modifier=c}},Xe=class extends a{},et=class extends a{},tt=class extends a{},zt=class extends a{},rt=class extends a{},Ct=class extends a{},Nt=class extends a{},Ft=class extends a{},Wt=class extends a{},Jt=class extends a{},Pt=class extends a{},wr=class extends a{},gr=class extends a{},Yt=class extends a{};function qc(e){return e instanceof Xe?1:e instanceof et?2:e instanceof tt?3:e instanceof zt?4:e instanceof rt?5:e instanceof Ct?6:e instanceof Nt?7:e instanceof Ft?8:e instanceof Wt?9:e instanceof Jt?10:e instanceof Pt?11:12}function Dc(e){return e instanceof gr?0:e instanceof Yt?1:2}function ju(e){return $e(u([["n",me(e.note_id)],["p",me(e.parent_id)],["s",E((()=>{let t=e.significance;return qc(t)})())],["u",me(e.user_name)],["m",me(e.message)],["x",eo(e.expanded_message,me)],["t",E((()=>{let t=e.time;return $r(t)})())],["d",E((()=>{let t=e.modifier;return Dc(t)})())]]))}var ts=class extends a{constructor(t,r,n,i,s,o,l,c){super(),this.note_id=t,this.parent_id=r,this.significance=n,this.user_name=i,this.message=s,this.expanded_message=o,this.time=l,this.edited=c}},nt=class extends a{},it=class extends a{},st=class extends a{},ot=class extends a{},ut=class extends a{},lt=class extends a{},at=class extends a{},yr=class extends a{},ct=class extends a{},ft=class extends a{},pt=class extends a{},_t=class extends a{},dt=class extends a{},mt=class extends a{},$t=class extends a{},ht=class extends a{},xt=class extends a{},br=class extends a{};function zc(e){if(e===0)return new nt;if(e===1)return new it;if(e===2)return new st;if(e===3)return new ot;if(e===4)return new ut;if(e===5)return new lt;if(e===6)return new at;if(e===7)return new yr;if(e===8)return new ct;if(e===9)return new ft;if(e===10)return new pt;if(e===11)return new _t;if(e===12)return new dt;if(e===13)return new mt;if(e===14)return new $t;if(e===15)return new ht;if(e===16)return new xt;if(e===17)return new br;throw ce("panic","o11a/computed_note",128,"significance_from_int","Invalid note significance found",{})}function Cc(){return ee("n",W,e=>ee("p",W,t=>ee("s",Lt,r=>ee("u",W,n=>ee("m",W,i=>ee("x",li(W),s=>ee("t",Lt,o=>ee("e",zr,l=>Qt(new ts(e,t,zc(r),n,i,s,Ui(o),l))))))))))}function Au(e){return e instanceof nt?new b:e instanceof it?new x("Unanswered Question"):e instanceof st?new x("Answered"):e instanceof ot?new x("Answer"):e instanceof ut?new x("Incomplete ToDo"):e instanceof lt?new x("Complete"):e instanceof at?new x("Completion"):e instanceof yr?new x("Unconfirmed Finding"):e instanceof ct?new x("Confirmed Finding"):e instanceof ft?new x("Rejected Finding"):e instanceof pt?new x("Confirmation"):e instanceof _t?new x("Rejection"):e instanceof dt?new x("Unanswered Dev Question"):e instanceof mt?new x("Answered Dev Question"):e instanceof $t?new x("Info"):e instanceof ht?new x("Incorrect Info"):e instanceof xt?new x("Rejection"):new x("Confirmation")}function Mu(e){return e instanceof nt?!1:e instanceof it||e instanceof st?!0:e instanceof ot?!1:e instanceof ut||e instanceof lt?!0:e instanceof at?!1:e instanceof yr||e instanceof ct||e instanceof ft?!0:e instanceof pt||e instanceof _t?!1:e instanceof dt||e instanceof mt||e instanceof $t||e instanceof ht?!0:(e instanceof xt,!1)}function Tu(e){return Z(le(e,W),t=>pe((()=>{let r=Qs(t,Rs(Cc()));return Re(r,u([new _e("json-encoded computed note",fe(t),u([]))]))})(),r=>Ts(r,n=>n.parent_id)))}var Eu="user-submitted-line-note",Bu="user-clicked-discussion-preview",rs="user-focused-input",Iu="user-unfocused-input",qu="user-maximized-thread";function ns(e){return Dt("keydown",t=>{let r=ee("ctrlKey",zr,i=>ee("key",W,s=>Qt([i,s]))),n=u([new C("","",u([]))]);return Z((()=>{let i=le(t,r);return Re(i,n)})(),i=>{let s=i[0],o=i[1];return s&&o==="Enter"?new w(e):new g(n)})})}var D=class extends a{constructor(t,r,n,i,s,o,l,c,p,f,_,h,m,y){super(),this.user_name=t,this.line_number=r,this.line_id=n,this.line_tag=i,this.line_number_text=s,this.notes=o,this.current_note_draft=l,this.current_thread_id=c,this.current_thread_notes=p,this.active_thread=f,this.show_expanded_message_box=_,this.current_expanded_message_draft=h,this.expanded_messages=m,this.editing_note=y}},is=class extends a{constructor(t,r,n,i){super(),this.current_thread_id=t,this.parent_note=r,this.prior_thread_id=n,this.prior_thread=i}},xn=class extends a{constructor(t){super(),this[0]=t}},wn=class extends a{constructor(t){super(),this[0]=t}},gn=class extends a{constructor(t){super(),this[0]=t}},yn=class extends a{constructor(t){super(),this[0]=t}},vr=class extends a{},bn=class extends a{constructor(t,r){super(),this.new_thread_id=t,this.parent_note=r}},vn=class extends a{},kn=class extends a{constructor(t){super(),this[0]=t}},On=class extends a{constructor(t){super(),this[0]=t}},Ln=class extends a{constructor(t){super(),this.for_note_id=t}},ss=class extends a{},jn=class extends a{},Sn=class extends a{},kr=class extends a{},An=class extends a{},Mn=class extends a{constructor(t){super(),this[0]=t}},os=class extends a{};function Jc(e){return[new D("guest",0,"","","",G(),"","",u([]),new b,!1,new b,Jr(),new b),J()]}function Pc(e){let t=e.active_thread;if(t instanceof x){let r=t[0];return U(u([]),u([U(u([k("flex justify-end width-full")]),u([We(u([Je(new vn),k("icon-button flex gap-[.5rem] pl-[.5rem] pr-[.3rem] pt-[.3rem] pb-[.1rem] mb-[.25rem]")]),u([we("Close Thread"),es(u([]))]))])),we("Current Thread: "),we(r.parent_note.message),(()=>{let n=r.parent_note.expanded_message;if(n instanceof x){let i=n[0];return U(u([k("mt-[.5rem]")]),u([hr(u([]),u([we(i)]))]))}else return Te(u([]))})(),Ri(u([k("mt-[.5rem]")]))]))}else return U(u([k("flex items-center justify-between width-full")]),u([Gi(u([k("pt-[.1rem]")]),u([we(e.line_tag)])),We(u([Je(new An),k("icon-button p-[.3rem] ")]),u([ku(u([]))]))]))}function Yc(e){let t="input-border rounded-md text-[0.65rem] pb-[0.15rem] pt-1 px-[0.5rem]",r=Au(e);if(r instanceof x){let n=r[0];return Gi(u([k(t)]),u([we(n)]))}else return Te(u([]))}function Hc(e){return Y(e.current_thread_notes,t=>U(u([k("line-discussion-item")]),u([U(u([k("flex justify-between mb-[.2rem]")]),u([U(u([k("flex gap-[.5rem] items-start")]),u([hr(u([]),u([we(t.user_name)])),Yc(t.significance)])),U(u([k("flex gap-[.5rem]")]),u([We(u([he("edit-message-button"),k("icon-button p-[.3rem]"),Je(new Mn(t))]),u([Ou(u([]))])),t.expanded_message instanceof x?We(u([he("expand-message-button"),k("icon-button p-[.3rem]"),Je(new Ln(t.note_id))]),u([vu(u([]))])):Te(u([])),Mu(t.significance)?We(u([he("switch-thread-button"),k("icon-button p-[.3rem]"),Je(new bn(t.note_id,t))]),u([yu(u([]))])):Te(u([]))]))])),hr(u([]),u([we(t.message)])),$i(e.expanded_messages,t.note_id)?U(u([k("mt-[.5rem]")]),u([hr(u([]),u([we((()=>{let n=t.expanded_message;return Or(n,"")})())]))])):Te(u([])),Ri(u([k("mt-[.5rem]")]))])))}function Uc(e){return U(u([k("flex justify-between items-center gap-[.35rem]")]),u([We(u([he("toggle-expanded-message-button"),k("icon-button p-[.3rem]"),Je(new kn(!e.show_expanded_message_box))]),u([bu(u([]))])),e.editing_note instanceof x?We(u([he("cancel-message-edit-button"),k("icon-button p-[.3rem]"),Je(new os)]),u([es(u([]))])):Te(u([])),xu(u([he("new-comment-input"),k("inline-block w-full grow text-[0.9rem] pl-2 pb-[.2rem] p-[0.3rem] border-[none] border-t border-solid;"),_i("Add a new comment"),Ki(t=>new yn(t)),Zi(new jn),Vi(new kr),ns(new vr),lo(e.current_note_draft)]))]))}function Rc(e){let t="absolute overlay p-[.5rem] flex w-[100%] h-60 mt-2",r="grow text-[.95rem] resize-none p-[.3rem]";return U(u([he("expanded-message"),e.show_expanded_message_box?k(t+" show-exp"):k(t)]),u([wu(u([he("expanded-message-box"),k(r),_i("Write an expanded message body"),Ki(n=>new On(n)),Zi(new Sn),Vi(new kr),ns(new vr)]),(()=>{let n=e.current_expanded_message_draft;return Or(n,"")})())]))}function Gc(e,t){if(t){if(e==="done")return[new rt,"done"];if(e.startsWith("done: ")){let r=e.slice(6);return[new rt,r]}else if(e.startsWith("a: ")){let r=e.slice(3);return[new tt,r]}else if(e.startsWith("answer: ")){let r=e.slice(8);return[new tt,r]}else if(e.startsWith("reject: ")){let r=e.slice(8);return[new Ft,r]}else if(e.startsWith("confirm: ")){let r=e.slice(9);return[new Nt,r]}else if(e.startsWith("incorrect: ")){let r=e.slice(11);return[new Pt,r]}else if(e.startsWith("correct: ")){let r=e.slice(9);return[new wr,r]}else return[new Xe,e]}else if(e.startsWith("todo: ")){let r=e.slice(6);return[new zt,r]}else if(e.startsWith("q: ")){let r=e.slice(3);return[new et,r]}else if(e.startsWith("question: ")){let r=e.slice(10);return[new et,r]}else if(e.startsWith("finding: ")){let r=e.slice(9);return[new Ct,r]}else if(e.startsWith("dev: ")){let r=e.slice(5);return[new Wt,r]}else if(e.startsWith("info: ")){let r=e.slice(6);return[new Jt,r]}else return[new Xe,e]}function Zc(e){return e instanceof ot?"a: ":e instanceof mt?"dev: ":e instanceof st?"q: ":e instanceof nt?"":e instanceof lt?"todo: ":e instanceof ct?"finding: ":e instanceof pt?"confirm: ":e instanceof _t?"reject: ":e instanceof ut?"todo: ":e instanceof $t?"info: ":e instanceof br?"correct: ":e instanceof xt?"incorrect: ":e instanceof ft?"finding: ":e instanceof ht?"info: ":e instanceof at?"done: ":e instanceof dt?"dev: ":e instanceof it?"q: ":"finding: "}function Vc(e,t){if(t instanceof xn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,r,n.line_tag,n.line_number_text,n.notes,n.current_note_draft,r,(()=>{let i=se(e.notes,r);return Ot(i,u([]))})(),n.active_thread,n.show_expanded_message_box,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),J()]}else if(t instanceof wn){let r=t[0],n=T(r);return[(()=>{let i=e;return new D(i.user_name,r,i.line_id,"L"+n,n,i.notes,i.current_note_draft,i.current_thread_id,i.current_thread_notes,i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),J()]}else if(t instanceof gn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,r,n.current_note_draft,n.current_thread_id,(()=>{let i=se(r,e.current_thread_id);return Ot(i,u([]))})(),n.active_thread,n.show_expanded_message_box,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),J()]}else if(t instanceof yn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,n.notes,r,n.current_thread_id,n.current_thread_notes,n.active_thread,n.show_expanded_message_box,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),J()]}else if(t instanceof vr){let r=Gc(e.current_note_draft,qn(e.active_thread)),n=r[0],i=r[1];return ho(e.current_note_draft==="",()=>[e,J()],()=>{let s=du(),o=mu(s),l=e.user_name+(()=>{let y=$u(s);return T(y)})()+(()=>{let y=$r(o);return T(y)})();us("editing note "+fe(e.editing_note),"src/o11a/ui/line_discussion.gleam",219);let c=(()=>{let m=e.editing_note;if(m instanceof x){let y=m[0];return[new Yt,y.note_id]}else return[new gr,e.current_thread_id]})(),p=c[0],f=c[1];us("submitting note with parent id "+f,"src/o11a/ui/line_discussion.gleam",226);let _=(()=>{let m=(()=>{let y=e.current_expanded_message_draft;return Lr(y,Is)})();return m instanceof x&&m[0]===""?new b:m})(),h=new xr(l,f,n,"user"+(()=>{let m=Xn(100);return T(m)})(),i,_,o,p);return[(()=>{let m=e;return new D(m.user_name,m.line_number,m.line_id,m.line_tag,m.line_number_text,m.notes,"",m.current_thread_id,m.current_thread_notes,m.active_thread,!1,new b,m.expanded_messages,new b)})(),Ke(Eu,$e(u([["note",ju(h)],["line_id",me(e.line_id)]])))]})}else if(t instanceof bn){let r=t.new_thread_id,n=t.parent_note;return[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,i.notes,i.current_note_draft,r,(()=>{let s=se(e.notes,r);return Ot(s,u([]))})(),new x(new is(r,n,e.current_thread_id,e.active_thread)),i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),J()]}else if(t instanceof vn){let r=(()=>{let i=e.active_thread,s=Lr(i,o=>o.prior_thread);return ds(s)})(),n=(()=>{let i=Lr(r,s=>s.current_thread_id);return Or(i,e.line_id)})();return[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,i.notes,i.current_note_draft,n,(()=>{let s=se(e.notes,n);return Ot(s,u([]))})(),r,i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),J()]}else if(t instanceof kn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,n.notes,n.current_note_draft,n.current_thread_id,n.current_thread_notes,n.active_thread,r,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),J()]}else if(t instanceof On){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,n.notes,n.current_note_draft,n.current_thread_id,n.current_thread_notes,n.active_thread,n.show_expanded_message_box,new x(r),n.expanded_messages,n.editing_note)})(),J()]}else if(t instanceof Ln){let r=t.for_note_id;return $i(e.expanded_messages,r)?[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,i.notes,i.current_note_draft,i.current_thread_id,i.current_thread_notes,i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,ao(e.expanded_messages,r),i.editing_note)})(),J()]:[(()=>{let i=e;return new D(i.user_name,i.line_number,i.line_id,i.line_tag,i.line_number_text,i.notes,i.current_note_draft,i.current_thread_id,i.current_thread_notes,i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,hi(e.expanded_messages,r),i.editing_note)})(),J()]}else{if(t instanceof ss)return[e,Ke(Bu,$e(u([["line_number",E(e.line_number)],["discussion_lane",E(1)]])))];if(t instanceof jn)return[e,Ke(rs,$e(u([["line_number",E(e.line_number)],["discussion_lane",E(1)]])))];if(t instanceof Sn)return[(()=>{let r=e;return new D(r.user_name,r.line_number,r.line_id,r.line_tag,r.line_number_text,r.notes,r.current_note_draft,r.current_thread_id,r.current_thread_notes,r.active_thread,!0,r.current_expanded_message_draft,r.expanded_messages,r.editing_note)})(),Ke(rs,$e(u([["line_number",E(e.line_number)],["discussion_lane",E(1)]])))];if(t instanceof kr)return[e,Ke(Iu,$e(u([["line_number",E(e.line_number)],["discussion_lane",E(1)]])))];if(t instanceof An)return[e,Ke(qu,$e(u([["line_number",E(e.line_number)],["discussion_lane",E(1)]])))];if(t instanceof Mn){let r=t[0];return[(()=>{let n=e;return new D(n.user_name,n.line_number,n.line_id,n.line_tag,n.line_number_text,n.notes,Zc(r.significance)+r.message,n.current_thread_id,n.current_thread_notes,n.active_thread,r.expanded_message instanceof x,r.expanded_message,n.expanded_messages,new x(r))})(),J()]}else return[(()=>{let r=e;return new D(r.user_name,r.line_number,r.line_id,r.line_tag,r.line_number_text,r.notes,"",r.current_thread_id,r.current_thread_notes,r.active_thread,!1,new b,r.expanded_messages,new b)})(),J()]}}var Du=Lu,Kc=`
:host {
  display: inline-block;
}

/* Delay the overlay transitions by 1ms so they are done last, and any 
  actions on them can be done first (like focusing the input) */

#expanded-message {
  visibility: hidden;
  opacity: 0;
  transition-property: opacity, visibility;
  transition-delay: 1ms, 1ms;
}

#expanded-message.show-exp,
#expanded-message:focus-within {
  visibility: visible;
  opacity: 1;
}

button.icon-button {
  background-color: var(--overlay-background-color);
  color: var(--text-color);
  border-radius: 4px;
  border: none;
  cursor: pointer;
}

button.icon-button:hover {
  background-color: var(--input-background-color);
}

button.icon-button svg {
  height: 1.25rem;
  width: 1.25rem;
}

input, textarea {
  background-color: var(--input-background-color);
  color: var(--text-color);
  border-radius: 6px;
}

input, textarea {
  border: 1px solid var(--input-border-color);
}

hr {
  border: 1px solid var(--comment-color);
}

.overlay {
  background-color: var(--overlay-background-color);
  border: 1px solid var(--input-border-color);
  border-radius: 6px;
}

.absolute {
  position: absolute;
}
`;function Qc(e){return Zn("Rendering line discussion "+e.line_tag),U(u([he("line-discussion-overlay")]),u([hu(u([]),Kc),U(u([k("overlay p-[.5rem]")]),u([qn(e.active_thread)||ri(e.current_thread_notes)>0?U(u([he("comment-list"),k("flex flex-col-reverse overflow-auto max-h-[30rem] gap-[.5rem] mb-[.5rem]")]),u([Te(Hc(e)),Pc(e)])):Te(u([])),Uc(e)])),Rc(e)]))}function zu(){return _o(Jc,Vc,Qc,Er(u([["line-discussion",e=>{let t=(()=>{let r=Tu(e);if(r.isOk()){let n=r[0];return new w(new gn(n))}else return new g(u([new C("line-discussion",fe(e),u([]))]))})();return us("server updated line notes: "+fe(e)+", "+fe(t),"src/o11a/ui/line_discussion.gleam",54),t}],["line-id",e=>{let t=le(e,W);if(t.isOk()){let r=t[0];return new w(new xn(r))}else return new g(u([new C("line-id",fe(e),u([]))]))}],["line-number",e=>{let t=le(e,W);if(t.isOk()){let r=t[0],n=He(r);if(n.isOk()){let i=n[0];return new w(new wn(i))}else return new g(u([new C("line-number",r,u([]))]))}else return new g(u([new C("line-number",fe(e),u([]))]))}]])))}function us(e,t,r){let n="\x1B[90m",i="\x1B[39m",s=`${t}:${r}`,o=Be(e);if(typeof process=="object"&&process.stderr?.write){let l=`${n}${s}${i}
${o}
`;process.stderr.write(l)}else if(typeof Deno=="object"){let l=`${n}${s}${i}
${o}
`;Deno.stderr.writeSync(new TextEncoder().encode(l))}else{let l=`${s}
${o}`;console.log(l)}return e}function Xc(e){let t='"';for(let r=0;r<e.length;r++){let n=e[r];n==`
`?t+="\\n":n=="\r"?t+="\\r":n=="	"?t+="\\t":n=="\f"?t+="\\f":n=="\\"?t+="\\\\":n=='"'?t+='\\"':n<" "||n>"~"&&n<"\xA0"?t+="\\u{"+n.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":t+=n}return t+='"',t}function ef(e){let t="dict.from_list([",r=!0,n=[];return e.forEach((i,s)=>{n.push([s,i])}),n.sort(),n.forEach(([i,s])=>{r||(t=t+", "),t=t+"#("+Be(i)+", "+Be(s)+")",r=!1}),t+"])"}function tf(e){let t=Object.keys(e).map(r=>{let n=Be(e[r]);return isNaN(parseInt(r))?`${r}: ${n}`:n}).join(", ");return t?`${e.constructor.name}(${t})`:e.constructor.name}function rf(e){let t=Object.getPrototypeOf(e)?.constructor?.name||"Object",r=[];for(let s of Object.keys(e))r.push(`${Be(s)}: ${Be(e[s])}`);let n=r.length?" "+r.join(", ")+" ":"";return`//js(${t==="Object"?"":t+" "}{${n}})`}function Be(e){let t=typeof e;if(e===!0)return"True";if(e===!1)return"False";if(e===null)return"//js(null)";if(e===void 0)return"Nil";if(t==="string")return Xc(e);if(t==="bigint"||t==="number")return e.toString();if(Array.isArray(e))return`#(${e.map(Be).join(", ")})`;if(e instanceof M)return`[${e.toArray().map(Be).join(", ")}]`;if(e instanceof wt)return`//utfcodepoint(${String.fromCodePoint(e.value)})`;if(e instanceof ae)return nf(e);if(e instanceof a)return tf(e);if(sf(e))return ef(e);if(e instanceof Set)return`//js(Set(${[...e].map(Be).join(", ")}))`;if(e instanceof RegExp)return`//js(${e})`;if(e instanceof Date)return`//js(Date("${e.toISOString()}"))`;if(e instanceof Function){let r=[];for(let n of Array(e.length).keys())r.push(String.fromCharCode(n+97));return`//fn(${r.join(", ")}) { ... }`}return rf(e)}function nf(e){let t=e.bitOffset+8*Math.trunc(e.bitSize/8),r=In(e,e.bitOffset,t),n=e.bitSize%8;if(n>0){let i=fs(e,t,e.bitSize,!1,!1),s=Array.from(r.rawBuffer),o=`${i}:size(${n})`;return s.length===0?`<<${o}>>`:`<<${Array.from(r.rawBuffer).join(", ")}, ${o}>>`}else return`<<${Array.from(r.rawBuffer).join(", ")}>>`}function sf(e){try{return e instanceof ie}catch{return!1}}wi(zu(),Du);
