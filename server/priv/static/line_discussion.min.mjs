var a=class{withFields(t){let r=Object.keys(this).map(n=>n in t?t[n]:this[n]);return new this.constructor(...r)}},E=class{static fromArray(t,r){let n=r||new Nt;for(let i=t.length-1;i>=0;--i)n=new Ye(t[i],n);return n}[Symbol.iterator](){return new xn(this)}toArray(){return[...this]}atLeastLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return r!==void 0}hasLength(t){let r=this;for(;t-- >0&&r;)r=r.tail;return t===-1&&r instanceof Nt}countLength(){let t=this,r=0;for(;t;)t=t.tail,r++;return r-1}};function d(e,t){return new Ye(e,t)}function u(e,t){return E.fromArray(e,t)}var xn=class{#e;constructor(t){this.#e=t}next(){if(this.#e instanceof Nt)return{done:!0};{let{head:t,tail:r}=this.#e;return this.#e=r,{value:t,done:!1}}}},Nt=class extends E{},Ye=class extends E{constructor(t,r){super(),this.head=t,this.tail=r}},le=class{bitSize;byteSize;bitOffset;rawBuffer;constructor(t,r,n){if(!(t instanceof Uint8Array))throw globalThis.Error("BitArray can only be constructed from a Uint8Array");if(this.bitSize=r??t.length*8,this.byteSize=Math.trunc((this.bitSize+7)/8),this.bitOffset=n??0,this.bitSize<0)throw globalThis.Error(`BitArray bit size is invalid: ${this.bitSize}`);if(this.bitOffset<0||this.bitOffset>7)throw globalThis.Error(`BitArray bit offset is invalid: ${this.bitOffset}`);if(t.length!==Math.trunc((this.bitOffset+this.bitSize+7)/8))throw globalThis.Error("BitArray buffer length is invalid");this.rawBuffer=t}byteAt(t){if(!(t<0||t>=this.byteSize))return Ct(this.rawBuffer,this.bitOffset,t)}equals(t){if(this.bitSize!==t.bitSize)return!1;let r=Math.trunc(this.bitSize/8);if(this.bitOffset===0&&t.bitOffset===0){for(let i=0;i<r;i++)if(this.rawBuffer[i]!==t.rawBuffer[i])return!1;let n=this.bitSize%8;if(n){let i=8-n;if(this.rawBuffer[r]>>i!==t.rawBuffer[r]>>i)return!1}}else{for(let i=0;i<r;i++){let s=Ct(this.rawBuffer,this.bitOffset,i),o=Ct(t.rawBuffer,t.bitOffset,i);if(s!==o)return!1}let n=this.bitSize%8;if(n){let i=Ct(this.rawBuffer,this.bitOffset,r),s=Ct(t.rawBuffer,t.bitOffset,r),o=8-n;if(i>>o!==s>>o)return!1}}return!0}get buffer(){if(zi("buffer","Use BitArray.byteAt() or BitArray.rawBuffer instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.buffer does not support unaligned bit arrays");return this.rawBuffer}get length(){if(zi("length","Use BitArray.bitSize or BitArray.byteSize instead"),this.bitOffset!==0||this.bitSize%8!==0)throw new globalThis.Error("BitArray.length does not support unaligned bit arrays");return this.rawBuffer.length}};function Ct(e,t,r){if(t===0)return e[r]??0;{let n=e[r]<<t&255,i=e[r+1]>>8-t;return n|i}}var $t=class{constructor(t){this.value=t}},qi={};function zi(e,t){qi[e]||(console.warn(`Deprecated BitArray.${e} property used in JavaScript FFI code. ${t}.`),qi[e]=!0)}function wn(e,t,r){if(r??=e.bitSize,Ni(e,t,r),t===r)return new le(new Uint8Array);if(t===0&&r===e.bitSize)return e;t+=e.bitOffset,r+=e.bitOffset;let n=Math.trunc(t/8),s=Math.trunc((r+7)/8)-n,o;return n===0&&s===e.rawBuffer.byteLength?o=e.rawBuffer:o=new Uint8Array(e.rawBuffer.buffer,e.rawBuffer.byteOffset+n,s),new le(o,r-t,t%8)}function Ci(e,t,r,n,i){if(Ni(e,t,r),t===r)return 0;t+=e.bitOffset,r+=e.bitOffset;let s=t%8===0,o=r%8===0;if(s&&o)return qo(e,t/8,r/8,n,i);let l=r-t,c=Math.trunc(t/8),p=Math.trunc((r-1)/8);if(c==p){let f=255>>t%8,m=(8-r%8)%8,x=(e.rawBuffer[c]&f)>>m;if(i){let g=2**(l-1);x>=g&&(x-=g*2)}return x}return l<=53?Co(e.rawBuffer,t,r,n,i):No(e.rawBuffer,t,r,n,i)}function qo(e,t,r,n,i){return r-t<=6?zo(e.rawBuffer,t,r,n,i):Do(e.rawBuffer,t,r,n,i)}function zo(e,t,r,n,i){let s=r-t,o=0;if(n)for(let l=t;l<r;l++)o*=256,o+=e[l];else for(let l=r-1;l>=t;l--)o*=256,o+=e[l];if(i){let l=2**(s*8-1);o>=l&&(o-=l*2)}return o}function Do(e,t,r,n,i){let s=r-t,o=0n;if(n)for(let l=t;l<r;l++)o*=256n,o+=BigInt(e[l]);else for(let l=r-1;l>=t;l--)o*=256n,o+=BigInt(e[l]);if(i){let l=1n<<BigInt(s*8-1);o>=l&&(o-=l*2n)}return Number(o)}function Co(e,t,r,n,i){let s=t%8===0,o=r-t,l=Math.trunc(t/8),c=0;if(n){if(!s){let p=8-t%8;c=e[l++]&(1<<p)-1,o-=p}for(;o>=8;)c*=256,c+=e[l++],o-=8;o>0&&(c*=2**o,c+=e[l]>>8-o)}else if(s){let p=r-t,f=1;for(;p>=8;)c+=e[l++]*f,f*=256,p-=8;c+=(e[l]>>8-p)*f}else{let p=t%8,f=8-p,m=r-t,x=1;for(;m>=8;){let g=e[l]<<p|e[l+1]>>f;c+=(g&255)*x,x*=256,m-=8,l++}if(m>0){let g=m-Math.max(0,m-f),b=(e[l]&(1<<f)-1)>>f-g;m-=g,m>0&&(b*=2**m,b+=e[l+1]>>8-m),c+=b*x}}if(i){let p=2**(r-t-1);c>=p&&(c-=p*2)}return c}function No(e,t,r,n,i){let s=t%8===0,o=r-t,l=Math.trunc(t/8),c=0n;if(n){if(!s){let p=8-t%8;c=BigInt(e[l++]&(1<<p)-1),o-=p}for(;o>=8;)c*=256n,c+=BigInt(e[l++]),o-=8;o>0&&(c<<=BigInt(o),c+=BigInt(e[l]>>8-o))}else if(s){let p=r-t,f=0n;for(;p>=8;)c+=BigInt(e[l++])<<f,f+=8n,p-=8;c+=BigInt(e[l]>>8-p)<<f}else{let p=t%8,f=8-p,m=r-t,x=0n;for(;m>=8;){let g=e[l]<<p|e[l+1]>>f;c+=BigInt(g&255)<<x,x+=8n,m-=8,l++}if(m>0){let g=m-Math.max(0,m-f),b=(e[l]&(1<<f)-1)>>f-g;m-=g,m>0&&(b<<=m,b+=e[l+1]>>8-m),c+=BigInt(b)<<x}}if(i){let p=2n**BigInt(r-t-1);c>=p&&(c-=p*2n)}return Number(c)}function Ni(e,t,r){if(t<0||t>e.bitSize||r<t||r>e.bitSize){let n=`Invalid bit array slice: start = ${t}, end = ${r}, bit size = ${e.bitSize}`;throw new globalThis.Error(n)}}var ht=class e extends a{static isResult(t){return t instanceof e}},$=class extends ht{constructor(t){super(),this[0]=t}isOk(){return!0}},w=class extends ht{constructor(t){super(),this[0]=t}isOk(){return!1}};function v(e,t){let r=[e,t];for(;r.length;){let n=r.pop(),i=r.pop();if(n===i)continue;if(!Di(n)||!Di(i)||!Ro(n,i)||Wo(n,i)||Jo(n,i)||Po(n,i)||Yo(n,i)||Ho(n,i)||Uo(n,i))return!1;let o=Object.getPrototypeOf(n);if(o!==null&&typeof o.equals=="function")try{if(n.equals(i))continue;return!1}catch{}let[l,c]=Fo(n);for(let p of l(n))r.push(c(n,p),c(i,p))}return!0}function Fo(e){if(e instanceof Map)return[t=>t.keys(),(t,r)=>t.get(r)];{let t=e instanceof globalThis.Error?["message"]:[];return[r=>[...t,...Object.keys(r)],(r,n)=>r[n]]}}function Wo(e,t){return e instanceof Date&&(e>t||e<t)}function Jo(e,t){return!(e instanceof le)&&e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT&&!(e.byteLength===t.byteLength&&e.every((r,n)=>r===t[n]))}function Po(e,t){return Array.isArray(e)&&e.length!==t.length}function Yo(e,t){return e instanceof Map&&e.size!==t.size}function Ho(e,t){return e instanceof Set&&(e.size!=t.size||[...e].some(r=>!t.has(r)))}function Uo(e,t){return e instanceof RegExp&&(e.source!==t.source||e.flags!==t.flags)}function Di(e){return typeof e=="object"&&e!==null}function Ro(e,t){return typeof e!="object"&&typeof t!="object"&&(!e||!t)||[Promise,WeakSet,WeakMap,Function].some(n=>e instanceof n)?!1:e.constructor===t.constructor}function ee(e,t){return Math.trunc(xt(e,t))}function xt(e,t){return t===0?0:e/t}function ae(e,t,r,n,i,s){let o=new globalThis.Error(i);o.gleam_error=e,o.module=t,o.line=r,o.function=n,o.fn=n;for(let l in s)o[l]=s[l];return o}var h=class extends a{constructor(t){super(),this[0]=t}},y=class extends a{};function fr(e){return!v(e,new y)}function Fi(e,t){if(e instanceof h){let r=e[0];return new $(r)}else return new w(t)}function pr(e,t){return e instanceof h?e[0]:t}function _r(e,t){if(e instanceof h){let r=e[0];return new h(t(r))}else return new y}function Wi(e){return e instanceof h?e[0]:new y}var Ji=new WeakMap,gn=new DataView(new ArrayBuffer(8)),yn=0;function bn(e){let t=Ji.get(e);if(t!==void 0)return t;let r=yn++;return yn===2147483647&&(yn=0),Ji.set(e,r),r}function vn(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function On(e){let t=0,r=e.length;for(let n=0;n<r;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function Yi(e){gn.setFloat64(0,e);let t=gn.getInt32(0),r=gn.getInt32(4);return Math.imul(73244475,t>>16^t)^r}function Go(e){return On(e.toString())}function Zo(e){let t=Object.getPrototypeOf(e);if(t!==null&&typeof t.hashCode=="function")try{let n=e.hashCode(e);if(typeof n=="number")return n}catch{}if(e instanceof Promise||e instanceof WeakSet||e instanceof WeakMap)return bn(e);if(e instanceof Date)return Yi(e.getTime());let r=0;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||e instanceof Uint8Array)for(let n=0;n<e.length;n++)r=Math.imul(31,r)+te(e[n])|0;else if(e instanceof Set)e.forEach(n=>{r=r+te(n)|0});else if(e instanceof Map)e.forEach((n,i)=>{r=r+vn(te(n),te(i))|0});else{let n=Object.keys(e);for(let i=0;i<n.length;i++){let s=n[i],o=e[s];r=r+vn(te(o),On(s))|0}}return r}function te(e){if(e===null)return 1108378658;if(e===void 0)return 1108378659;if(e===!0)return 1108378657;if(e===!1)return 1108378656;switch(typeof e){case"number":return Yi(e);case"string":return On(e);case"bigint":return Go(e);case"object":return Zo(e);case"symbol":return bn(e);case"function":return bn(e);default:return 0}}var ge=5,Ln=Math.pow(2,ge),Vo=Ln-1,Ko=Ln/2,Qo=Ln/4,U=0,we=1,K=2,He=3,jn={type:K,bitmap:0,array:[]};function Ft(e,t){return e>>>t&Vo}function mr(e,t){return 1<<Ft(e,t)}function Xo(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Sn(e,t){return Xo(e&t-1)}function re(e,t,r){let n=e.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=e[s];return i[t]=r,i}function eu(e,t,r){let n=e.length,i=new Array(n+1),s=0,o=0;for(;s<t;)i[o++]=e[s++];for(i[o++]=r;s<n;)i[o++]=e[s++];return i}function kn(e,t){let r=e.length,n=new Array(r-1),i=0,s=0;for(;i<t;)n[s++]=e[i++];for(++i;i<r;)n[s++]=e[i++];return n}function Hi(e,t,r,n,i,s){let o=te(t);if(o===n)return{type:He,hash:o,array:[{type:U,k:t,v:r},{type:U,k:i,v:s}]};let l={val:!1};return Wt(An(jn,e,o,t,r,l),e,n,i,s,l)}function Wt(e,t,r,n,i,s){switch(e.type){case we:return tu(e,t,r,n,i,s);case K:return An(e,t,r,n,i,s);case He:return ru(e,t,r,n,i,s)}}function tu(e,t,r,n,i,s){let o=Ft(r,t),l=e.array[o];if(l===void 0)return s.val=!0,{type:we,size:e.size+1,array:re(e.array,o,{type:U,k:n,v:i})};if(l.type===U)return v(n,l.k)?i===l.v?e:{type:we,size:e.size,array:re(e.array,o,{type:U,k:n,v:i})}:(s.val=!0,{type:we,size:e.size,array:re(e.array,o,Hi(t+ge,l.k,l.v,r,n,i))});let c=Wt(l,t+ge,r,n,i,s);return c===l?e:{type:we,size:e.size,array:re(e.array,o,c)}}function An(e,t,r,n,i,s){let o=mr(r,t),l=Sn(e.bitmap,o);if(e.bitmap&o){let c=e.array[l];if(c.type!==U){let f=Wt(c,t+ge,r,n,i,s);return f===c?e:{type:K,bitmap:e.bitmap,array:re(e.array,l,f)}}let p=c.k;return v(n,p)?i===c.v?e:{type:K,bitmap:e.bitmap,array:re(e.array,l,{type:U,k:n,v:i})}:(s.val=!0,{type:K,bitmap:e.bitmap,array:re(e.array,l,Hi(t+ge,p,c.v,r,n,i))})}else{let c=e.array.length;if(c>=Ko){let p=new Array(32),f=Ft(r,t);p[f]=An(jn,t+ge,r,n,i,s);let m=0,x=e.bitmap;for(let g=0;g<32;g++){if(x&1){let b=e.array[m++];p[g]=b}x=x>>>1}return{type:we,size:c+1,array:p}}else{let p=eu(e.array,l,{type:U,k:n,v:i});return s.val=!0,{type:K,bitmap:e.bitmap|o,array:p}}}}function ru(e,t,r,n,i,s){if(r===e.hash){let o=Mn(e,n);if(o!==-1)return e.array[o].v===i?e:{type:He,hash:r,array:re(e.array,o,{type:U,k:n,v:i})};let l=e.array.length;return s.val=!0,{type:He,hash:r,array:re(e.array,l,{type:U,k:n,v:i})}}return Wt({type:K,bitmap:mr(e.hash,t),array:[e]},t,r,n,i,s)}function Mn(e,t){let r=e.array.length;for(let n=0;n<r;n++)if(v(t,e.array[n].k))return n;return-1}function dr(e,t,r,n){switch(e.type){case we:return nu(e,t,r,n);case K:return iu(e,t,r,n);case He:return su(e,n)}}function nu(e,t,r,n){let i=Ft(r,t),s=e.array[i];if(s!==void 0){if(s.type!==U)return dr(s,t+ge,r,n);if(v(n,s.k))return s}}function iu(e,t,r,n){let i=mr(r,t);if(!(e.bitmap&i))return;let s=Sn(e.bitmap,i),o=e.array[s];if(o.type!==U)return dr(o,t+ge,r,n);if(v(n,o.k))return o}function su(e,t){let r=Mn(e,t);if(!(r<0))return e.array[r]}function En(e,t,r,n){switch(e.type){case we:return ou(e,t,r,n);case K:return uu(e,t,r,n);case He:return lu(e,n)}}function ou(e,t,r,n){let i=Ft(r,t),s=e.array[i];if(s===void 0)return e;let o;if(s.type===U){if(!v(s.k,n))return e}else if(o=En(s,t+ge,r,n),o===s)return e;if(o===void 0){if(e.size<=Qo){let l=e.array,c=new Array(e.size-1),p=0,f=0,m=0;for(;p<i;){let x=l[p];x!==void 0&&(c[f]=x,m|=1<<p,++f),++p}for(++p;p<l.length;){let x=l[p];x!==void 0&&(c[f]=x,m|=1<<p,++f),++p}return{type:K,bitmap:m,array:c}}return{type:we,size:e.size-1,array:re(e.array,i,o)}}return{type:we,size:e.size,array:re(e.array,i,o)}}function uu(e,t,r,n){let i=mr(r,t);if(!(e.bitmap&i))return e;let s=Sn(e.bitmap,i),o=e.array[s];if(o.type!==U){let l=En(o,t+ge,r,n);return l===o?e:l!==void 0?{type:K,bitmap:e.bitmap,array:re(e.array,s,l)}:e.bitmap===i?void 0:{type:K,bitmap:e.bitmap^i,array:kn(e.array,s)}}return v(n,o.k)?e.bitmap===i?void 0:{type:K,bitmap:e.bitmap^i,array:kn(e.array,s)}:e}function lu(e,t){let r=Mn(e,t);if(r<0)return e;if(e.array.length!==1)return{type:He,hash:e.hash,array:kn(e.array,r)}}function Ui(e,t){if(e===void 0)return;let r=e.array,n=r.length;for(let i=0;i<n;i++){let s=r[i];if(s!==void 0){if(s.type===U){t(s.v,s.k);continue}Ui(s,t)}}}var ne=class e{static fromObject(t){let r=Object.keys(t),n=e.new();for(let i=0;i<r.length;i++){let s=r[i];n=n.set(s,t[s])}return n}static fromMap(t){let r=e.new();return t.forEach((n,i)=>{r=r.set(i,n)}),r}static new(){return new e(void 0,0)}constructor(t,r){this.root=t,this.size=r}get(t,r){if(this.root===void 0)return r;let n=dr(this.root,0,te(t),t);return n===void 0?r:n.v}set(t,r){let n={val:!1},i=this.root===void 0?jn:this.root,s=Wt(i,0,te(t),t,r,n);return s===this.root?this:new e(s,n.val?this.size+1:this.size)}delete(t){if(this.root===void 0)return this;let r=En(this.root,0,te(t),t);return r===this.root?this:r===void 0?e.new():new e(r,this.size-1)}has(t){return this.root===void 0?!1:dr(this.root,0,te(t),t)!==void 0}entries(){if(this.root===void 0)return[];let t=[];return this.forEach((r,n)=>t.push([n,r])),t}forEach(t){Ui(this.root,t)}hashCode(){let t=0;return this.forEach((r,n)=>{t=t+vn(te(r),te(n))|0}),t}equals(t){if(!(t instanceof e)||this.size!==t.size)return!1;try{return this.forEach((r,n)=>{if(!v(t.get(n,!r),r))throw Pi}),!0}catch(r){if(r===Pi)return!1;throw r}}},Pi=Symbol();var Vi=void 0,Ri={};function q(e){return e.toString()}function $r(e){let t=e.toString().replace("+","");if(t.indexOf(".")>=0)return t;{let r=t.indexOf("e");return r>=0?t.slice(0,r)+".0"+t.slice(r):t+".0"}}var Gi;function fu(e){if(globalThis.Intl&&Intl.Segmenter)return Gi||=new Intl.Segmenter,Gi.segment(e)[Symbol.iterator]()}function Ki(e){let t,r=fu(e);return r?t=r.next().value?.segment:t=e.match(/./su)?.[0],t?new $([t,e.slice(t.length)]):new w(Vi)}function Ie(e){let t="";for(let r of e)t=t+r;return t}var Qi=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),pu=new RegExp(`^[${Qi}]*`),_u=new RegExp(`[${Qi}]*$`);function Xi(e){return e.replace(pu,"")}function es(e){return e.replace(_u,"")}function Tn(e){console.log(e)}function Jt(e){return Math.floor(e)}function Bn(e){return Math.round(e)}function Pt(){let e=Math.random();return e===1?Pt():e}function G(){return ne.new()}function hr(e){return E.fromArray(e.entries())}function ts(e,t){return t.delete(e)}function ie(e,t){let r=e.get(t,Ri);return r===Ri?new w(Vi):new $(r)}function rs(e,t,r){return r.set(e,t)}function se(e){if(typeof e=="string")return"String";if(typeof e=="boolean")return"Bool";if(e instanceof ht)return"Result";if(e instanceof E)return"List";if(e instanceof le)return"BitArray";if(e instanceof ne)return"Dict";if(Number.isInteger(e))return"Int";if(Array.isArray(e))return`Tuple of ${e.length} elements`;if(typeof e=="number")return"Float";if(e===null)return"Null";if(e===void 0)return"Nil";{let t=typeof e;return t.charAt(0).toUpperCase()+t.slice(1)}}function In(e,t){return du(e,se(t))}function du(e,t){return new w(E.fromArray([new P(e,t,E.fromArray([]))]))}function qn(e){return typeof e=="string"?new $(e):In("String",e)}function ns(e){return Number.isInteger(e)?new $(e):In("Int",e)}function is(e,t){let r=()=>In("Dict",e);if(e instanceof ne||e instanceof WeakMap||e instanceof Map){let n=ie(e,t);return new $(n.isOk()?new h(n[0]):new y)}else return e===null?r():Object.getPrototypeOf(e)==Object.prototype?Zi(e,t,()=>new $(new y)):Zi(e,t,r)}function Zi(e,t,r){try{return t in e?new $(new h(e[t])):r()}catch{return r()}}function ye(e){let t=typeof e;if(e===!0)return"True";if(e===!1)return"False";if(e===null)return"//js(null)";if(e===void 0)return"Nil";if(t==="string")return mu(e);if(t==="bigint"||Number.isInteger(e))return e.toString();if(t==="number")return $r(e);if(Array.isArray(e))return`#(${e.map(ye).join(", ")})`;if(e instanceof E)return wu(e);if(e instanceof $t)return yu(e);if(e instanceof le)return gu(e);if(e instanceof a)return xu(e);if(e instanceof ne)return $u(e);if(e instanceof Set)return`//js(Set(${[...e].map(ye).join(", ")}))`;if(e instanceof RegExp)return`//js(${e})`;if(e instanceof Date)return`//js(Date("${e.toISOString()}"))`;if(e instanceof Function){let r=[];for(let n of Array(e.length).keys())r.push(String.fromCharCode(n+97));return`//fn(${r.join(", ")}) { ... }`}return hu(e)}function mu(e){let t='"';for(let r=0;r<e.length;r++){let n=e[r];switch(n){case`
`:t+="\\n";break;case"\r":t+="\\r";break;case"	":t+="\\t";break;case"\f":t+="\\f";break;case"\\":t+="\\\\";break;case'"':t+='\\"';break;default:n<" "||n>"~"&&n<"\xA0"?t+="\\u{"+n.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":t+=n}}return t+='"',t}function $u(e){let t="dict.from_list([",r=!0;return e.forEach((n,i)=>{r||(t=t+", "),t=t+"#("+ye(i)+", "+ye(n)+")",r=!1}),t+"])"}function hu(e){let t=Object.getPrototypeOf(e)?.constructor?.name||"Object",r=[];for(let s of Object.keys(e))r.push(`${ye(s)}: ${ye(e[s])}`);let n=r.length?" "+r.join(", ")+" ":"";return`//js(${t==="Object"?"":t+" "}{${n}})`}function xu(e){let t=Object.keys(e).map(r=>{let n=ye(e[r]);return isNaN(parseInt(r))?`${r}: ${n}`:n}).join(", ");return t?`${e.constructor.name}(${t})`:e.constructor.name}function wu(e){return`[${e.toArray().map(ye).join(", ")}]`}function gu(e){return`<<${Array.from(e.buffer).join(", ")}>>`}function yu(e){return`//utfcodepoint(${String.fromCodePoint(e.value)})`}function ku(e){return-1*e}function xr(e){return e>=0?Bn(e):0-Bn(ku(e))}function zn(e){let t=Pt()*e,r=Jt(t);return xr(r)}function be(e,t,r){return rs(t,r,e)}function Lu(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head[0],s=r.head[1];e=r.tail,t=be(n,i,s)}}}function gr(e){return Lu(e,G())}function ju(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=d(i,n)}}}function Su(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return ju(n,u([]));{let i=r.head[0];e=r.tail,t=d(i,n)}}}function Dn(e){return Su(hr(e),u([]))}function Cn(e,t){return ts(t,e)}function Mu(e,t){for(;;){let r=e,n=t;if(r.atLeastLength(1))e=r.tail,t=n+1;else return n}}function Nn(e){return Mu(e,0)}function Eu(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=d(i,n)}}}function z(e){return Eu(e,u([]))}function ss(e){if(e.hasLength(0))return new w(void 0);{let t=e.head;return new $(t)}}function Tu(e){return(t,r)=>{let n=ie(t,e(r));if(n.isOk()){let i=n[0];return be(t,e(r),d(r,i))}else return be(t,e(r),u([r]))}}function Bu(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return z(s);{let o=n.head,l=n.tail,c=(()=>{let p=i(o);if(p.isOk()){let f=p[0];return d(f,s)}else return s})();e=l,t=i,r=c}}}function Ht(e,t){return Bu(e,t,u([]))}function Iu(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return z(s);{let o=n.head;e=n.tail,t=i,r=d(i(o),s)}}}function R(e,t){return Iu(e,t,u([]))}function qu(e,t){for(;;){let r=e,n=t;if(r.hasLength(0))return n;{let i=r.head;e=r.tail,t=d(i,n)}}}function gt(e,t){return qu(z(e),t)}function oe(e,t,r){for(;;){let n=e,i=t,s=r;if(n.hasLength(0))return i;{let o=n.head;e=n.tail,t=s(i,o),r=s}}}function os(e,t){return oe(e,G(),Tu(t))}function zu(e,t,r,n){for(;;){let i=e,s=t,o=r,l=n;if(i.hasLength(0))return s;{let c=i.head;e=i.tail,t=o(s,c,l),r=o,n=l+1}}}function br(e,t,r){return zu(e,t,r,0)}function Jn(e){let r=Xi(e);return es(r)}function vr(e,t){for(;;){let r=e,n=t;if(n>0){let s=Ki(r);if(s.isOk())e=s[0][1],t=n-1;else return r}else return r}}function De(e){let t=ye(e);return t}function fs(e){return!!e.isOk()}function ce(e,t){if(e.isOk()){let r=e[0];return new $(t(r))}else{let r=e[0];return new w(r)}}function Me(e,t){if(e.isOk()){let r=e[0];return new $(r)}else{let r=e[0];return new w(t(r))}}function Y(e,t){if(e.isOk()){let r=e[0];return t(r)}else{let r=e[0];return new w(r)}}function Pn(e,t){return Y(e,t)}function bt(e,t){return e.isOk()?e[0]:t}function Ee(e,t){if(e.isOk()){let r=e[0];return new $(r)}else return new w(t)}var P=class extends a{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}};function Vu(e,t){return Me(e,r=>R(r,t))}function ps(e){return qn(e)}function _s(e){return t=>{if(e.hasLength(0))return new w(u([new P("another type",se(t),u([]))]));{let r=e.head,n=e.tail,i=r(t);if(i.isOk()){let s=i[0];return new $(s)}else return _s(n)(t)}}}function Ku(e,t){let r=t,n=_s(u([qn,o=>ce(ns(o),q)])),i=(()=>{let o=n(r);if(o.isOk())return o[0];{let l=u(["<",se(r),">"]),c=Ie(l);return c}})(),s=e;return new P(s.expected,s.found,d(i,e.path))}function Yn(e,t){return r=>{let n=new P("field","nothing",u([]));return Y(is(r,e),i=>{let o=Fi(i,u([n])),l=Y(o,t);return Vu(l,c=>Ku(c,e))})}}function ds(e,t){let r=Number.isInteger(t);if(e instanceof ne||e instanceof WeakMap||e instanceof Map){let n={},i=e.get(t,n);return i===n?new $(new y):new $(new h(i))}if(Number.isInteger(t)&&t<8&&e instanceof E){let n=0;for(let i of e){if(n===t)return new $(new h(i));n++}return new w("Indexable")}return r&&Array.isArray(e)||e&&typeof e=="object"||e&&Object.getPrototypeOf(e)===Object.prototype?t in e?new $(new h(e[t])):new $(new y):new w(r?"Indexable":"Dict")}function ms(e,t,r,n,i){if(!(e instanceof E||Array.isArray(e))){let o=new fe("List",se(e),i);return[i,E.fromArray([o])]}let s=[];for(let o of e){let l=t(o),[c,p]=l;if(p instanceof Ye){let[f,m]=r(l,n.toString());return[i,m]}s.push(c),n++}return[E.fromArray(s),i]}function $s(e){return Number.isInteger(e)?new $(e):new w(0)}function hs(e){return typeof e=="string"?new $(e):new w(0)}function xs(e){return e==null}var fe=class extends a{constructor(t,r,n){super(),this.expected=t,this.found=r,this.path=n}},pe=class extends a{constructor(t){super(),this.function=t}};function ue(e,t){let r=t.function(e),n=r[0],i=r[1];return i.hasLength(0)?new $(n):new w(i)}function Ce(e){return new pe(t=>[e,u([])])}function Qu(e,t){return new pe(r=>{let n=e.function(r),i=n[0],s=n[1];return[t(i),s]})}function Xu(e,t,r){for(;;){let n=e,i=t,s=r;if(s.hasLength(0))return i;{let o=s.head,l=s.tail,c=o.function(n),p=c;if(c[1].hasLength(0))return p;e=n,t=i,r=l}}}function el(e,t){return new pe(r=>{let n=e.function(r),i=n;return n[1].hasLength(0)?i:Xu(r,i,t)})}function Un(e){return new pe(t=>{if(xs(t))return[new y,u([])];{let n=e.function(t),i=n[0],s=n[1];return[new h(i),s]}})}function tl(e,t){return u([new fe(e,se(t),u([]))])}function ws(e,t,r){let n=r(e);return n.isOk()?[n[0],u([])]:[n[0],u([new fe(t,se(e),u([]))])]}function rl(e){return v(!0,e)?[!0,u([])]:v(!1,e)?[!1,u([])]:[!1,tl("Bool",e)]}function nl(e){return ws(e,"Int",$s)}var Re=new pe(rl),Ne=new pe(nl);function il(e){return ws(e,"String",hs)}var B=new pe(il);function gs(e){return new pe(t=>ms(t,e.function,(r,n)=>kr(r,u([n])),0,u([])))}function kr(e,t){let r=el(B,u([Qu(Ne,q)])),n=R(t,s=>{let o=s,l=ue(o,r);return l.isOk()?l[0]:"<"+se(o)+">"}),i=R(e[1],s=>{let o=s;return new fe(o.expected,o.found,gt(n,s.path))});return[e[0],i]}function sl(e,t,r,n,i){for(;;){let s=e,o=t,l=r,c=n,p=i;if(s.hasLength(0)){let f=l(c);return kr(f,z(o))}else{let f=s.head,m=s.tail,x=ds(c,f);if(x.isOk()&&x[0]instanceof h){let g=x[0][0];e=m,t=d(f,o),r=l,n=g,i=p}else{if(x.isOk()&&x[0]instanceof y)return p(c,d(f,o));{let g=x[0],X=[l(c)[0],u([new fe(g,se(c),u([]))])];return kr(X,z(o))}}}}}function ys(e,t,r){return new pe(n=>{let i=sl(e,u([]),t.function,n,(f,m)=>{let b=[t.function(f)[0],u([new fe("Field","Nothing",u([]))])];return kr(b,z(m))}),s=i[0],o=i[1],l=r(s).function(n),c=l[0],p=l[1];return[c,gt(o,p)]})}function A(e,t,r){return ys(u([e]),t,r)}function bs(e){return Object.fromEntries(e)}function vs(){return null}function ks(e){try{let t=JSON.parse(e);return new $(t)}catch(t){return new w(ul(t,e))}}function ul(e,t){return ll(e)?new Lr:al(e,t)}function ll(e){return/((unexpected (end|eof))|(end of data)|(unterminated string)|(json( parse error|\.parse)\: expected '(\:|\}|\])'))/i.test(e.message)}function al(e,t){let r=[cl,fl,_l,pl];for(let n of r){let i=n(e,t);if(i)return i}return new Fe("",0)}function cl(e){let r=/unexpected token '(.)', ".+" is not valid JSON/i.exec(e.message);if(!r)return null;let n=Or(r[1]);return new Fe(n,-1)}function fl(e){let r=/unexpected token (.) in JSON at position (\d+)/i.exec(e.message);if(!r)return null;let n=Or(r[1]),i=Number(r[2]);return new Fe(n,i)}function pl(e,t){let n=/(unexpected character|expected .*) at line (\d+) column (\d+)/i.exec(e.message);if(!n)return null;let i=Number(n[2]),s=Number(n[3]),o=dl(i,s,t),l=Or(t[o]);return new Fe(l,o)}function _l(e){let r=/unexpected (identifier|token) "(.)"/i.exec(e.message);if(!r)return null;let n=Or(r[2]);return new Fe(n,0)}function Or(e){return"0x"+e.charCodeAt(0).toString(16).toUpperCase()}function dl(e,t,r){if(e===1)return t-1;let n=1,i=0;return r.split("").find((s,o)=>(s===`
`&&(n+=1),n===e?(i=o+t,!0):!1)),i}var Lr=class extends a{},Fe=class extends a{constructor(t){super(),this[0]=t}};var Gn=class extends a{constructor(t){super(),this[0]=t}};function $l(e,t){return Pn(ks(e),r=>{let n=ue(r,t);return Me(n,i=>new Gn(i))})}function jr(e,t){return $l(e,t)}function ke(e){return e}function C(e){return e}function Os(){return vs()}function Ls(e,t){if(e instanceof h){let r=e[0];return t(r)}else return Os()}function _e(e){return bs(e)}var Sr=class extends a{constructor(t){super(),this.all=t}};function Vn(e){return new Sr(u([t=>e(t.dispatch,t.emit,t.select,t.root)]))}function js(e){return Vn((t,r,n,i)=>e(t))}function Ss(e,t){return Vn((r,n,i,s)=>n(e,t))}function N(){return new Sr(u([]))}var vt=class extends a{constructor(t){super(),this.content=t}},M=class extends a{constructor(t,r,n,i,s,o,l){super(),this.key=t,this.namespace=r,this.tag=n,this.attrs=i,this.children=s,this.self_closing=o,this.void=l}},Rt=class extends a{constructor(t){super(),this.subtree=t}},kt=class extends a{constructor(t,r,n){super(),this[0]=t,this[1]=r,this.as_property=n}},Gt=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}};function yl(e){if(e instanceof kt)return new w(void 0);{let t=e[0],r=e[1],n=vr(t,2);return new $([n,r])}}function bl(e,t,r){return br(e,t,(n,i,s)=>{let o=r+"-"+q(s);return As(i,n,o)})}function As(e,t,r){for(;;){let n=e,i=t,s=r;if(n instanceof vt)return i;if(n instanceof Rt){let o=n.subtree;e=o(),t=i,r=s}else{let o=n.attrs,l=n.children,c=oe(o,i,(p,f)=>{let m=yl(f);if(m.isOk()){let x=m[0][0],g=m[0][1];return be(p,s+"-"+x,g)}else return p});return bl(l,c,s)}}}function Ms(e){return As(e,G(),"0")}function _(e,t){return new kt(e,t,!1)}function Ts(e,t){return new Gt("on"+e,t)}function Bs(e){return _("style",oe(e,"",(t,r)=>{let n=r[0],i=r[1];return t+n+":"+i+";"}))}function k(e){return _("class",e)}function de(e){return _("id",e)}function Is(e){return _("value",e)}function Kn(e){return _("placeholder",e)}function Qn(e){return _("href",e)}function me(e,t,r){return e==="area"?new M("","",e,t,u([]),!1,!0):e==="base"?new M("","",e,t,u([]),!1,!0):e==="br"?new M("","",e,t,u([]),!1,!0):e==="col"?new M("","",e,t,u([]),!1,!0):e==="embed"?new M("","",e,t,u([]),!1,!0):e==="hr"?new M("","",e,t,u([]),!1,!0):e==="img"?new M("","",e,t,u([]),!1,!0):e==="input"?new M("","",e,t,u([]),!1,!0):e==="link"?new M("","",e,t,u([]),!1,!0):e==="meta"?new M("","",e,t,u([]),!1,!0):e==="param"?new M("","",e,t,u([]),!1,!0):e==="source"?new M("","",e,t,u([]),!1,!0):e==="track"?new M("","",e,t,u([]),!1,!0):e==="wbr"?new M("","",e,t,u([]),!1,!0):new M("","",e,t,r,!1,!1)}function Ot(e,t,r,n){return new M("",e,t,r,n,!1,!1)}function Zt(e){return new vt(e)}function $e(e){return me("lustre-fragment",u([Bs(u([["display","contents"]]))]),e)}var Vt=class extends a{constructor(t){super(),this.dict=t}};function Mr(){return new Vt(G())}function ti(e,t){let r=e.dict,n=ie(r,t);return fs(n)}function qs(e,t){return new Vt(Cn(e.dict,t))}var vl=void 0;function ri(e,t){return new Vt(be(e.dict,t,vl))}var Er=class extends a{constructor(t){super(),this[0]=t}},Tr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}},Br=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}};function Cs(e){return v(e.created,G())&&v(e.removed,Mr())&&v(e.updated,G())}var Ir=class extends a{constructor(t){super(),this[0]=t}},qr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}},Lt=class extends a{constructor(t){super(),this[0]=t}},V=class extends a{constructor(t){super(),this[0]=t}},jt=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}},zr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}};var Qt=class extends a{},Dr=class extends a{constructor(t,r){super(),this[0]=t,this[1]=r}},Cr=class extends a{constructor(t){super(),this[0]=t}},Xt=class extends a{constructor(t){super(),this[0]=t}};var ni=class extends a{constructor(t,r,n,i){super(),this.init=t,this.update=r,this.view=n,this.on_attribute_change=i}};var Nr=class extends a{constructor(t){super(),this.name=t}},Fr=class extends a{constructor(t){super(),this.name=t}},Wr=class extends a{constructor(t){super(),this.selector=t}},er=class extends a{};function Ns(e,t,r,n){return new ni(e,t,r,new h(n))}globalThis.customElements&&!globalThis.customElements.get("lustre-fragment")&&globalThis.customElements.define("lustre-fragment",class extends HTMLElement{constructor(){super()}});function nr(e,t,r){let n,i=[{prev:e,next:t,parent:e.parentNode}];for(;i.length;){let{prev:s,next:o,parent:l}=i.pop();for(;o.subtree!==void 0;)o=o.subtree();if(o.content!==void 0)if(s)if(s.nodeType===Node.TEXT_NODE)s.textContent!==o.content&&(s.textContent=o.content),n??=s;else{let c=document.createTextNode(o.content);l.replaceChild(c,s),n??=c}else{let c=document.createTextNode(o.content);l.appendChild(c),n??=c}else if(o.tag!==void 0){let c=Ml({prev:s,next:o,dispatch:r,stack:i});s?s!==c&&l.replaceChild(c,s):l.appendChild(c),n??=c}}return n}function Ml({prev:e,next:t,dispatch:r,stack:n}){let i=t.namespace||"http://www.w3.org/1999/xhtml",s=e&&e.nodeType===Node.ELEMENT_NODE&&e.localName===t.tag&&e.namespaceURI===(t.namespace||"http://www.w3.org/1999/xhtml"),o=s?e:i?document.createElementNS(i,t.tag):document.createElement(t.tag),l;if(tr.has(o))l=tr.get(o);else{let O=new Map;tr.set(o,O),l=O}let c=s?new Set(l.keys()):null,p=s?new Set(Array.from(e.attributes,O=>O.name)):null,f=null,m=null,x=null;if(s&&t.tag==="textarea"){let O=t.children[Symbol.iterator]().next().value?.content;O!==void 0&&(o.value=O)}let g=[];for(let O of t.attrs){let L=O[0],J=O[1];if(O.as_property)o[L]!==J&&(o[L]=J),s&&p.delete(L);else if(L.startsWith("on")){let xe=L.slice(2),hn=r(J,xe==="input");l.has(xe)||o.addEventListener(xe,rr),l.set(xe,hn),s&&c.delete(xe)}else if(L.startsWith("data-lustre-on-")){let xe=L.slice(15),hn=r(El);l.has(xe)||o.addEventListener(xe,rr),l.set(xe,hn),o.setAttribute(L,J),s&&(c.delete(xe),p.delete(L))}else L.startsWith("delegate:data-")||L.startsWith("delegate:aria-")?(o.setAttribute(L,J),g.push([L.slice(10),J])):L==="class"?f=f===null?J:f+" "+J:L==="style"?m=m===null?J:m+J:L==="dangerous-unescaped-html"?x=J:(o.getAttribute(L)!==J&&o.setAttribute(L,J),(L==="value"||L==="selected")&&(o[L]=J),s&&p.delete(L))}if(f!==null&&(o.setAttribute("class",f),s&&p.delete("class")),m!==null&&(o.setAttribute("style",m),s&&p.delete("style")),s){for(let O of p)o.removeAttribute(O);for(let O of c)l.delete(O),o.removeEventListener(O,rr)}if(t.tag==="slot"&&window.queueMicrotask(()=>{for(let O of o.assignedElements())for(let[L,J]of g)O.hasAttribute(L)||O.setAttribute(L,J)}),t.key!==void 0&&t.key!=="")o.setAttribute("data-lustre-key",t.key);else if(x!==null)return o.innerHTML=x,o;let b=o.firstChild,W=null,X=null,he=null,$n=Jr(t).next().value;if(s&&$n!==void 0&&$n.key!==void 0&&$n.key!==""){W=new Set,X=Fs(e),he=Fs(t);for(let O of Jr(t))b=Tl(b,O,o,n,he,X,W)}else for(let O of Jr(t))n.unshift({prev:b,next:O,parent:o}),b=b?.nextSibling;for(;b;){let O=b.nextSibling;o.removeChild(b),b=O}return o}var tr=new WeakMap;function rr(e){let t=e.currentTarget;if(!tr.has(t)){t.removeEventListener(e.type,rr);return}let r=tr.get(t);if(!r.has(e.type)){t.removeEventListener(e.type,rr);return}r.get(e.type)(e)}function El(e){let t=e.currentTarget,r=t.getAttribute(`data-lustre-on-${e.type}`),n=JSON.parse(t.getAttribute("data-lustre-data")||"{}"),i=JSON.parse(t.getAttribute("data-lustre-include")||"[]");switch(e.type){case"input":case"change":i.push("target.value");break}return{tag:r,data:i.reduce((s,o)=>{let l=o.split(".");for(let c=0,p=s,f=e;c<l.length;c++)c===l.length-1?p[l[c]]=f[l[c]]:(p[l[c]]??={},f=f[l[c]],p=p[l[c]]);return s},{data:n})}}function Fs(e){let t=new Map;if(e)for(let r of Jr(e)){let n=r?.key||r?.getAttribute?.("data-lustre-key");n&&t.set(n,r)}return t}function Tl(e,t,r,n,i,s,o){for(;e&&!i.has(e.getAttribute("data-lustre-key"));){let c=e.nextSibling;r.removeChild(e),e=c}if(s.size===0)return n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e;if(o.has(t.key))return console.warn(`Duplicate key found in Lustre vnode: ${t.key}`),n.unshift({prev:null,next:t,parent:r}),e;o.add(t.key);let l=s.get(t.key);if(!l&&!e)return n.unshift({prev:null,next:t,parent:r}),e;if(!l&&e!==null){let c=document.createTextNode("");return r.insertBefore(c,e),n.unshift({prev:c,next:t,parent:r}),e}return!l||l===e?(n.unshift({prev:e,next:t,parent:r}),e=e?.nextSibling,e):(r.insertBefore(l,e),n.unshift({prev:l,next:t,parent:r}),e)}function*Jr(e){for(let t of e.children)yield*Ws(t)}function*Ws(e){e.subtree!==void 0?yield*Ws(e.subtree()):yield e}var oi=class e{static start({init:t,update:r,view:n},i,s){if(!si())return new w(new er);let o=i instanceof HTMLElement?i:document.querySelector(i);if(!o)return new w(new Wr(i));let l=new e(o,t(s),r,n);return new $(c=>l.send(c))}constructor(t,[r,n],i,s){this.root=t,this.#e=r,this.#s=i,this.#r=s,this.#t=window.setTimeout(()=>this.#i(n.all.toArray(),!0),0)}root;send(t){if(t instanceof Lt){if(t[0]instanceof Xt){this.#t=window.clearTimeout(this.#t),this.#n=[],this.#e=t[0][0];let r=this.#r(this.#e),n=(s,o=!1)=>l=>{let c=s(l);c instanceof $&&this.send(new V(c[0],o))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));nr(i,r,n)}}else if(t instanceof V){let r=t[0],n=t[1]??!1;this.#n.push(r),n?(this.#t=window.clearTimeout(this.#t),this.#i()):this.#t||(this.#t=window.setTimeout(()=>this.#i()))}else if(t instanceof jt){let r=t[0],n=t[1];this.root.dispatchEvent(new CustomEvent(r,{detail:n,bubbles:!0,composed:!0}))}else if(t instanceof Qt)for(this.#t=window.clearTimeout(this.#t),this.#e=null,this.#s=null,this.#r=null,this.#n=null;this.root.firstChild;)this.root.firstChild.remove()}#e;#s;#r;#n=[];#t;#i(t=[]){this.#t=void 0,this.#o(t);let r=this.#r(this.#e),n=(s,o=!1)=>l=>{let c=s(l);c instanceof $&&this.send(new V(c[0],o))},i=this.root.firstChild??this.root.appendChild(document.createTextNode(""));nr(i,r,n)}#o(t=[]){for(;this.#n.length>0;){let r=this.#n.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;){let r=t.shift(),n=l=>this.send(new V(l)),i=(l,c)=>this.root.dispatchEvent(new CustomEvent(l,{detail:c,bubbles:!0,composed:!0})),s=()=>{},o=this.root;r({dispatch:n,emit:i,select:s,root:o})}this.#n.length>0&&this.#o(t)}},Sl=oi.start,ii=({init:e,update:t,view:r,on_attribute_change:n},i)=>{if(!si())return new w(new er);if(!i.includes("-"))return new w(new Nr(i));if(window.customElements.get(i))return new w(new Fr(i));let[s,o]=e(void 0),l=n instanceof h,c=class extends HTMLElement{static get observedAttributes(){return l?n[0].entries().map(([f])=>f):[]}constructor(){super(),this.attachShadow({mode:"open"}),this.internals=this.attachInternals(),l&&n[0].forEach((f,m)=>{let x=`__mirrored__${m}`;Object.defineProperty(this,m,{get(){return this[x]},set(g){let b=this[x];if(this.#t&&v(b,g))return;this[x]=g;let W=f(g);W instanceof w||(this.#r.push(W[0]),this.#t&&!this.#n&&(this.#n=window.requestAnimationFrame(()=>this.#i())))}})})}connectedCallback(){this.#u().finally(()=>{this.#i(o.all.toArray(),!0),this.#t=!0})}attributeChangedCallback(f,m,x){m!==x&&(this[f]=x)}disconnectedCallback(){this.#s=null,this.#r=[],this.#n=window.cancelAnimationFrame(this.#n),this.#t=!1}send(f){if(f instanceof Lt){if(f[0]instanceof Xt){this.#n=window.cancelAnimationFrame(this.#n),this.#r=[],this.#s=f[0][0];let m=r(this.#s),x=(b,W=!1)=>X=>{let he=b(X);he instanceof $&&this.send(new V(he[0],W))},g=this.shadowRoot.childNodes[this.#e.length]??this.shadowRoot.appendChild(document.createTextNode(""));nr(g,m,x)}}else if(f instanceof V){let m=f[0],x=f[1]??!1;this.#r.push(m),x?(this.#n=window.cancelAnimationFrame(this.#n),this.#i()):this.#n||(this.#n=window.requestAnimationFrame(()=>this.#i()))}else if(f instanceof jt){let m=f[0],x=f[1];this.dispatchEvent(new CustomEvent(m,{detail:x,bubbles:!0,composed:!0}))}}#e=[];#s=s;#r=[];#n;#t=!0;#i(f=[]){if(!this.#t)return;this.#n=void 0,this.#o(f);let m=r(this.#s),x=(b,W=!1)=>X=>{let he=b(X);he instanceof $&&this.send(new V(he[0],W))},g=this.shadowRoot.childNodes[this.#e.length]??this.shadowRoot.appendChild(document.createTextNode(""));nr(g,m,x)}#o(f=[]){for(;this.#r.length>0;){let m=this.#r.shift(),[x,g]=t(this.#s,m);f=f.concat(g.all.toArray()),this.#s=x}for(;f.length>0;){let m=f.shift(),x=X=>this.send(new V(X)),g=(X,he)=>this.dispatchEvent(new CustomEvent(X,{detail:he,bubbles:!0,composed:!0})),b=()=>{},W=this.shadowRoot;m({dispatch:x,emit:g,select:b,root:W})}this.#r.length>0&&this.#o(f)}async#u(){let f=[];for(let x of document.querySelectorAll("link[rel=stylesheet]"))x.sheet||f.push(new Promise((g,b)=>{x.addEventListener("load",g),x.addEventListener("error",b)}));for(await Promise.allSettled(f);this.#e.length;)this.#e.shift().remove(),this.shadowRoot.firstChild.remove();this.shadowRoot.adoptedStyleSheets=this.getRootNode().adoptedStyleSheets;let m=[];for(let x of document.styleSheets)try{this.shadowRoot.adoptedStyleSheets.push(x)}catch{try{let g=new CSSStyleSheet;for(let b of x.cssRules)g.insertRule(b.cssText,g.cssRules.length);this.shadowRoot.adoptedStyleSheets.push(g)}catch{let g=x.ownerNode.cloneNode();this.shadowRoot.prepend(g),this.#e.push(g),m.push(new Promise((b,W)=>{g.onload=b,g.onerror=W}))}}return Promise.allSettled(m)}};return window.customElements.define(i,c),new $(void 0)},ui=class e{static start({init:t,update:r,view:n,on_attribute_change:i},s){let o=new e(t(s),r,n,i);return new $(l=>o.send(l))}constructor([t,r],n,i,s){this.#e=t,this.#s=n,this.#n=i,this.#t=i(t),this.#u=s,this.#i=new Map,this.#o=Ms(this.#t),this.#l(r.all.toArray())}send(t){if(t instanceof Ir){for(let r of t[0]){let n=this.#u.get(r[0]);if(!n)continue;let i=n(r[1]);i instanceof w||this.#r.push(i)}this.#l()}else if(t instanceof qr)this.#r=this.#r.concat(t[0].toArray()),this.#l(t[1].all.toArray());else if(!(t instanceof Lt))if(t instanceof V)this.#r.push(t[0]),this.#l();else if(t instanceof jt){let r=new Tr(t[0],t[1]);for(let[n,i]of this.#i)i(r)}else if(t instanceof zr){let r=this.#o.get(t[0]);if(!r)return;let n=r(t[1]);if(n instanceof w)return;this.#r.push(n[0]),this.#l()}else if(t instanceof Dr){let r=Dn(this.#u),n=new Br(r,this.#t);this.#i=this.#i.set(t[0],t[1]),t[1](n)}else t instanceof Cr&&(this.#i=this.#i.delete(t[0]))}#e;#s;#r;#n;#t;#i;#o;#u;#l(t=[]){this.#a(t);let r=this.#n(this.#e),n=elements(this.#t,r);if(!Cs(n)){let i=new Er(n);for(let[s,o]of this.#i)o(i)}this.#t=r,this.#o=n.handlers}#a(t=[]){for(;this.#r.length>0;){let r=this.#r.shift(),[n,i]=this.#s(this.#e,r);t=t.concat(i.all.toArray()),this.#e=n}for(;t.length>0;)t.shift()({dispatch:l=>this.send(new V(l)),emit:(l,c)=>this.root.dispatchEvent(new CustomEvent(l,{detail:c,bubbles:!0,composed:!0})),select:()=>{},root:null});this.#r.length>0&&this.#a(t)}},Al=ui.start,si=()=>globalThis.window&&window.document;function Js(e,t,r){return e?t():r()}function Q(e){return Zt(e)}function T(e,t){return me("div",e,t)}function li(e){return me("hr",e,u([]))}function St(e,t){return me("p",e,t)}function ai(e,t){return me("a",e,t)}function Pr(e,t){return me("span",e,t)}function Oe(e,t){return me("button",e,t)}function Ps(e){return me("input",e,u([]))}function Ys(e,t){return me("textarea",e,u([Zt(t)]))}function Ze(e,t){return Ss(e,t)}function We(e,t){return Ts(e,t)}function Le(e){return We("click",t=>new $(e))}function ci(e){return We("focus",t=>new $(e))}function fi(e){return We("blur",t=>new $(e))}function Cl(e){let t=e;return Yn("target",Yn("value",ps))(t)}function pi(e){return We("input",t=>{let r=Cl(t);return ce(r,e)})}var Yr="http://www.w3.org/2000/svg";function _i(e){return Ot(Yr,"line",e,u([]))}function di(e){return Ot(Yr,"polyline",e,u([]))}function Ve(e,t){return Ot(Yr,"svg",e,t)}function I(e){return Ot(Yr,"path",e,u([]))}function mi(e){return Ve(d(_("stroke-linejoin","round"),d(_("stroke-linecap","round"),d(_("stroke-width","2"),d(_("stroke","currentColor"),d(_("fill","none"),d(_("viewBox","0 0 24 24"),d(_("height","24"),d(_("width","24"),e)))))))),u([I(u([_("d","M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z")])),I(u([_("d","M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1")]))]))}function Us(e){return Ve(d(_("stroke-linejoin","round"),d(_("stroke-linecap","round"),d(_("stroke-width","2"),d(_("stroke","currentColor"),d(_("fill","none"),d(_("viewBox","0 0 24 24"),d(_("height","24"),d(_("width","24"),e)))))))),u([I(u([_("d","M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13")])),I(u([_("d","m8 6 2-2")])),I(u([_("d","m18 16 2-2")])),I(u([_("d","m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17")])),I(u([_("d","M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z")])),I(u([_("d","m15 5 4 4")]))]))}function Rs(e){return Ve(d(_("stroke-linejoin","round"),d(_("stroke-linecap","round"),d(_("stroke-width","2"),d(_("stroke","currentColor"),d(_("fill","none"),d(_("viewBox","0 0 24 24"),d(_("height","24"),d(_("width","24"),e)))))))),u([I(u([_("d","m3 10 2.5-2.5L3 5")])),I(u([_("d","m3 19 2.5-2.5L3 14")])),I(u([_("d","M10 6h11")])),I(u([_("d","M10 12h11")])),I(u([_("d","M10 18h11")]))]))}function Gs(e){return Ve(d(_("stroke-linejoin","round"),d(_("stroke-linecap","round"),d(_("stroke-width","2"),d(_("stroke","currentColor"),d(_("fill","none"),d(_("viewBox","0 0 24 24"),d(_("height","24"),d(_("width","24"),e)))))))),u([di(u([_("points","15 3 21 3 21 9")])),di(u([_("points","9 21 3 21 3 15")])),_i(u([_("y2","10"),_("y1","3"),_("x2","14"),_("x1","21")])),_i(u([_("y2","14"),_("y1","21"),_("x2","10"),_("x1","3")]))]))}function Hr(e){return Ve(d(_("stroke-linejoin","round"),d(_("stroke-linecap","round"),d(_("stroke-width","2"),d(_("stroke","currentColor"),d(_("fill","none"),d(_("viewBox","0 0 24 24"),d(_("height","24"),d(_("width","24"),e)))))))),u([I(u([_("d","M18 6 6 18")])),I(u([_("d","m6 6 12 12")]))]))}function Zs(e){return Ve(d(_("stroke-linejoin","round"),d(_("stroke-linecap","round"),d(_("stroke-width","2"),d(_("stroke","currentColor"),d(_("fill","none"),d(_("viewBox","0 0 24 24"),d(_("height","24"),d(_("width","24"),e)))))))),u([I(u([_("d","M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z")])),I(u([_("d","m15 5 4 4")]))]))}var Vs="line-discussion";var hi=class extends a{constructor(t,r,n){super(),this.date=t,this.time=r,this.offset=n}};var xi=class extends a{constructor(t){super(),this.minutes=t}},wi=class extends a{constructor(t){super(),this.unix_days=t}};var gi=class extends a{constructor(t){super(),this.microseconds=t}};function ao(e,t,r){return new hi(e,t,r)}function co(e){return new wi(ee(e,86400))}function fo(e){return e.unix_days*86400}function po(e){return new gi(e)}var Kr=new xi(0);function Li(e){return co(e)}function ji(e){return fo(e)}function Qr(e){return Li(ee(e,1e3))}function Si(e){return ji(e)*1e3}function yo(e){let t=(e-Si(Qr(e)))*1e3;return po(t)}function za(e,t,r){return ao(e,t,r)}function bo(e){return za(Qr(e),yo(e),Kr)}var en=class extends a{constructor(t,r,n,i,s,o){super(),this.parent_id=t,this.significance=r,this.user_id=n,this.message=i,this.expanded_message=s,this.modifier=o}};var Ke=class extends a{},Qe=class extends a{},Xe=class extends a{},Mt=class extends a{},et=class extends a{},Et=class extends a{},Tt=class extends a{},Bt=class extends a{},It=class extends a{},qt=class extends a{},zt=class extends a{},ir=class extends a{},sr=class extends a{},Dt=class extends a{};function Ca(e){return e instanceof Ke?1:e instanceof Qe?2:e instanceof Xe?3:e instanceof Mt?4:e instanceof et?5:e instanceof Et?6:e instanceof Tt?7:e instanceof Bt?8:e instanceof It?9:e instanceof qt?10:e instanceof zt?11:12}function Na(e){return e instanceof sr?0:e instanceof Dt?1:2}function vo(e){return _e(u([["p",ke(e.parent_id)],["s",C((()=>{let t=e.significance;return Ca(t)})())],["u",ke(e.user_id)],["m",ke(e.message)],["x",Ls(e.expanded_message,ke)],["d",C((()=>{let t=e.modifier;return Na(t)})())]]))}var Ei=class extends a{constructor(t,r,n,i,s,o,l,c){super(),this.note_id=t,this.parent_id=r,this.significance=n,this.user_name=i,this.message=s,this.expanded_message=o,this.time=l,this.edited=c}},tt=class extends a{},rt=class extends a{},nt=class extends a{},it=class extends a{},st=class extends a{},ot=class extends a{},ut=class extends a{},or=class extends a{},lt=class extends a{},at=class extends a{},ct=class extends a{},ft=class extends a{},pt=class extends a{},_t=class extends a{},Pe=class extends a{},dt=class extends a{},mt=class extends a{},ur=class extends a{};function Fa(e){if(e===0)return new tt;if(e===1)return new rt;if(e===2)return new nt;if(e===3)return new it;if(e===4)return new st;if(e===5)return new ot;if(e===6)return new ut;if(e===7)return new or;if(e===8)return new lt;if(e===9)return new at;if(e===10)return new ct;if(e===11)return new ft;if(e===12)return new pt;if(e===13)return new _t;if(e===14)return new Pe;if(e===15)return new dt;if(e===16)return new mt;if(e===17)return new ur;throw ae("panic","o11a/computed_note",128,"significance_from_int","Invalid note significance found",{})}function Wa(){return A("n",B,e=>A("p",B,t=>A("s",Ne,r=>A("u",B,n=>A("m",B,i=>A("x",Un(B),s=>A("t",Ne,o=>A("e",Re,l=>Ce(new Ei(e,t,Fa(r),n,i,s,bo(o),l))))))))))}function Oo(e){return e instanceof tt?new y:e instanceof rt?new h("Unanswered Question"):e instanceof nt?new h("Answered"):e instanceof it?new h("Answer"):e instanceof st?new h("Incomplete ToDo"):e instanceof ot?new h("Complete"):e instanceof ut?new h("Completion"):e instanceof or?new h("Unconfirmed Finding"):e instanceof lt?new h("Confirmed Finding"):e instanceof at?new h("Rejected Finding"):e instanceof ct?new h("Confirmation"):e instanceof ft?new h("Rejection"):e instanceof pt?new h("Unanswered Dev Question"):e instanceof _t?new h("Answered Dev Question"):e instanceof Pe?new h("Info"):e instanceof dt?new h("Incorrect Info"):e instanceof mt?new h("Rejection"):new h("Confirmation")}function Lo(e){return e instanceof tt?!1:e instanceof rt||e instanceof nt?!0:e instanceof it?!1:e instanceof st||e instanceof ot?!0:e instanceof ut?!1:e instanceof or||e instanceof lt||e instanceof at?!0:e instanceof ct||e instanceof ft?!1:e instanceof pt||e instanceof _t||e instanceof Pe||e instanceof dt?!0:(e instanceof mt,!1)}function jo(e){return Y(ue(e,B),t=>ce((()=>{let r=jr(t,gs(Wa()));return Ee(r,u([new fe("json-encoded computed note",De(t),u([]))]))})(),r=>os(r,n=>n.parent_id)))}var So="user-submitted-line-note",Ao="user-clicked-discussion-preview",Ti="user-focused-input",Mo="user-unfocused-input",Eo="user-maximized-thread";function To(e){return We("keydown",t=>{let r=A("ctrlKey",Re,i=>A("key",B,s=>Ce([i,s]))),n=u([new P("","",u([]))]);return Y((()=>{let i=ue(t,r);return Ee(i,n)})(),i=>{let s=i[0],o=i[1];return s&&o==="Enter"?new $(e):new w(n)})})}var F=class extends a{constructor(t,r,n,i,s,o,l,c,p,f,m,x,g,b,W){super(),this.is_reference=t,this.show_reference_discussion=r,this.user_name=n,this.line_number=i,this.topic_id=s,this.topic_title=o,this.notes=l,this.current_note_draft=c,this.current_thread_id=p,this.current_thread_notes=f,this.active_thread=m,this.show_expanded_message_box=x,this.current_expanded_message_draft=g,this.expanded_messages=b,this.editing_note=W}},Bi=class extends a{constructor(t,r,n,i){super(),this.current_thread_id=t,this.parent_note=r,this.prior_thread_id=n,this.prior_thread=i}},tn=class extends a{constructor(t,r,n,i){super(),this.topic_id=t,this.topic_title=r,this.line_number=n,this.is_reference=i}},rn=class extends a{constructor(t){super(),this[0]=t}},nn=class extends a{constructor(t){super(),this[0]=t}},lr=class extends a{},sn=class extends a{constructor(t,r){super(),this.new_thread_id=t,this.parent_note=r}},on=class extends a{},un=class extends a{constructor(t){super(),this[0]=t}},ln=class extends a{constructor(t){super(),this[0]=t}},an=class extends a{constructor(t){super(),this.for_note_id=t}},Ii=class extends a{},cn=class extends a{},fn=class extends a{},ar=class extends a{},pn=class extends a{},cr=class extends a{constructor(t){super(),this[0]=t}},_n=class extends a{},dn=class extends a{},mn=class extends a{};function Ha(e){return[new F(!1,!1,"guest",0,"","",G(),"","",u([]),new y,!1,new y,Mr(),new y),N()]}function Ua(e){let t=e.active_thread;if(t instanceof h){let r=t[0];return T(u([]),u([T(u([k("flex justify-end width-full")]),u([Oe(u([Le(new on),k("icon-button flex gap-[.5rem] pl-[.5rem] pr-[.3rem] pt-[.3rem] pb-[.1rem] mb-[.25rem]")]),u([Q("Close Thread"),Hr(u([]))]))])),Q("Current Thread: "),Q(r.parent_note.message),(()=>{let n=r.parent_note.expanded_message;if(n instanceof h){let i=n[0];return T(u([k("mt-[.5rem]")]),u([St(u([]),u([Q(i)]))]))}else return $e(u([]))})(),li(u([k("mt-[.5rem]")]))]))}else return T(u([k("flex items-start justify-between width-full mb-[.5rem]")]),u([Pr(u([k("pt-[.1rem] underline")]),u([e.is_reference?ai(u([Qn("/"+e.topic_id)]),u([Q(e.topic_title)])):Q(e.topic_title)])),T(u([]),u([e.is_reference?Oe(u([Le(new mn),k("icon-button p-[.3rem] mr-[.5rem]")]),u([Hr(u([]))])):$e(u([])),Oe(u([Le(new pn),k("icon-button p-[.3rem] ")]),u([Gs(u([]))]))]))]))}function Ra(e){let t="input-border rounded-md text-[0.65rem] pb-[0.15rem] pt-1 px-[0.5rem]",r=Oo(e);if(r instanceof h){let n=r[0];return Pr(u([k(t)]),u([Q(n)]))}else return $e(u([]))}function Ga(e){return R(e.current_thread_notes,t=>T(u([k("line-discussion-item")]),u([T(u([k("flex justify-between mb-[.2rem]")]),u([T(u([k("flex gap-[.5rem] items-start")]),u([St(u([]),u([Q(t.user_name)])),Ra(t.significance)])),T(u([k("flex gap-[.5rem]")]),u([Oe(u([de("edit-message-button"),k("icon-button p-[.3rem]"),Le(new cr(t))]),u([Zs(u([]))])),t.expanded_message instanceof h?Oe(u([de("expand-message-button"),k("icon-button p-[.3rem]"),Le(new an(t.note_id))]),u([Rs(u([]))])):$e(u([])),Lo(t.significance)?Oe(u([de("switch-thread-button"),k("icon-button p-[.3rem]"),Le(new sn(t.note_id,t))]),u([mi(u([]))])):$e(u([]))]))])),St(u([]),u([Q(t.message)])),ti(e.expanded_messages,t.note_id)?T(u([k("mt-[.5rem]")]),u([St(u([]),u([Q((()=>{let n=t.expanded_message;return pr(n,"")})())]))])):$e(u([])),li(u([k("mt-[.5rem]")]))])))}function Za(e){let t="absolute overlay p-[.5rem] flex w-[100%] h-60 mt-2",r="grow text-[.95rem] resize-none p-[.3rem]";return T(u([de("expanded-message"),e.show_expanded_message_box?k(t+" show-exp"):k(t)]),u([Ys(u([de("expanded-message-box"),k(r),Kn("Write an expanded message body"),pi(n=>new ln(n)),ci(new fn),fi(new ar),To(new lr)]),(()=>{let n=e.current_expanded_message_draft;return pr(n,"")})())]))}function Va(e,t){if(t){if(e==="done")return[new et,"done"];if(e.startsWith("done: ")){let r=e.slice(6);return[new et,r]}else if(e.startsWith("a: ")){let r=e.slice(3);return[new Xe,r]}else if(e.startsWith("answer: ")){let r=e.slice(8);return[new Xe,r]}else if(e.startsWith("reject: ")){let r=e.slice(8);return[new Bt,r]}else if(e.startsWith("confirm: ")){let r=e.slice(9);return[new Tt,r]}else if(e.startsWith("incorrect: ")){let r=e.slice(11);return[new zt,r]}else if(e.startsWith("correct: ")){let r=e.slice(9);return[new ir,r]}else return[new Ke,e]}else if(e.startsWith("todo: ")){let r=e.slice(6);return[new Mt,r]}else if(e.startsWith("q: ")){let r=e.slice(3);return[new Qe,r]}else if(e.startsWith("question: ")){let r=e.slice(10);return[new Qe,r]}else if(e.startsWith("finding: ")){let r=e.slice(9);return[new Et,r]}else if(e.startsWith("dev: ")){let r=e.slice(5);return[new It,r]}else if(e.startsWith("info: ")){let r=e.slice(6);return[new qt,r]}else return[new Ke,e]}function Ka(e){return e instanceof it?"a: ":e instanceof _t?"dev: ":e instanceof nt?"q: ":e instanceof tt?"":e instanceof ot?"todo: ":e instanceof lt?"finding: ":e instanceof ct?"confirm: ":e instanceof ft?"reject: ":e instanceof st?"todo: ":e instanceof Pe?"info: ":e instanceof ur?"correct: ":e instanceof mt?"incorrect: ":e instanceof at?"finding: ":e instanceof dt?"info: ":e instanceof ut?"done: ":e instanceof pt?"dev: ":e instanceof rt?"q: ":"finding: "}function Qa(e,t){if(t instanceof tn){let r=t.topic_id,n=t.topic_title,i=t.line_number,s=t.is_reference;return[(()=>{let o=e;return new F(s,o.show_reference_discussion,o.user_name,i,r,n,o.notes,o.current_note_draft,r,(()=>{let l=ie(e.notes,r);return bt(l,u([]))})(),o.active_thread,o.show_expanded_message_box,o.current_expanded_message_draft,o.expanded_messages,o.editing_note)})(),N()]}else if(t instanceof rn){let r=t[0];return[(()=>{let n=e;return new F(n.is_reference,n.show_reference_discussion,n.user_name,n.line_number,n.topic_id,n.topic_title,r,n.current_note_draft,n.current_thread_id,(()=>{let i=ie(r,e.current_thread_id);return bt(i,u([]))})(),n.active_thread,n.show_expanded_message_box,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),N()]}else if(t instanceof nn){let r=t[0];return rc("user wrote note","src/o11a/ui/line_discussion.gleam",197),[(()=>{let n=e;return new F(n.is_reference,n.show_reference_discussion,n.user_name,n.line_number,n.topic_id,n.topic_title,n.notes,r,n.current_thread_id,n.current_thread_notes,n.active_thread,n.show_expanded_message_box,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),N()]}else if(t instanceof lr){let r=Va((()=>{let s=e.current_note_draft;return Jn(s)})(),fr(e.active_thread)),n=r[0],i=r[1];return Js(e.current_note_draft==="",()=>[e,N()],()=>{let s=(()=>{let f=e.editing_note;if(f instanceof h){let m=f[0];return[new Dt,m.note_id]}else return[new sr,e.current_thread_id]})(),o=s[0],l=s[1],c=(()=>{let f=(()=>{let m=e.current_expanded_message_draft;return _r(m,Jn)})();return f instanceof h&&f[0]===""?new y:f})(),p=new en(l,n,"user"+(()=>{let f=zn(100);return q(f)})(),i,c,o);return[(()=>{let f=e;return new F(f.is_reference,f.show_reference_discussion,f.user_name,f.line_number,f.topic_id,f.topic_title,f.notes,"",f.current_thread_id,f.current_thread_notes,f.active_thread,!1,new y,f.expanded_messages,new y)})(),Ze(So,_e(u([["note",vo(p)],["topic_id",ke(e.topic_id)]])))]})}else if(t instanceof sn){let r=t.new_thread_id,n=t.parent_note;return[(()=>{let i=e;return new F(i.is_reference,i.show_reference_discussion,i.user_name,i.line_number,i.topic_id,i.topic_title,i.notes,i.current_note_draft,r,(()=>{let s=ie(e.notes,r);return bt(s,u([]))})(),new h(new Bi(r,n,e.current_thread_id,e.active_thread)),i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),N()]}else if(t instanceof on){let r=(()=>{let i=e.active_thread,s=_r(i,o=>o.prior_thread);return Wi(s)})(),n=(()=>{let i=_r(r,s=>s.current_thread_id);return pr(i,e.topic_id)})();return[(()=>{let i=e;return new F(i.is_reference,i.show_reference_discussion,i.user_name,i.line_number,i.topic_id,i.topic_title,i.notes,i.current_note_draft,n,(()=>{let s=ie(e.notes,n);return bt(s,u([]))})(),r,i.show_expanded_message_box,i.current_expanded_message_draft,i.expanded_messages,i.editing_note)})(),N()]}else if(t instanceof un){let r=t[0];return[(()=>{let n=e;return new F(n.is_reference,n.show_reference_discussion,n.user_name,n.line_number,n.topic_id,n.topic_title,n.notes,n.current_note_draft,n.current_thread_id,n.current_thread_notes,n.active_thread,r,n.current_expanded_message_draft,n.expanded_messages,n.editing_note)})(),N()]}else if(t instanceof ln){let r=t[0];return[(()=>{let n=e;return new F(n.is_reference,n.show_reference_discussion,n.user_name,n.line_number,n.topic_id,n.topic_title,n.notes,n.current_note_draft,n.current_thread_id,n.current_thread_notes,n.active_thread,n.show_expanded_message_box,new h(r),n.expanded_messages,n.editing_note)})(),N()]}else if(t instanceof an){let r=t.for_note_id;return ti(e.expanded_messages,r)?[(()=>{let i=e;return new F(i.is_reference,i.show_reference_discussion,i.user_name,i.line_number,i.topic_id,i.topic_title,i.notes,i.current_note_draft,i.current_thread_id,i.current_thread_notes,i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,qs(e.expanded_messages,r),i.editing_note)})(),N()]:[(()=>{let i=e;return new F(i.is_reference,i.show_reference_discussion,i.user_name,i.line_number,i.topic_id,i.topic_title,i.notes,i.current_note_draft,i.current_thread_id,i.current_thread_notes,i.active_thread,i.show_expanded_message_box,i.current_expanded_message_draft,ri(e.expanded_messages,r),i.editing_note)})(),N()]}else{if(t instanceof Ii)return[e,Ze(Ao,_e(u([["line_number",C(e.line_number)],["discussion_lane",C(1)]])))];if(t instanceof cn)return[e,Ze(Ti,_e(u([["line_number",C(e.line_number)],["discussion_lane",C(1)]])))];if(t instanceof fn)return[(()=>{let r=e;return new F(r.is_reference,r.show_reference_discussion,r.user_name,r.line_number,r.topic_id,r.topic_title,r.notes,r.current_note_draft,r.current_thread_id,r.current_thread_notes,r.active_thread,!0,r.current_expanded_message_draft,r.expanded_messages,r.editing_note)})(),Ze(Ti,_e(u([["line_number",C(e.line_number)],["discussion_lane",C(1)]])))];if(t instanceof ar)return[e,Ze(Mo,_e(u([["line_number",C(e.line_number)],["discussion_lane",C(1)]])))];if(t instanceof pn)return[e,Ze(Eo,_e(u([["line_number",C(e.line_number)],["discussion_lane",C(1)]])))];if(t instanceof cr){let r=t[0];return[(()=>{let n=e;return new F(n.is_reference,n.show_reference_discussion,n.user_name,n.line_number,n.topic_id,n.topic_title,n.notes,Ka(r.significance)+r.message,n.current_thread_id,n.current_thread_notes,n.active_thread,r.expanded_message instanceof h,r.expanded_message,n.expanded_messages,new h(r))})(),N()]}else if(t instanceof _n){let r=ss(e.current_thread_notes);if(r.isOk()){let n=r[0];return[e,js(i=>i(new cr(n)))]}else return[e,N()]}else return t instanceof dn?[(()=>{let r=e;return new F(r.is_reference,r.show_reference_discussion,r.user_name,r.line_number,r.topic_id,r.topic_title,r.notes,"",r.current_thread_id,r.current_thread_notes,r.active_thread,!1,new y,r.expanded_messages,new y)})(),N()]:[(()=>{let r=e;return new F(r.is_reference,!e.show_reference_discussion,r.user_name,r.line_number,r.topic_id,r.topic_title,r.notes,r.current_note_draft,r.current_thread_id,r.current_thread_notes,r.active_thread,r.show_expanded_message_box,r.current_expanded_message_draft,r.expanded_messages,r.editing_note)})(),N()]}}function Xa(e,t){return We("keydown",r=>{let n=A("ctrlKey",Re,s=>A("key",B,o=>Ce([s,o]))),i=u([new P("","",u([]))]);return Y((()=>{let s=ue(r,n);return Ee(s,i)})(),s=>{let o=s[0],l=s[1];return o&&l==="Enter"?new $(e):l==="ArrowUp"?new $(t):new w(i)})})}function ec(e){return T(u([k("flex justify-between items-center gap-[.35rem]")]),u([Oe(u([de("toggle-expanded-message-button"),k("icon-button p-[.3rem]"),Le(new un(!e.show_expanded_message_box))]),u([Us(u([]))])),e.editing_note instanceof h?Oe(u([de("cancel-message-edit-button"),k("icon-button p-[.3rem]"),Le(new dn)]),u([Hr(u([]))])):$e(u([])),Ps(u([de("new-comment-input"),k("inline-block w-full grow text-[0.9rem] pl-2 pb-[.2rem] p-[0.3rem] border-[none] border-t border-solid;"),Kn("Add a new comment"),pi(t=>new nn(t)),ci(new cn),fi(new ar),Xa(new lr,new _n),Is(e.current_note_draft)]))]))}function tc(e){return Tn("Rendering line discussion "+e.topic_title),T(u([de("line-discussion-overlay")]),u([e.is_reference&&!e.show_reference_discussion?$e(u([T(u([k("overlay p-[.5rem]")]),u([T(u([k("flex items-start justify-between width-full mb-[.5rem]")]),u([Pr(u([k("pt-[.1rem] underline")]),u([ai(u([Qn("/"+e.topic_id)]),u([Q(e.topic_title)]))])),Oe(u([Le(new mn),k("icon-button p-[.3rem]")]),u([mi(u([]))]))])),T(u([k("flex flex-col overflow-auto max-h-[30rem] gap-[.5rem]")]),Ht(e.current_thread_notes,r=>v(r.significance,new Pe)?new $(St(u([]),u([Q(r.message+(fr(r.expanded_message)?"^":""))]))):new w(void 0)))]))])):$e(u([T(u([k("overlay p-[.5rem]")]),u([Ua(e),fr(e.active_thread)||Nn(e.current_thread_notes)>0?T(u([de("comment-list"),k("flex flex-col-reverse overflow-auto max-h-[30rem] gap-[.5rem] mb-[.5rem]")]),Ga(e)):$e(u([])),ec(e)])),Za(e)]))]))}function Bo(){return Ns(Ha,Qa,tc,gr(u([["dsc-data",e=>{let t=ue(e,B);if(t.isOk()){let r=t[0],n=A("topic_id",B,s=>A("topic_title",B,o=>A("line_number",Ne,l=>A("is_reference",Re,c=>Ce([s,o,l,c]))))),i=jr(r,n);if(i.isOk()){let s=i[0][0],o=i[0][1],l=i[0][2],c=i[0][3];return new $(new tn(s,o,l,c))}else return new w(u([new P("dsc-data",De(e),u([]))]))}else return new w(u([new P("dsc-data",De(e),u([]))]))}],["dsc",e=>{let t=jo(e);if(t.isOk()){let r=t[0];return new $(new rn(r))}else return new w(u([new P("line-discussion",De(e),u([]))]))}]])))}var Io=Vs;function rc(e,t,r){let n="\x1B[90m",i="\x1B[39m",s=`${t}:${r}`,o=Te(e);if(typeof process=="object"&&process.stderr?.write){let l=`${n}${s}${i}
${o}
`;process.stderr.write(l)}else if(typeof Deno=="object"){let l=`${n}${s}${i}
${o}
`;Deno.stderr.writeSync(new TextEncoder().encode(l))}else{let l=`${s}
${o}`;console.log(l)}return e}function nc(e){let t='"';for(let r=0;r<e.length;r++){let n=e[r];n==`
`?t+="\\n":n=="\r"?t+="\\r":n=="	"?t+="\\t":n=="\f"?t+="\\f":n=="\\"?t+="\\\\":n=='"'?t+='\\"':n<" "||n>"~"&&n<"\xA0"?t+="\\u{"+n.charCodeAt(0).toString(16).toUpperCase().padStart(4,"0")+"}":t+=n}return t+='"',t}function ic(e){let t="dict.from_list([",r=!0,n=[];return e.forEach((i,s)=>{n.push([s,i])}),n.sort(),n.forEach(([i,s])=>{r||(t=t+", "),t=t+"#("+Te(i)+", "+Te(s)+")",r=!1}),t+"])"}function sc(e){let t=Object.keys(e).map(r=>{let n=Te(e[r]);return isNaN(parseInt(r))?`${r}: ${n}`:n}).join(", ");return t?`${e.constructor.name}(${t})`:e.constructor.name}function oc(e){let t=Object.getPrototypeOf(e)?.constructor?.name||"Object",r=[];for(let s of Object.keys(e))r.push(`${Te(s)}: ${Te(e[s])}`);let n=r.length?" "+r.join(", ")+" ":"";return`//js(${t==="Object"?"":t+" "}{${n}})`}function Te(e){let t=typeof e;if(e===!0)return"True";if(e===!1)return"False";if(e===null)return"//js(null)";if(e===void 0)return"Nil";if(t==="string")return nc(e);if(t==="bigint"||t==="number")return e.toString();if(Array.isArray(e))return`#(${e.map(Te).join(", ")})`;if(e instanceof E)return`[${e.toArray().map(Te).join(", ")}]`;if(e instanceof $t)return`//utfcodepoint(${String.fromCodePoint(e.value)})`;if(e instanceof le)return uc(e);if(e instanceof a)return sc(e);if(lc(e))return ic(e);if(e instanceof Set)return`//js(Set(${[...e].map(Te).join(", ")}))`;if(e instanceof RegExp)return`//js(${e})`;if(e instanceof Date)return`//js(Date("${e.toISOString()}"))`;if(e instanceof Function){let r=[];for(let n of Array(e.length).keys())r.push(String.fromCharCode(n+97));return`//fn(${r.join(", ")}) { ... }`}return oc(e)}function uc(e){let t=e.bitOffset+8*Math.trunc(e.bitSize/8),r=wn(e,e.bitOffset,t),n=e.bitSize%8;if(n>0){let i=Ci(e,t,e.bitSize,!1,!1),s=Array.from(r.rawBuffer),o=`${i}:size(${n})`;return s.length===0?`<<${o}>>`:`<<${Array.from(r.rawBuffer).join(", ")}, ${o}>>`}else return`<<${Array.from(r.rawBuffer).join(", ")}>>`}function lc(e){try{return e instanceof ne}catch{return!1}}ii(Bo(),Io);
